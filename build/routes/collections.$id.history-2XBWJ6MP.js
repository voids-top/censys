import{a as pe}from"/censys/build/_shared/chunk-I4RTDJU2.js";import"/censys/build/_shared/chunk-URNZPFSF.js";import{b as ie}from"/censys/build/_shared/chunk-USPKPH7G.js";import{b as le}from"/censys/build/_shared/chunk-3LJRVTRQ.js";import{a as se}from"/censys/build/_shared/chunk-S47F4LIG.js";import{a as oe}from"/censys/build/_shared/chunk-3W2VQNCA.js";import{a as ne}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import"/censys/build/_shared/chunk-JAEJ7XSF.js";import{a as ge}from"/censys/build/_shared/chunk-EAJKCKTG.js";import"/censys/build/_shared/chunk-FYP76FCX.js";import{a as re}from"/censys/build/_shared/chunk-IJLDI467.js";import{a as ae}from"/censys/build/_shared/chunk-OKZWZKQL.js";import{a as te}from"/censys/build/_shared/chunk-Y7NKNUZC.js";import{b as X,c as j}from"/censys/build/_shared/chunk-22JANVKU.js";import"/censys/build/_shared/chunk-FQTIU6PB.js";import"/censys/build/_shared/chunk-J6D36YFI.js";import"/censys/build/_shared/chunk-EI6HYVQX.js";import"/censys/build/_shared/chunk-J22KWXE5.js";import"/censys/build/_shared/chunk-RAMDI2JB.js";import"/censys/build/_shared/chunk-O3SGPCPK.js";import"/censys/build/_shared/chunk-CJIEOTRC.js";import"/censys/build/_shared/chunk-GYDCO7LL.js";import"/censys/build/_shared/chunk-ATOZ4ARP.js";import"/censys/build/_shared/chunk-DSG73WCA.js";import"/censys/build/_shared/chunk-M7IO6GB7.js";import"/censys/build/_shared/chunk-HUE44QRB.js";import"/censys/build/_shared/chunk-Z3PARXZG.js";import"/censys/build/_shared/chunk-URNZPFSF.js";import"/censys/build/_shared/chunk-WK35ORSL.js";import{a as ee}from"/censys/build/_shared/chunk-NJXUBBUP.js";import"/censys/build/_shared/chunk-437XWWKH.js";import"/censys/build/_shared/chunk-G6DKMBFA.js";import"/censys/build/_shared/chunk-EYKPJWWG.js";import"/censys/build/_shared/chunk-RPAGMMSK.js";import"/censys/build/_shared/chunk-WJT5ZZXK.js";import"/censys/build/_shared/chunk-ZI7DUXMR.js";import"/censys/build/_shared/chunk-TRPWTN3H.js";import"/censys/build/_shared/chunk-UKMMPQ5X.js";import{p as Q,q as Z}from"/censys/build/_shared/chunk-WJEUPJRQ.js";import"/censys/build/_shared/chunk-HPK4AUA3.js";import{a as k}from"/censys/build/_shared/chunk-EZHABQF2.js";import"/censys/build/_shared/chunk-2RV3CGNA.js";import{k as z}from"/censys/build/_shared/chunk-OZE6EA6M.js";import{b as J}from"/censys/build/_shared/chunk-HNL4CPAB.js";import{e as q}from"/censys/build/_shared/chunk-D5QEORL2.js";import{l as _}from"/censys/build/_shared/chunk-VQ4M4AGG.js";import"/censys/build/_shared/chunk-Y7XN4DST.js";import{A as r,B as I,E as $,Ja as G,Ya as Y,aa as D,db as K,va as M,wa as W,x as f,z as i}from"/censys/build/_shared/chunk-GALQBYYN.js";import"/censys/build/_shared/chunk-B7DSLLNE.js";import"/censys/build/_shared/chunk-6URBRDCL.js";import{a as x,k as B,p as U,t as R}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as H,c as d}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as l}from"/censys/build/_shared/chunk-2QEWK57A.js";var O=l(H(),1);var ce=l(H(),1);var n={eventTable:"RaobD",cellWithoutBorder:"OxAJ-",emptyStateRow:"PNEO1",eventRowSelected:"igOz0",cellSpaceWidth:"qnH89",cellTimeline:"RuBeW",timelineHead:"vSocN",timelineLine:"XC2VG",timelineSelected:"A2-nb",cellWidth20:"mH3IQ",cellSelection:"_0i-AE",headerRow:"h0kET",headerSpacingRow:"-P6qp",descriptionCell:"mNhrR"};var t=l(d(),1);function P(e,o){return o&&e.eventTime?o.includes(e.eventTime.toString()):!1}function F({events:e,selectedEventTimestamps:o,onSelectedEventTimestampsChange:a,slots:{DetailLinkComponent:p,DescriptionComponent:c,DetailComponent:v},headers:E}){let y=(0,ce.useCallback)(m=>T=>{let L=m.eventTime;!L||!a||!o||(T?o.length<2?a(C=>[...C,L.toString()]):a(C=>[C[1],L.toString()]):a(C=>C.filter(A=>A!==L.toString())))},[o]);return(0,t.jsx)("table",{className:n.eventTable,children:(0,t.jsxs)("tbody",{children:[E&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("tr",{className:n.headerRow,children:[(0,t.jsx)("td",{"aria-hidden":!0,className:f(n.cellTimeline,n.cellWithoutBorder,n.cellSelection)}),(0,t.jsx)("td",{"aria-hidden":!0,className:f(n.cellWithoutBorder,n.cellSpaceWidth)}),(0,t.jsx)("th",{className:n.cellWidth20,children:(0,t.jsx)(r,{variant:i.DEFAULT_SEMIBOLD,children:E.dateTimeHeader})}),(0,t.jsx)("td",{"aria-hidden":!0,className:f(n.cellWithoutBorder,n.cellWidth20)}),(0,t.jsx)("th",{className:n.cellWidth20,children:(0,t.jsx)(r,{variant:i.DEFAULT_SEMIBOLD,children:E.eventHeader})}),(0,t.jsx)("th",{className:n.descriptionCell,children:(0,t.jsx)(r,{variant:i.DEFAULT_SEMIBOLD,children:E.descriptionHeader})})]}),(0,t.jsx)("tr",{className:n.headerSpacingRow})]}),e.length===0&&(0,t.jsx)("tr",{className:n.emptyStateRow,children:(0,t.jsx)("td",{colSpan:6,children:"No events match your filters"})}),e.map((m,T)=>(0,t.jsxs)("tr",{className:f(P(m,o)&&n.eventRowSelected,n.eventRow),"data-testid":"host-event-instance","aria-selected":P(m,o),children:[(0,t.jsxs)("td",{className:f(n.cellTimeline,n.cellWithoutBorder,n.cellSelection),children:[o&&(0,t.jsx)(Y,{"data-testid":"event-timestamp-checkbox","aria-label":`Select event at ${m.eventTime}`,checked:P(m,o),onCheckedChange:y(m)}),(0,t.jsx)(Ce,{isSelected:P(m,o),isLast:T===e.length-1})]}),(0,t.jsx)("td",{className:f(n.cellWithoutBorder,n.cellSpaceWidth)}),(0,t.jsx)("td",{className:n.cellWidth20,children:(0,t.jsx)(fe,{event:m})}),(0,t.jsx)("td",{className:n.cellWidth20,children:(0,t.jsx)(p,{event:m,isLatest:T===0})}),(0,t.jsx)("td",{className:n.cellWidth20,children:(0,t.jsx)(c,{event:m,isLatest:T===0})}),(0,t.jsx)("td",{className:n.descriptionCell,children:(0,t.jsx)(v,{event:m,isLatest:T===0})})]},`${m.eventTime}-${T}`))]})})}function Ce({isSelected:e,isLast:o}){return e?(0,t.jsx)("div",{className:n.timelineSelected}):(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:n.timelineHead}),!o&&(0,t.jsx)("div",{className:n.timelineLine})]})}function fe({event:e}){return(0,t.jsx)("div",{className:n.cellTimestamp,children:e.eventTime?(0,t.jsx)(re,{timestamp:e.eventTime.toString(),variant:"short"}):ae})}var h=l(d(),1),V=e=>e.cert?(0,h.jsx)(se,{fingerprint:e.cert.sha256}):e.host?(0,h.jsx)(k,{href:`/hosts/${e.host.ip}`,breakWord:!0,children:e.host.ip}):e.web?(0,h.jsxs)(k,{href:`/web/${e.web.hostname}:${e.web.port}`,breakWord:!0,children:[e.web.hostname,":",e.web.port]}):(0,h.jsx)(r,{variant:i.DEFAULT,children:"Unknown"});function me({event:e}){return e.asset_change_event?e.asset_change_event.change_type===_.AssetChangeEvent_ChangeType.ADDED?(0,h.jsxs)(r,{variant:i.DEFAULT,children:[V(e.asset_change_event)," was added"]}):e.asset_change_event.change_type===_.AssetChangeEvent_ChangeType.REMOVED?(0,h.jsxs)(r,{variant:i.DEFAULT,children:[V(e.asset_change_event)," was removed"]}):e.asset_change_event.change_type===_.AssetChangeEvent_ChangeType.CHANGE_TYPE_UNSPECIFIED?(0,h.jsxs)(r,{variant:i.DEFAULT,children:[V(e.asset_change_event)," was changed"]}):(0,h.jsx)(r,{variant:i.DEFAULT,children:"Unknown event"}):e.collection_status_change_event?(0,h.jsx)(r,{variant:i.DEFAULT,children:"Collection status was changed"}):(0,h.jsx)(r,{variant:i.DEFAULT,children:"Unknown event"})}var u={cellContentLink:"ni7J3",gray6:"_1nEJR",navLink:"ztLei",systemBlue:"KlbRZ",detailContainer:"UT-7I",breakWord:"a49zy"};var N=l(d(),1),de=e=>{if(!e.asset_change_event)return"Unknown";let o=Se(e.asset_change_event),a=e.asset_change_event.event_time&&(0,N.jsx)(G,{timestamp:e.asset_change_event.event_time.toString(),format:"MMM DD, YYYY UTC"}),p="was added to the collection",c="because it matched the query";return e.asset_change_event.change_type===_.AssetChangeEvent_ChangeType.REMOVED&&(p="was removed from the collection",c="because it no longer matched the query"),(0,N.jsxs)("span",{children:[(0,N.jsx)("span",{"data-testid":"asset-name",children:o})," ",p," on"," ",a," ",(0,N.jsx)("span",{"data-testid":"change-reason",children:c})]})},Se=e=>e?.host?e.host.ip:e?.cert?e.cert.sha256:e?.web?`${e.web.hostname}:${e.web.port}`:"The asset";var S=l(d(),1);function Te({event:e}){return e.asset_change_event?(0,S.jsx)(r,{variant:i.DEFAULT,className:u.breakWord,children:de(e)}):e.collection_status_change_event?(0,S.jsxs)("div",{className:u.detailContainer,children:[(0,S.jsxs)(r,{variant:i.DEFAULT,className:u.breakWord,children:["Status changed from"," ",e.collection_status_change_event.old_status||"NO STATUS"," to"," ",e.collection_status_change_event.new_status||"NO STATUS"]}),(0,S.jsx)(r,{variant:i.DEFAULT,className:u.breakWord,children:e.collection_status_change_event.reason})]}):(0,S.jsx)(r,{variant:i.DEFAULT,children:"Unknown"})}var b=l(d(),1),Le=e=>{if(e?.web)return"website";if(e?.host)return"host";if(e?.cert)return"certificate";throw new Error("Unknown hit type")},Ne=e=>{if(e?.web)return`/web/${e.web.hostname}:${e.web.port}`;if(e?.host)return`/hosts/${e.host.ip}`;if(e?.cert)return`/certificates/${e.cert.sha256}`;throw new Error("Unknown hit type")};function he({event:{eventTime:e,...o}}){let{asset_change_event:a}=o;if(!a||a.cert||a.web)return null;let p=`${Ne(a)}?at_time=${e}`;return(0,b.jsx)("div",{className:u.cellContentLink,children:(0,b.jsx)(J,{className:u.navLink,to:p,children:(0,b.jsxs)(r,{className:u.systemBlue,children:["View historical ",Le(a)]})})})}var ve={formContainer:"UJghc"};var g=l(d(),1);function Ee({action:e,startDate:o,endDate:a}){let[p,c]=U(),v=p.get("event_type")||"all",E=y=>{p.set("event_type",y),c(p)};return(0,g.jsxs)(R,{action:e,method:"get",className:ve.formContainer,children:[(0,g.jsx)($,{name:"event_type",contentLeft:(0,g.jsx)(K,{iconName:"filter-3",label:"Filter"}),valueProps:{placeholder:"All events"},value:v,onValueChange:E,options:[{label:"All events",value:"all"},{label:"Asset added",value:"asset_added"},{label:"Asset removed",value:"asset_removed"},{label:"Status active",value:"status_active"},{label:"Status paused",value:"status_paused"},{label:"Status populating",value:"status_populating"}]}),(0,g.jsx)(ee,{variant:"line--vertical",spacing:4}),(0,g.jsx)(ie,{startDate:o,endDate:a,withoutButton:!0}),(0,g.jsx)(D,{type:"submit","aria-description":"Filters events to a particular date range and event type",children:"Apply"})]})}var w={titleContainer:"KRfd2",container:"KKp5i",paddedContainer:"UNN3w",loadMoreForm:"_8xCKA"};function Ae(e){return e?.host?e.host.ip:e?.cert?e.cert.sha256:e?.web?`${e.web.hostname}:${e.web.port}`:""}function De(e){return e?.host?"HOST":e?.cert?"CERTIFICATE":e?.web?"WEB":""}function be(e){let o=e.asset_change_event?.event_time?.toString()||e.collection_status_change_event?.event_time?.toString()||"";return e.asset_change_event?{eventType:"ASSET_CHANGE",eventTime:o,assetId:Ae(e.asset_change_event),assetType:De(e.asset_change_event),changeType:e.asset_change_event.change_type||"",reason:"Query match change"}:e.collection_status_change_event?{eventType:"STATUS_CHANGE",eventTime:o,oldStatus:e.collection_status_change_event.old_status||"",newStatus:e.collection_status_change_event.new_status||"",reason:e.collection_status_change_event.reason||""}:{eventType:"UNKNOWN",eventTime:o}}var ue=(e,o,a,p)=>{let c=Temporal.Now.zonedDateTimeISO().toPlainDate().toString(),v=e.map(be),E=Q(v),y=`Censys_Collection_History_${o}_${a||c}_to_${p||c}.csv`;Z(y,E)};var Re=l(ge(),1),s=l(d(),1),we=ne("Collections History","routes/collections.$id");function ye({children:e}){return(0,s.jsx)(j,{children:e})}function _e(){let e=q(),o=oe(),a=le(),[p]=U(),c=p.get("end")||"",v=p.get("start")||"",E=p.get("event_type")||"",{data:y,hasNextPage:m}=X({currentData:o.history.events,nextPageToken:o.history.next_page_token,filters:{start:v,end:c,eventType:E}}),T=(0,O.useMemo)(()=>y.map(A=>({...A,eventTime:A.asset_change_event?.event_time||A.collection_status_change_event?.event_time})),[y]),L=T.length>0&&e?.currentPlanType==="Enterprise",C=(0,O.useCallback)(()=>{ue(T,a.name,v,c)},[T,a.name,v,c]);return(0,s.jsx)(ye,{children:(0,s.jsxs)(W,{title:"Collection Timeline",className:w.container,bodyPadding:M.NONE,children:[(0,s.jsxs)("div",{className:w.paddedContainer,children:[(0,s.jsxs)("div",{className:w.titleContainer,children:[(0,s.jsx)(r,{variant:i.H2,children:"Collection Timeline"}),L&&(0,s.jsx)(D,{variant:I.SECONDARY,iconLeft:"download-2",iconLeftMode:"line",onClick:C,children:"Download CSV"})]}),(0,s.jsx)(Ee,{action:`/collections/${a.collection_id}/history`,startDate:v,endDate:c})]}),(0,s.jsx)(F,{events:T,slots:{DescriptionComponent:me,DetailComponent:Te,DetailLinkComponent:he},headers:{dateTimeHeader:"Date | Time",eventHeader:"Event",descriptionHeader:"Description"}}),(0,s.jsxs)(R,{method:"get",action:`/collections/${a.collection_id}/history`,className:w.loadMoreForm,children:[(0,s.jsx)("input",{type:"hidden",name:"page_token",value:o.history.next_page_token}),(0,s.jsx)("input",{type:"hidden",name:"event_type",value:E}),(0,s.jsx)("input",{type:"hidden",name:"start",value:v}),(0,s.jsx)("input",{type:"hidden",name:"end",value:c}),m&&(0,s.jsx)(D,{type:"submit",variant:I.TERTIARY,iconRight:"arrow-down",iconRightMode:"line",children:"Load More"})]})]})})}function Ue(){let e=B();return(0,s.jsx)(ye,{children:x(e)&&z(e.data)?(0,s.jsx)(pe,{errorCode:e.data.code}):(0,s.jsx)(te,{error:e})})}export{Ue as ErrorBoundary,_e as default,we as meta};
