import{a as mo}from"/censys/build/_shared/chunk-PIXRIREJ.js";import{a as ht}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{e as vt,f as Nt,g as Tt,h as Et,i as P,l as St,m as yt,n as Dt,o as Mt,p as Ct,q as wt,r as Ot,s as _t,t as At,u as xt,v as Rt,w as bt,y as Lt,z as Pt}from"/censys/build/_shared/chunk-OM626W5A.js";import"/censys/build/_shared/chunk-MB2LZLPU.js";import"/censys/build/_shared/chunk-T4CQEEYS.js";import"/censys/build/_shared/chunk-GMNB7RSU.js";import"/censys/build/_shared/chunk-SNE5KUVT.js";import{a as Gt}from"/censys/build/_shared/chunk-5PS6SCVZ.js";import{a as lo}from"/censys/build/_shared/chunk-EAJKCKTG.js";import"/censys/build/_shared/chunk-PUNV2EUS.js";import{m as ft}from"/censys/build/_shared/chunk-ZMYU5ULY.js";import"/censys/build/_shared/chunk-WMKH6XX3.js";import"/censys/build/_shared/chunk-3JU625ZU.js";import{a as pt}from"/censys/build/_shared/chunk-I5BA26X4.js";import{a as nt,b as it}from"/censys/build/_shared/chunk-RAMDI2JB.js";import"/censys/build/_shared/chunk-O3SGPCPK.js";import"/censys/build/_shared/chunk-CJIEOTRC.js";import"/censys/build/_shared/chunk-JLZAPT5W.js";import"/censys/build/_shared/chunk-FSKKJDZY.js";import"/censys/build/_shared/chunk-M7IO6GB7.js";import{k as lt,o as mt,p as ct,r as ut,s as gt}from"/censys/build/_shared/chunk-W5Y6TOHF.js";import"/censys/build/_shared/chunk-AEP7YWHE.js";import"/censys/build/_shared/chunk-URNZPFSF.js";import"/censys/build/_shared/chunk-WK35ORSL.js";import"/censys/build/_shared/chunk-HG7D3PDC.js";import"/censys/build/_shared/chunk-ZKAH2G64.js";import{c as ee}from"/censys/build/_shared/chunk-G6DKMBFA.js";import{a as It}from"/censys/build/_shared/chunk-WNJFRA3F.js";import"/censys/build/_shared/chunk-KIDII43I.js";import{a as oe}from"/censys/build/_shared/chunk-RPAGMMSK.js";import"/censys/build/_shared/chunk-2G5R6E4Q.js";import"/censys/build/_shared/chunk-6XVOHWMX.js";import{b as y,e as dt}from"/censys/build/_shared/chunk-HLRAT4GD.js";import"/censys/build/_shared/chunk-HPK4AUA3.js";import"/censys/build/_shared/chunk-W2GUOEY7.js";import"/censys/build/_shared/chunk-FQAS3FYV.js";import{a as st,b as Ee}from"/censys/build/_shared/chunk-P2FXGQA2.js";import{a as Ce,d as at,f as rt}from"/censys/build/_shared/chunk-FH7VNUY3.js";import"/censys/build/_shared/chunk-B7DSLLNE.js";import"/censys/build/_shared/chunk-GYDCO7LL.js";import"/censys/build/_shared/chunk-KMD3IRPL.js";import"/censys/build/_shared/chunk-Y7XN4DST.js";import{A as x,Aa as se,B as S,Ba as te,C as L,Ca as Je,D as Qe,Da as Ne,Ea as Te,Fa as Xe,Ha as je,Ja as et,Ta as tt,Xa as ot,aa as Y,ba as qe,da as Ze,ha as $e,ia as le,ja as me,ka as ce,la as ue,ma as ge,na as fe,wa as Ie,xa as We,y as pe,ya as he,z as V,za as ve}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{d as Ke}from"/censys/build/_shared/chunk-6URBRDCL.js";import{c as Be,e as Fe,f as ke,g as Ve,i as Ue,m as Ye,q as ze,z as He}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as q,c}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as i}from"/censys/build/_shared/chunk-2QEWK57A.js";var Z={content:"OYPav",emptyState:"Pmi7d",emptyText:"jBhus",emptyStateIcon:"VHkLj"};var $=i(c(),1),Bt=()=>(0,$.jsxs)("div",{className:Z.emptyState,"data-testid":"investigation-empty-state",children:[(0,$.jsx)(V,{name:"share",mode:"line",className:Z.emptyStateIcon}),(0,$.jsx)(S,{className:Z.emptyText,variant:x.H2,children:"No nodes yet."}),(0,$.jsx)(S,{className:Z.emptyText,children:"Add a node to start your investigation."}),(0,$.jsx)(Lt,{align:"center"})]});var E=i(q(),1);var Se=i(q(),1);var Ft={minimizeButton:"SYbuc"};var z=i(c(),1);function we({children:t}){let[n,p]=(0,Se.useState)(!0),l=(0,Se.useCallback)(()=>{p(!n)},[n]),a=n?"Collapse Mini Map":"Expand Mini Map";return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{className:Ft.minimizeButton,children:(0,z.jsx)(tt,{content:a,children:(0,z.jsx)(Ze,{name:"expand-mini-map","aria-label":a,"aria-expanded":n,iconName:n?"fullscreen-exit":"fullscreen",iconMode:"line",size:qe.SMALL,variant:L.GHOST,onClick:l})})}),n&&t]})}var ne={investigationGraph:"aYNiY",reactFlow:"_01KKe",background:"_0ZFHb",backgroundDark:"_9Kaod",backgroundPattern:"nbYLF"};var kt=t=>t.type===y.NodeType.NODE_TYPE_ASSET_SUGGESTION||t.type===y.NodeType.NODE_TYPE_QUERY_SUGGESTION,co=(t,n)=>n[t.parent]?.group?.collapsed??!1;function Vt(t){let n={},p={},l={},a=[],f=[];for(let e of t.nodes)n[e.id]=e,!kt(e)&&e.parent&&(p[e.parent]=e.id);for(let e of t.edges)l[e.source]?l[e.source].push(e):l[e.source]=[e];for(let e of t.nodes)if(kt(e)&&co(e,n))for(let s of l[e.id]??[]){let u=p[e.parent];u&&f.push({...s,source:u})}else{a.push({...e});for(let s of l[e.id]??[])f.push({...s})}return{nodes:a,edges:f}}var R=i(c(),1),uo={x:0,y:0,zoom:1},go={[y.NodeType.NODE_TYPE_ASSET]:_t,[y.NodeType.NODE_TYPE_QUERY]:xt,[y.NodeType.NODE_TYPE_GROUP]:At,[y.NodeType.NODE_TYPE_QUERY_SUGGESTION]:bt,[y.NodeType.NODE_TYPE_ASSET_SUGGESTION]:Rt};function Oe(){let{theme:t}=at(),{zoomIn:n,zoomOut:p,fitView:l}=yt(),[a,f]=(0,E.useState)({}),{graph:e,nodesById:s,updateNode:u,updateNodes:N,errors:D,clearError:T,deleteNodes:d,collapseNodes:k,expandNodes:re,nodeDimensions:A,setNodeDimensions:Wt,selectedNodes:U,setSelectedNodes:Ge,autoLayout:Jt}=P(),[Le,Pe]=(0,E.useState)(null),de=(0,E.useMemo)(()=>Vt(e),[e]),Xt=(0,E.useMemo)(()=>{let r=[],v={},h={},M=0;for(let o of de.nodes){let C=Tt(o),w=U.has(o.id),g=Le===o.id,j=a[o.id],K={id:o.id,type:o.type,position:j||{x:o.x,y:o.y},zIndex:M++,width:A[o.id]?.width,height:A[o.id]?.height,measured:{width:A[o.id]?.width,height:A[o.id]?.height},data:{...o,highlighted:g,selected:w},parentId:o.parent,draggable:C,selectable:!0,selected:w};o.parent&&(h[o.parent]||(h[o.parent]=[]),h[o.parent].push(K)),v[o.id]=K,r.push(K)}for(let[o,C]of Object.entries(h)){let K=20,Me=0,po=0;for(let Q of C)Q.position.y=K,Q.position.x=20,K+=Q.height??0,Q.width&&Q.width>Me&&(Me=Q.width),++po===C.length&&(Q.data.isLastChild=!0);v[o]&&(v[o].width=Me+20*2,v[o].height=K+20)}return r},[de.nodes,a,Le,U,A]),jt=(0,E.useMemo)(()=>de.edges.map(r=>({id:`${r.source}-${r.target}`,source:r.source,target:r.target,type:"default",animated:!1})),[de.edges]),eo=(0,E.useCallback)((r,v)=>{if(v.parent)return;let h=v.id,M=[],o=[],C=null;for(let w of e.nodes)w.id===h?C=w:w.parent===h?M.push(w):o.push(w);C&&N([...o,C,...M])},[N,e.nodes]),to=(0,E.useCallback)(()=>{for(let r in a)u(r,{x:a[r].x,y:a[r].y});f({})},[u,a]),oo=(0,E.useCallback)(r=>{let v=!1,h=!1,M=!1,o={...A},C=new Set(U),w={...a};for(let g of r){if(g.type==="dimensions"&&(g.dimensions?.width!==A[g.id]?.width||g.dimensions?.height!==A[g.id]?.height)&&(v=!0,o[g.id]={width:g.dimensions?.width??0,height:g.dimensions?.height??0}),g.type==="select"){h=!0;let j=s[g.id]?.parent;g.selected?C.add(j||g.id):C.delete(j||g.id)}g.type==="position"&&g.dragging&&g.position&&(M=!0,w[g.id]=g.position)}v&&Wt(o),h&&Ge(C),M&&f(w)},[N,e.nodes,U,A,Ge]),no=(0,E.useCallback)(()=>{let r=Array.from(U);r.length>0&&(d(r),Ot("investigation_node_deleted",{count:r.length}))},[d,U]),io=(0,E.useCallback)((r,v)=>{v||T(r)},[T]),ao=(0,E.useCallback)(async(r,v)=>{let h=v.data;if(h.edges.length>0)return;let M=null;if(vt(h)){let o=mt(h.assetSuggestion.assetType,h.assetSuggestion.assetId);M=s[o]}else if(Nt(h)){let o=await ct(h.querySuggestion.query);M=s[o]}M?.parent&&Pe(M.parent)},[s]),ro=(0,E.useCallback)(r=>{Pe(null)},[]),so=(0,E.useCallback)(r=>{if(r.selected||r.parentId&&U.has(r.parentId))return oe.BUTTON_BORDERLINE_SECONDARY;switch(r.type){case y.NodeType.NODE_TYPE_ASSET:case y.NodeType.NODE_TYPE_QUERY_SUGGESTION:return oe.BUTTON_BORDERLINE_DEFAULT;case y.NodeType.NODE_TYPE_QUERY:case y.NodeType.NODE_TYPE_ASSET_SUGGESTION:return oe.BUTTON_BORDERLINE_DISABLED;case y.NodeType.NODE_TYPE_GROUP:default:return oe.SURFACE_BG_CARD_1}},[U]);return(0,R.jsxs)("div",{className:ne.investigationGraph,"data-testid":"investigation-canvas",children:[(0,R.jsx)("div",{className:ne.reactFlow,children:(0,R.jsxs)(Mt,{onNodeMouseEnter:ao,onNodeMouseLeave:ro,nodes:Xt,edges:jt,onNodesChange:oo,onNodeDragStop:to,onNodeDragStart:eo,nodeTypes:go,defaultViewport:uo,minZoom:.1,maxZoom:.9,fitView:!0,fitViewOptions:{minZoom:.1,maxZoom:.9},zoomOnDoubleClick:!1,selectionOnDrag:!0,selectionMode:St.Partial,panOnDrag:[1],panOnScroll:!0,panOnScrollSpeed:1.5,zoomOnPinch:!0,zoomActivationKeyCode:["Control","Meta"],multiSelectionKeyCode:"Shift",children:[(0,R.jsx)(Ct,{className:pe(ne.background,t===Ce.DARK_MODE&&ne.backgroundDark),patternClassName:ne.backgroundPattern}),(0,R.jsx)(we,{children:(0,R.jsx)(wt,{pannable:!0,zoomable:!0,nodeColor:so,bgColor:oe.SURFACE_BG_CARD_2,maskColor:t===Ce.DARK_MODE?"rgba(0, 0, 0, 0.6)":"rgba(0, 0, 0, 0.1)"})})]})}),(0,R.jsx)(Pt,{onDelete:no,onCollapse:k,onExpand:re,onZoomIn:n,onZoomOut:p,onFitView:l,onAutoLayout:Jt}),D.map((r,v)=>(0,R.jsx)(me,{title:"Could not save changes",variant:$e.CAUTION,behavior:le.ACTIONABLE,onOpenChange:h=>io(v,h),children:(0,R.jsx)(S,{variant:x.DEFAULT,children:r.message})},v))]})}var ye=i(c(),1);function Ut(){let{graph:t,isDirty:n,isSaving:p,investigationId:l}=P(),a=l&&(!t||t?.nodes.length===0);return(0,ye.jsx)("div",{className:Z.content,children:a&&!n&&!p?(0,ye.jsx)(Bt,{}):(0,ye.jsx)(Oe,{})})}var O=i(q(),1);var ie=i(q(),1);var Yt="updateInvestigationForm",zt="deleteInvestigationForm";var b=i(c(),1),Ht=({investigation:t,onClose:n,onSuccess:p})=>{let{title:l}=t,a=Be(),f=ze(),e=Ue(),s=it(),{t:u}=ee(),[N,D]=(0,ie.useState)(!1);(0,ie.useEffect)(()=>{N&&e.state==="idle"&&(n(),D(!1),p())},[e.state,N,n]);let T=(0,ie.useCallback)(()=>{let d=new FormData;d.append("csrf",s),d.append("fetcherKey",zt),D(!0),f(d,{method:"post"})},[f,a.pathname,a.search,s]);return(0,b.jsx)(fe,{size:ce.MEDIUM,open:!0,onOpenChange:n,headerBorder:ue.NONE,footerBorder:ge.NONE,footerActions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Y,{onClick:n,variant:L.DEFAULT,disabled:N,children:u("Cancel")}),(0,b.jsx)(Y,{onClick:T,variant:L.ALERT,disabled:N,children:u(N?"Deleting...":"Delete")})]}),header:(0,b.jsx)(S,{variant:x.H1,children:u("Delete Investigation",{ns:"investigation"})}),children:(0,b.jsxs)(S,{children:["Are you sure you want to delete"," ",(0,b.jsx)(S,{variant:x.DEFAULT_SEMIBOLD,children:l}),"? This action cannot be undone."]})})};var F=i(q(),1);var B={INVESTIGATION_TITLE:"investigationTitle"},Kt={[B.INVESTIGATION_TITLE]:Ke.string({required_error:"Investigation name is required."}).min(1,{message:"Investigation name is required."}).max(100,{message:"Investigation name must be less than 100 characters."})};var G=i(c(),1),Qt=({onClose:t})=>{let{investigationTitle:n,renameInvestigation:p}=P(),l=(0,F.useRef)(null),{t:a}=ee(),f=(0,F.useMemo)(()=>({[B.INVESTIGATION_TITLE]:n||""}),[n]),{formState:e,handleValueChange:s,isValid:u}=Gt(Kt,f,Yt,()=>{});(0,F.useEffect)(()=>{if(l.current){let d=setTimeout(()=>{l.current?.focus()},100);return()=>clearTimeout(d)}},[]);let N=(0,F.useCallback)(d=>{s(B.INVESTIGATION_TITLE,d.target.value)},[s]),D=(0,F.useCallback)(()=>{u&&(p(e.values[B.INVESTIGATION_TITLE]),t())},[u,e.values,p,t]),T=(0,F.useCallback)(d=>{d.key==="Enter"&&u&&(d.preventDefault(),D())},[u,D]);return(0,G.jsx)(fe,{size:ce.MEDIUM,open:!0,onOpenChange:t,headerBorder:ue.NONE,footerBorder:ge.NONE,footerActions:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(Y,{onClick:t,variant:L.DEFAULT,children:a("Cancel")}),(0,G.jsx)(Y,{onClick:D,variant:L.PRIMARY,disabled:!u,children:a("Save")})]}),header:(0,G.jsx)(S,{variant:x.H1,children:a("Rename Investigation",{ns:"investigation"})}),children:(0,G.jsx)(ot,{errorText:e.errors[B.INVESTIGATION_TITLE],children:(0,G.jsx)(Qe,{ref:l,id:B.INVESTIGATION_TITLE,name:B.INVESTIGATION_TITLE,value:e.values[B.INVESTIGATION_TITLE],onChange:N,onKeyDown:T,placeholder:"Type a new name for the investigation...",autoComplete:"off",isFullWidth:!0})})})};var De={trigger:"-odSF",dropdownContent:"gKArY"};var m=i(c(),1);function _e({investigation:t}){let n=Ve(),[p,l]=(0,O.useState)(!1),[a,f]=(0,O.useState)(!1),[e,s]=(0,O.useState)(!1),[u,N]=(0,O.useState)(!1),D=(0,O.useRef)(null),{t:T}=ee(),d=(0,O.useCallback)(()=>{l(!0),s(!1)},[]),k=(0,O.useCallback)(()=>{f(!0),s(!1)},[]),re=(0,O.useCallback)(()=>{l(!1)},[]),A=(0,O.useCallback)(()=>{f(!1)},[]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(Ie,{open:e,onOpenChange:s,children:[(0,m.jsx)(he,{asChild:!0,children:(0,m.jsx)(Y,{ref:D,variant:L.DEFAULT,iconRight:"arrow-drop-down",iconRightMode:"line","aria-label":"Investigation actions",className:De.trigger,children:T("Actions",{ns:"investigation"})})}),(0,m.jsxs)(ve,{align:"end",className:De.dropdownContent,children:[(0,m.jsx)(Ne,{children:T("Actions",{ns:"investigation"})}),(0,m.jsxs)(se,{className:De.dropdownGroup,children:[(0,m.jsx)(te,{asChild:!0,children:(0,m.jsxs)("button",{onClick:d,"aria-label":T("Rename Investigation",{ns:"investigation"}),role:"menuitem",children:[(0,m.jsx)(V,{name:"pencil",mode:"line"}),T("Rename Investigation",{ns:"investigation"})]})}),(0,m.jsx)(te,{asChild:!0,children:(0,m.jsxs)(Ee,{to:`/investigate/${n.id}/download`,download:!0,reloadDocument:!0,children:[(0,m.jsx)(V,{name:"download-2",mode:"line"}),T("Download JSON",{ns:"investigation"})]})}),(0,m.jsx)(Te,{}),(0,m.jsx)(te,{asChild:!0,children:(0,m.jsxs)("button",{onClick:k,"aria-label":T("Delete Investigation",{ns:"investigation"}),role:"menuitem",children:[(0,m.jsx)(V,{name:"delete-bin",mode:"line"}),T("Delete Investigation",{ns:"investigation"})]})})]})]})]}),p&&(0,m.jsx)(Qt,{onClose:re}),a&&(0,m.jsx)(Ht,{investigation:t,onClose:A,onSuccess:()=>N(!0)}),u&&(0,m.jsx)(me,{title:"Investigation Deleted",behavior:le.DISMISSIVE,children:(0,m.jsx)("span",{children:"The investigation was successfully deleted."})})]})}var J=i(q(),1);var W={trigger:"eFVct",triggerText:"jr-CR",content:"zhfFG",dropdownMenuItem:"iGYqo",lightText:"NJuf2"};var I=i(c(),1);function Ae({investigation:t}){let p=rt()?.organizationId??"",{investigationTitle:l}=P(),[a,f]=(0,J.useState)(!1),{investigations:e}=ke(),s=Fe(),u=(0,J.useMemo)(()=>ut(lt,e),[l,e]),{createInvestigation:N}=gt(u),D=(0,J.useCallback)(()=>{N(),f(!1)},[N]),T=(0,J.useCallback)(d=>{let k=`/investigate/${dt(d)}`;p&&(k+=`?${st}=${p}`),s(k),f(!1)},[s,p]);return(0,I.jsxs)(Ie,{open:a,onOpenChange:f,children:[(0,I.jsx)(he,{asChild:!0,children:(0,I.jsxs)("button",{className:W.trigger,"aria-expanded":a,"aria-haspopup":"true","aria-label":"Select investigation",children:[(0,I.jsx)(S,{className:W.triggerText,children:l}),(0,I.jsx)(V,{name:a?"arrow-up-s":"arrow-down-s",mode:"line",className:W.blue})]})}),(0,I.jsx)(We,{children:(0,I.jsxs)(ve,{align:"start",className:W.content,children:[(0,I.jsxs)(Ne,{children:[e.length," ",It("Investigation",e.length),":"]}),(0,I.jsx)(se,{children:e.map(d=>{let k=d.name===t.name,re=d.updateTime&&pt(new Date(d.updateTime),new Date);return(0,I.jsxs)(Je,{checked:k,onSelect:()=>T(d.name),className:W.dropdownMenuItem,children:[(0,I.jsx)("span",{children:d.title}),(0,I.jsxs)("span",{className:pe(!k&&W.lightText),children:["Last updated ",re]}),(0,I.jsx)(Xe,{})]},d.name)})}),(0,I.jsx)(Te,{}),(0,I.jsx)(se,{children:(0,I.jsx)(te,{onSelect:d=>{d.preventDefault(),D()},asChild:!0,children:(0,I.jsxs)("button",{onClick:D,children:[(0,I.jsx)(V,{name:"add",mode:"line"}),"Create Investigation"]})})})]})})]})}var ae=i(q(),1);var H=i(c(),1),qt=6e4;function xe(){let{isDirty:t,isSaving:n,lastSaved:p}=P(),[l,a]=(0,ae.useState)(0);(0,ae.useEffect)(()=>{let e=setInterval(()=>a(s=>s+1),qt);return()=>clearInterval(e)},[]);let f=(0,ae.useMemo)(()=>{if(n)return"Saving...";if(t)return"Unsaved changes";if(p){let s=new Date(p).getTime();return!Number.isNaN(s)&&Date.now()-s<qt?"Last saved just now":(0,H.jsxs)(H.Fragment,{children:["Last saved ",(0,H.jsx)(je,{timestamp:p,format:"MMM DD"})," at"," ",(0,H.jsx)(et,{timestamp:p,format:"H:MM A UTC"})]})}},[t,n,p,l]);return(0,H.jsx)(S,{variant:x.SMALL,children:f})}var Re={header:"h2bJm",section:"_8HB4I"};var X=i(c(),1);function be({investigation:t}){return(0,X.jsxs)("div",{className:Re.header,children:[(0,X.jsx)(Ae,{investigation:t}),(0,X.jsxs)("div",{className:Re.section,children:[(0,X.jsx)(xe,{}),(0,X.jsx)(_e,{investigation:t})]})]})}var Zt={container:"Iwsrn"};var ho=i(lo(),1),vo=i(mo(),1),_=i(c(),1),fo=ht("Censys Investigate","routes/investigate.$id");function Io({children:t}){return(0,_.jsx)(ft,{breadcrumbs:[{linkElement:(0,_.jsx)(Ee,{to:"/investigate",children:"Investigate"})}],children:t})}function $t(){let{investigation:t,csrf:n}=He();return(0,_.jsx)(nt,{token:n,children:(0,_.jsx)(Dt,{children:(0,_.jsx)(Et,{investigation:t,children:(0,_.jsx)(Io,{children:(0,_.jsxs)("div",{className:Zt.container,"data-testid":"investigation",children:[(0,_.jsx)(be,{investigation:t}),(0,_.jsx)(Ut,{}),(0,_.jsx)(Ye,{})]})})})})})}export{$t as default,fo as meta};
