import{a as Q,b as Y}from"/censys/build/_shared/chunk-N2TESHV5.js";import{a as tt}from"/censys/build/_shared/chunk-FZMSXVON.js";import{b as K}from"/censys/build/_shared/chunk-VBURMR5K.js";import{a as B}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as X}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{k as w}from"/censys/build/_shared/chunk-IUMSQHOS.js";import{a as J}from"/censys/build/_shared/chunk-QHRZ4J4F.js";import{d as W,e as j}from"/censys/build/_shared/chunk-IO4OV3HV.js";import{a as pt}from"/censys/build/_shared/chunk-IC5AY47K.js";import{a as Z}from"/censys/build/_shared/chunk-LOKTUJJ3.js";import{a as q}from"/censys/build/_shared/chunk-BWODHJE6.js";import{e as G,h as H}from"/censys/build/_shared/chunk-ST66DGSY.js";import{a as c}from"/censys/build/_shared/chunk-QJVHIZ52.js";import{A as U,xa as z,z as k}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as x}from"/censys/build/_shared/chunk-44DVAK2X.js";import{a as L,e as O,g as M,i as $,k as b,p as F}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as V}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as mt}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as E}from"/censys/build/_shared/chunk-2TWE7TSA.js";var p=E(mt(),1);var g="start",S="end",h="port",y="protocol";var ut=/^[A-Za-z0-9_]+$/,et=c.coerce.number().int().gte(1,{error:"Port must be greater than or equal to 1"}).lte(65535,{error:"Port must be less than or equal to 65535"}),D=c.string().trim().refine(t=>ut.test(t),{error:"Invalid protocol format"}),C=t=>c.union([t,c.literal("")]).optional(),dt={ENTITLEMENT:"ENTITLEMENT_LIMIT_EXCEEDED"};function ot(t){let o=Temporal.Now.zonedDateTimeISO("UTC").startOfDay().toPlainDate(),e=t===-1?void 0:o.subtract({days:t}).toString(),n=()=>{let r=c.iso.date();return C(r.check(s=>{!s.value||s.value===""||e&&s.value<e&&s.issues.push({code:"custom",message:`Historical data is only available going back ${t} days for your tier`,params:{errorCode:dt.ENTITLEMENT},input:s.value})}))};return c.object({[g]:n(),[S]:n(),[h]:C(et.transform(r=>String(r))),[y]:C(D.transform(r=>r.toUpperCase()))})}var rt=c.string().min(1).transform((t,o)=>{let e=t.split("-");if(e.length!==3)return o.addIssue({code:"custom",message:"Service slug must have exactly 3 hyphen-separated parts"}),c.NEVER;let[n,r,s]=e,i=D.safeParse(n);if(!i.success)return o.addIssue({code:"custom",message:"Invalid protocol format"}),c.NEVER;let a=et.safeParse(r);if(!a.success)return o.addIssue({code:"custom",message:"Invalid port number"}),c.NEVER;let m=D.safeParse(s);return m.success?{protocol:i.data,port:String(a.data),transportProtocol:m.data}:(o.addIssue({code:"custom",message:"Invalid transport protocol format"}),c.NEVER)});var R={layout:"iFZkO",header:"iqtUm",emptyState:"qHSz-"};function at(t,o,e,n){if(!t?.ranges||t.ranges.length===0)return{};let r={host:[]};for(let i of t.ranges){let a=i.startTime,m=i.endTime;if(!a||!m)continue;let{ip:v,port:u,transport_protocol:d,protocol:f}=i.keys,P=st({port:u,protocol:f,transportProtocol:d}),I={id:`${v}-${u}-${f}-${d}-${a}-${m}`,type:"host",name:P,startDate:a,endDate:m,shape:w.ROUNDED,port:u,protocol:f,transportProtocol:d};r.host.push(I)}let s=Y(r.host,{entities:o,getName:({port:i,protocol:a,transport_protocol:m})=>st({port:i.toString(),protocol:a,transportProtocol:m})},e,n);return{...r,host:s}}function st({port:t,protocol:o,transportProtocol:e}){return`${o} ${t} / ${e}`}function nt(t){let o=rt.safeParse(t);if(!o.success)return null;let{protocol:e,port:n,transportProtocol:r}=o.data;return`${e} ${n} / ${r}`}var Tt=E(pt(),1),l=E(V(),1),wt=X("Host Service History","routes/hosts.$id");function ft(){let t=$(),o=O(),e=M(),[n]=F(),{historicalRanges:r,historicalRangesStart:s,historicalRangesEnd:i,historicalRangeLimit:a,error:m}=B(),v=H("host-services-timeline"),u=H("historical-timeline-side-section"),{host:d}=tt(),f=(0,p.useMemo)(()=>at(r,d.services,i,s),[r,d.services,i,s]),P=(0,p.useMemo)(()=>e.serviceId?nt(e.serviceId):null,[e.serviceId]),I=(0,p.useMemo)(()=>ot(a),[a]),it=(0,p.useMemo)(()=>Temporal.Now.zonedDateTimeISO("UTC").subtract({days:a}).startOfDay().toInstant(),[a]),ct=(0,p.useCallback)(N=>{let A=e.id;if(!A)return;let _=W({port:parseInt(N.port),protocol:N.protocol,transport_protocol:N.transportProtocol});if(_===e.serviceId){let T=`/hosts/${A}/history`;o(n.size>0?`${T}?${n}`:T)}else{let T=`/hosts/${A}/history/${_}`;o(`${T}?${n}`)}},[o,e.id,e.serviceId,n]),lt=t.state==="loading"&&t.location.pathname.endsWith("history");return v?(0,l.jsx)("div",{className:R.layout,children:(0,l.jsx)(z,{header:(0,l.jsxs)("div",{className:R.header,children:[(0,l.jsx)(U,{variant:k.H4,children:"Service History"}),(0,l.jsx)(Q,{schema:I,hostHistoryLimitDate:it,dateFields:{start:{key:g,initialValue:s},end:{key:S,initialValue:i}},filterFields:[{key:h,label:"Port",placeholder:"Number",type:"number"},{key:y,label:"Protocol",placeholder:"Protocol",type:"text"}]})]}),children:(0,l.jsx)(K,{timelineData:f,historicalRangesStart:s,historicalRangesEnd:i,historicalRangeLimit:a,colors:[Z.VIZ2],isLoading:lt,loadingHeight:"short",onTimelineClick:u?ct:void 0,selectedEntryName:u?P:null,error:m})})}):null}function Xt(){let t=b(),o=G(),e=(0,p.useContext)(x);return(0,l.jsx)("div",{className:R.emptyState,children:L(t)&&j(t.data)?(0,l.jsx)(J,{accessState:o,error:t.data,env:e}):(0,l.jsx)(q,{error:t})})}export{wt as a,ft as b,Xt as c};
