import{a as se}from"/censys/build/_shared/chunk-RS5DP3HK.js";import{a as ee}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as j}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{a as A}from"/censys/build/_shared/chunk-D7RWISVJ.js";import{a as Z}from"/censys/build/_shared/chunk-WNJFRA3F.js";import{d as re}from"/censys/build/_shared/chunk-OKZWZKQL.js";import{a as ie}from"/censys/build/_shared/chunk-QHRZ4J4F.js";import{e as te,f as ae,m as oe,n as ne}from"/censys/build/_shared/chunk-IO4OV3HV.js";import{a as xe}from"/censys/build/_shared/chunk-IC5AY47K.js";import{a as Q}from"/censys/build/_shared/chunk-J22KWXE5.js";import{a as Y}from"/censys/build/_shared/chunk-4WX73TCZ.js";import{a as C}from"/censys/build/_shared/chunk-BU2LL35M.js";import{a as X}from"/censys/build/_shared/chunk-BWODHJE6.js";import{c as W}from"/censys/build/_shared/chunk-4DOFQKLI.js";import{a as J}from"/censys/build/_shared/chunk-XTODG4BZ.js";import{a as K}from"/censys/build/_shared/chunk-M5RKE22T.js";import{e as q}from"/censys/build/_shared/chunk-ST66DGSY.js";import{A as u,B as $,Ra as F,Sa as k,Ta as z,x as G,z as p}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as U}from"/censys/build/_shared/chunk-44DVAK2X.js";import{a as O,g as _,k as w,p as B}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as m}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as L}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as l}from"/censys/build/_shared/chunk-2TWE7TSA.js";var N=l(L(),1);var y={header:"moGDl",changesSection:"rIvCw",changesFoundText:"DzIhF",searchBar:"iCEpt",searchBarInput:"reFzR"};var v=l(m(),1);function I({totalChangesCount:e,searchTerm:r,onSearchChange:t}){let o=_(),[n]=B(),s=h=>{t(h.target.value)},i=()=>{t("")},d=o.collectionId?`/collections/${o.collectionId}/hosts/${o.id}/events`:`/hosts/${o.id}/events`,g=ae(d,n);return(0,v.jsxs)("div",{className:y.header,children:[(0,v.jsx)(J,{link:{to:g},button:{variant:$.TERTIARY,iconLeft:"arrow-left-s",iconLeftMode:"line"},children:"Back"}),(0,v.jsx)(K,{variant:"line--vertical"}),(0,v.jsxs)("div",{className:y.changesSection,children:[(0,v.jsx)(F,{count:e}),(0,v.jsxs)(u,{className:y.changesFoundText,variant:p.H5,children:[Z("Change",e)," Found"]})]}),(0,v.jsx)("div",{className:y.searchBar,children:(0,v.jsx)(se,{value:r,onChange:s,onClear:i,placeholder:"Search Results...",className:y.searchBarInput})})]})}var R=l(L(),1);var ge=l(L(),1);var ce="No results found",le="No changes found",pe="Adjust the search and try again.",de="There are no changes to compare.";var me=l(m(),1);function H({hasSearchTerm:e}){return(0,me.jsx)(W,{"data-testid":"error_event-history-compare-no-results",iconName:"filter-3",iconMode:"line",title:e?ce:le,children:e?pe:de})}var P={patch:"qaAzy",none:"D3GR0",diffA:"kiJ54",diffB:"dL7Ao",overlapMatch:"IMh2I"};function fe(e,r,t){if(!t)return{unchangedPart:e,diffPart:r};let o=`${e}${r}`,n=t.toLowerCase(),s=o.toLowerCase(),i=t?s.indexOf(n):-1;if(i===-1)return{unchangedPart:e,diffPart:r};if(i+t.length<=e.length||i>=e.length)return{unchangedPart:e,diffPart:r};let d=o.slice(0,i),g=o.slice(i,i+t.length),h=o.slice(i+t.length),D=g.slice(0,e.length-i),Se=g.slice(e.length-i);return{unchangedPart:d,unchangedMatchPart:D,diffMatchPart:Se,diffPart:h}}var a=l(m(),1);function V({patch:e,searchTerm:r}){let t;switch(e.op){case"add":t=(0,a.jsx)(De,{patch:e,searchTerm:r});break;case"remove":t=(0,a.jsx)(Le,{patch:e,searchTerm:r});break;case"replace":t=(0,a.jsx)(Ae,{patch:e,searchTerm:r});break;case"unchanged":t=(0,a.jsx)(Ie,{patch:e,searchTerm:r});break}return(0,a.jsx)("div",{role:"row",className:P.patch,children:t})}var De=({patch:e,searchTerm:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{value:"",colIndex:1,className:P.none,ariaLabel:`Version A has no '${e.field}'`}),(0,a.jsx)(f,{value:"",colIndex:2,className:P.none,ariaHidden:!0}),(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:3}),(0,a.jsx)(f,{value:e.bValue,searchTerm:r,colIndex:4})]}),Le=({patch:e,searchTerm:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:1}),(0,a.jsx)(f,{value:e.aValue,searchTerm:r,colIndex:2}),(0,a.jsx)(f,{value:"",colIndex:3,className:P.none,ariaLabel:`Version A has no '${e.field}'`}),(0,a.jsx)(f,{value:"",colIndex:4,className:P.none,ariaHidden:!0})]}),Ae=({patch:e,searchTerm:r})=>{let[t,o=e.aValue,n=e.bValue]=e.replacedValues;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:1}),(0,a.jsx)(u,{role:"gridcell","aria-colindex":2,variant:p.SMALL,as:"div",children:(0,a.jsx)(he,{unchangedValue:t,diffValue:o,className:P.diffA,searchTerm:r})}),(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:3}),(0,a.jsx)(u,{role:"gridcell","aria-colindex":4,variant:p.SMALL,as:"div",children:(0,a.jsx)(he,{unchangedValue:t,diffValue:n,className:P.diffB,searchTerm:r})})]})},Ie=({patch:e,searchTerm:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:1}),(0,a.jsx)(f,{value:e.value,searchTerm:r,colIndex:2}),(0,a.jsx)(f,{value:e.field,searchTerm:r,colIndex:3}),(0,a.jsx)(f,{value:e.value,searchTerm:r,colIndex:4})]}),he=({unchangedValue:e,diffValue:r,searchTerm:t,className:o})=>{let{unchangedPart:n,unchangedMatchPart:s,diffMatchPart:i,diffPart:d}=fe(e,r,t);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{value:n,searchTerm:t,typographyVariant:p.SMALL}),s&&(0,a.jsx)(C,{value:s,searchTerm:s,typographyVariant:p.SMALL}),i&&(0,a.jsx)(C,{value:i,searchTerm:i,typographyVariant:p.SMALL,className:G(P.overlapMatch,o)}),(0,a.jsx)(C,{value:d,searchTerm:t,typographyVariant:p.SMALL,className:o})]})},f=({value:e,searchTerm:r,colIndex:t,className:o,ariaLabel:n,ariaHidden:s})=>(0,a.jsx)(u,{role:"gridcell","aria-colindex":t,variant:p.SMALL,className:o,"aria-label":n,"aria-hidden":s,as:"div",children:(0,a.jsx)(C,{value:e,searchTerm:r,typographyVariant:p.SMALL})});var T={diffComparison:"V8mtk",groupHeader:"edgyO",header:"T0dqL",emptyState:"c-tFS"};var c=l(m(),1);function ve({patches:e,groupedPatches:r,heading:t,searchTerm:o}){return(0,c.jsxs)("div",{className:T.diffComparison,role:"grid","aria-colcount":4,"aria-readonly":"true",children:[(0,c.jsxs)("div",{role:"row",className:T.header,children:[(0,c.jsx)(u,{role:"columnheader","aria-colindex":1,"aria-colspan":2,as:"div",children:t.a}),(0,c.jsx)(u,{role:"columnheader","aria-colindex":3,"aria-colspan":2,as:"div",children:t.b})]}),e.length===0&&r.length===0?(0,c.jsx)("div",{role:"row",className:T.emptyState,children:(0,c.jsx)("div",{role:"gridcell","aria-colindex":1,"aria-colspan":4,children:(0,c.jsx)(H,{hasSearchTerm:!!o})})}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(ue,{patches:e,searchTerm:o}),r.map((n,s)=>(0,c.jsxs)(ge.Fragment,{children:[(0,c.jsxs)("div",{role:"row",className:T.groupHeader,children:[(0,c.jsx)(u,{role:"columnheader","aria-colindex":1,"aria-colspan":2,variant:p.DEFAULT_SEMIBOLD,as:"div",children:n.groupName}),(0,c.jsx)(u,{role:"columnheader","aria-colindex":3,"aria-colspan":2,variant:p.DEFAULT_SEMIBOLD,as:"div",children:n.bGroupName||n.groupName})]}),(0,c.jsx)(ue,{patches:n.patches,searchTerm:o})]},`${n.groupName}-${s}`))]})]})}function ue({patches:e,searchTerm:r}){return(0,c.jsx)(c.Fragment,{children:e.map((t,o)=>(0,c.jsx)(V,{patch:t,searchTerm:r},`${t.field}-${t.op}-${o}`))})}var Pe={removed:"t15a2"};var S=l(m(),1),Ce=(e,r)=>e.op==="unchanged"?e.value:e[`${r}Value`],He=e=>Ce(e,"a")!==null||Ce(e,"b")!==null,Ee=(e,r)=>{if(e.field.toLowerCase().includes(r))return!0;switch(e.op){case"add":return e.bValue?.toLowerCase().includes(r);case"remove":return e.aValue?.toLowerCase().includes(r);case"replace":let[o,n=e.aValue,s=e.bValue]=e.replacedValues,i=`${o}${n}`.toLowerCase(),d=`${o}${s}`.toLowerCase();return i.includes(r)||d.includes(r);case"unchanged":return e.value?.toLowerCase().includes(r);default:return!1}};function Ne(e){return Object.values(e).map(({a:r,b:t,patches:o})=>{let n=`${r.protocol||t.protocol}/${r.port||t.port}`,s=o.every(d=>d.op==="remove"),i;return s&&(i=(0,S.jsxs)("span",{className:Pe.removed,children:[(0,S.jsx)(C,{highlightVariant:"negative",match:n}),(0,S.jsx)(z,{size:"sm",variant:k.FEEDBACK_NEGATIVE_DEFAULT,children:"Not Observed"})]})),{groupName:n,bGroupName:i,patches:o.filter(He)}})}function ye(e,r){if(!r)return e;let t=r.toLowerCase();return e.filter(o=>Ee(o,t))}function Te(e,r){if(!r)return e;let t=r.toLowerCase(),o={};return Object.entries(e).forEach(([n,s])=>{let{a:i,b:d,patches:g}=s,h=g.filter(D=>Ee(D,t));h.length>0&&(o[n]={a:i,b:d,patches:h})}),o}var x=l(m(),1);function b({ip:e,patches:r,servicePatches:t,baseTimestamp:o,updatedTimestamp:n,searchTerm:s}){let i=(0,R.useMemo)(()=>ye(r,s),[r,s]),d=(0,R.useMemo)(()=>Te(t,s),[t,s]),g=(0,R.useMemo)(()=>Ne(d),[d]);return(0,x.jsx)("div",{"data-testid":"host-diff-overview",children:(0,x.jsx)(ve,{heading:{a:(0,x.jsx)(A,{lastUpdatedAt:o,variant:p.H2,children:e}),b:(0,x.jsx)(A,{lastUpdatedAt:n,variant:p.H2,children:e})},patches:i,groupedPatches:g,searchTerm:s})})}var M={container:"NPv-O"};var Me=l(xe(),1),E=l(m(),1),Kr=j("Host History Comparison","routes/hosts.$id"),Ve=250;function be(){let{ip:e,patchInfo:r,baseTimestamp:t,latestTimestamp:o}=ee(),[n,s]=(0,N.useState)(""),i=Y({value:n,delay:Ve}),d=(0,N.useCallback)(h=>{s(h)},[]),g=r.counts?.totalChanges??0;return(0,N.useEffect)(()=>{if(typeof document>"u")return;let h=document.getElementById(re);h&&Q(h)},[]),(0,E.jsxs)("div",{className:M.container,children:[(0,E.jsx)(I,{totalChangesCount:g,searchTerm:n,onSearchChange:d}),(0,E.jsx)(b,{patches:r.patches,servicePatches:r.patchesByService,ip:e,baseTimestamp:t,updatedTimestamp:o,searchTerm:i})]})}function Qr(e){let{currentParams:r,nextParams:t,currentUrl:o,nextUrl:n}=e;if(r.id!==t.id)return!0;let s=o.searchParams,i=n.searchParams;return oe(s,i)||s.get("event_time")!==i.get("event_time")?!1:ne(e)}function Wr(){let e=w(),r=q(),t=(0,N.useContext)(U);return(0,E.jsx)("div",{className:M.emptyState,children:O(e)&&te(e.data)?(0,E.jsx)(ie,{accessState:r,error:e.data,env:t}):(0,E.jsx)(X,{error:e})})}export{Kr as a,be as b,Qr as c,Wr as d};
