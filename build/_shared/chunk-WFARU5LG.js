import{a as J}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as $e}from"/censys/build/_shared/chunk-BGO373KW.js";import{b as ze}from"/censys/build/_shared/chunk-BXMBML5J.js";import{a as st}from"/censys/build/_shared/chunk-IC5AY47K.js";import{c as ce,k as We}from"/censys/build/_shared/chunk-B5UNN2SO.js";import{a as He}from"/censys/build/_shared/chunk-7C4UGOB7.js";import{f as Ve}from"/censys/build/_shared/chunk-IRHQADG7.js";import{a as we}from"/censys/build/_shared/chunk-FP2KPINM.js";import{a as Qe}from"/censys/build/_shared/chunk-BWODHJE6.js";import{d as Ye}from"/censys/build/_shared/chunk-RWVGPSU7.js";import{D as qe,c as $}from"/censys/build/_shared/chunk-4DOFQKLI.js";import{t as Ge}from"/censys/build/_shared/chunk-426SZY5O.js";import{a as xe}from"/censys/build/_shared/chunk-TTVDHAYB.js";import{j as Be}from"/censys/build/_shared/chunk-ZP3FOFQD.js";import{e as Q}from"/censys/build/_shared/chunk-ST66DGSY.js";import{K as ue,q as ke,r as Ue,s as pe,t as z,u as e,v as Ke}from"/censys/build/_shared/chunk-QJVHIZ52.js";import{$ as Le,$a as Pe,A as _,B as ye,D as Ae,E as be,G as se,Xa as ve,ab as q,gb as le,wa as Ie,x as ie,xa as De,y as G,z as I}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as Se}from"/censys/build/_shared/chunk-44DVAK2X.js";import{a as Me,c as Ne,d as ae,k as Fe,l as Ce,m as he,t as _e}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as R}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as Y}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as d}from"/censys/build/_shared/chunk-2TWE7TSA.js";var E=d(Y(),1);var a=d(Y(),1);var M={inputContainer:"aJvQq",inputBar:"wtsWm",optionsContainer:"mod7I",selectedItem:"a4QO4",optionItem:"C5M-9",matchingText:"YDpiw",fullText:"_81nqq"};var de=d(R(),1);function Je(t,l){if(!l)return t;let s=t.split(new RegExp(`(${l})`,"gi"));return(0,de.jsx)("span",{className:M.fullText,children:s.map((p,F)=>p.toLowerCase()===l.toLowerCase()?(0,de.jsx)("b",{className:M.matchingText,children:p},F):p)})}var T=d(R(),1);function Ee({disabled:t,options:l,name:s,label:p,selectedOption:F="",onSelect:S,onChange:D,onFocus:x,onBlur:Z,defaultPageSize:w=15,errorText:j,required:C,contentLeft:k,placeholder:u="Enter Field",className:U}){let K=(0,a.useRef)(null),H=(0,a.useRef)([]),v=(0,a.useRef)(null),[P,B]=(0,a.useState)(!1),[V,W]=(0,a.useState)(w),[A,y]=(0,a.useState)(F),[g,o]=(0,a.useState)(F),[n,O]=(0,a.useState)(-1),[b,m]=(0,a.useState)("IDLE"),ee=(0,a.useCallback)(r=>{m("INPUT"),B(!0),x?.(r)},[]),L=(0,a.useCallback)(r=>{m("IDLE"),B(!1),Z?.(r)},[]),te=(0,a.useCallback)(()=>{v.current&&(v.current.focus(),m("SELECT"))},[]),oe=(0,a.useCallback)(r=>{let c=r.target.value;m("INPUT"),o(c),y(c),O(-1),A&&c===""&&S?.(c),D?.(r)},[]),re=(0,a.useMemo)(()=>g?l.filter(r=>r.toLowerCase().includes(g?.toLowerCase())):l,[l,g]),h=(0,a.useMemo)(()=>re.slice(0,V),[V,re]),ot=(0,a.useCallback)(r=>{if(r.key==="ArrowDown"){r.preventDefault(),m("SELECT");let c=Math.min(n+1,h.length-1);O(c),y(h[c]||A||"")}else if(r.key==="ArrowUp")if(r.preventDefault(),m("SELECT"),n===0)O(-1),y(g);else{let c=Math.max(n-1,0);O(c),y(h[c]||A||"")}else if(r.key==="Enter"&&n>=0){m("IDLE");let c=h[n];y(h[n]),o(h[n]),O(-1),S?.(c)}else r.key==="Escape"&&(r.preventDefault(),m("IDLE"),O(-1))},[n,h]),rt=(0,a.useMemo)(()=>b==="SELECT"?A:g,[b,A,g]),nt=(0,a.useCallback)(()=>{O(-1)},[]),at=(0,a.useCallback)(r=>()=>{m("IDLE"),y(r),o(r),O(-1),S?.(r)},[]);(0,a.useEffect)(()=>{let r=new IntersectionObserver(([ne])=>{ne.isIntersecting&&W(it=>it+w)},{threshold:.1}),c=K.current;return c&&r.observe(c),()=>{c&&r.unobserve(c)}},[P]),(0,a.useEffect)(()=>{n!==null&&H.current[n]?.scrollIntoView({behavior:"smooth",block:"center"})},[n]);let Te=(0,T.jsx)(be,{ref:v,disabled:t,isFullWidth:!0,id:s,name:s,placeholder:u,value:rt,type:"search",onFocus:ee,onBlur:L,onChange:oe,onKeyDown:ot,className:M.inputBar,contentRight:(0,T.jsx)(G,{"data-testid":"autocomplete-dropdown-icon",onClick:te,name:"arrow-down-s",mode:"line","aria-hidden":!0}),autoComplete:"off",role:"combobox","aria-controls":"autocomplete-search-options","aria-expanded":b!=="IDLE",contentLeft:k});return(0,T.jsxs)("div",{className:ie(M.inputContainer,U),children:[p?(0,T.jsx)(q,{label:p,labelFor:s,errorText:j,required:C,children:Te}):Te,b!=="IDLE"&&(0,T.jsxs)("ul",{role:"listbox",className:M.optionsContainer,onMouseMove:nt,id:"autocomplete-search-options",children:[h.map((r,c)=>(0,T.jsx)("li",{role:"option","aria-selected":n===c,ref:ne=>H.current[c]=ne,className:ie(c===n&&M.selectedItem,M.optionItem),onMouseDown:at(r),children:(0,T.jsx)(_,{children:Je(r,g)})},r)),(0,T.jsx)("li",{role:"option",className:M.optionItem,ref:K,children:re.length>h.length&&(0,T.jsx)(_,{children:"load more"})})]})]})}function Xe(t){return t.type!=="object"&&t.type!=="nested"}var f={createReportBreakdownRow:"gjP8G",breakdownFieldInput:"CZOC9",createReportCardBody:"-rGgV",generateReportButton:"wrPPk",tooltip:"mySvw",tooltipIcon:"_0OrTQ",tooltipText:"dv2ov",bucketTooltipTrigger:"eDXVb",reportBuilderLink:"o86-r"};var i=d(R(),1);function me(){let t=J(),l=!!Q(),s=He(()=>"/api/fields",[]),p=Ne(),F=Ae(),S=Ve(),D=(0,E.useMemo)(()=>{let o=S?.collection_id,n=o?`/collections/${o}/report`:"/censys/report",O=p.pathname.includes("json")?"/data/json":"/data/table";return n+O},[S,p.pathname]),x=(0,E.useMemo)(()=>{let o=new Set;for(let n of s.data??[])n.type==="nested"&&o.add(n.path);return o},[s.data]),Z=$e(D),{handleBlur:w,handleChange:j,handleValueChange:C,handleSubmit:k,formState:u,isValid:U}=ze(e.REPORT_FORM.SCHEMAS,{[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]:t.field||"",[e.REPORT_FORM.NAMES.BUCKET_NUM]:t.num_buckets||ke,[e.REPORT_FORM.NAMES.QUERY_FILTER]:t.filter_query||"true",[e.REPORT_FORM.NAMES.COUNT_BY]:t.count_by||z,[e.REPORT_FORM.NAMES.QUERY]:t.q||""},e.REPORT_FORM.FORM_KEY,Z,!0),K=(0,E.useCallback)(o=>{C(e.REPORT_FORM.NAMES.BUCKET_NUM,o)},[u.values]),H=(0,E.useCallback)(o=>{o?C(e.REPORT_FORM.NAMES.QUERY_FILTER,"true"):C(e.REPORT_FORM.NAMES.QUERY_FILTER,"false")},[u.values]),v=(0,E.useCallback)(o=>{o&&C(e.REPORT_FORM.NAMES.COUNT_BY,o)},[u.values]),P=(0,E.useMemo)(()=>{if(s.data){let o=u.values[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD];return Ge(o||"",s.data.filter(n=>Xe(n)).map(n=>n.path),F)}return[]},[s?.data,u,F]),B=(0,E.useMemo)(()=>U&&P.includes(u.values[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]),[U,u.values]),[V,W]=(0,E.useState)([]);(0,E.useEffect)(()=>{let o=u.values[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],n=u.values[e.REPORT_FORM.NAMES.COUNT_BY];if(P.includes(o)){let b=o.split(pe),m=[];m.push({label:ue(b[0]),value:z}),m.push(...b.map((L,te,oe)=>({label:ue(L),value:oe.slice(0,te+1).join(pe)})).filter(L=>x.has(L.value))),W(m);let ee=m.find(L=>L.value===n)?.value??z;C(e.REPORT_FORM.NAMES.COUNT_BY,ee)}else W([])},[u.values[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],u.values[e.REPORT_FORM.NAMES.COUNT_BY],x]);let A=(0,E.useCallback)(o=>{C(e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD,o)},[C]),y=(0,E.useCallback)(o=>{o.preventDefault(),o.stopPropagation();let n=document.getElementById(We);k(o,{[e.REPORT_FORM.NAMES.QUERY]:n?.value||""})},[k]),g=(0,i.jsx)(se,{name:e.REPORT_FORM.NAMES.BUCKET_NUM,contentLeft:(0,i.jsx)(le,{icon:"sort-desc",label:"Results"}),disabled:!l,value:l?u.values[e.REPORT_FORM.NAMES.BUCKET_NUM]:"25",onValueChange:K,options:Ue.map(o=>({label:o.toString(),value:o.toString()})),valueProps:{placeholder:"Bucket Size"},"aria-label":"Bucket Select","data-testid":"bucket-select"});return l||(g=(0,i.jsx)(ve,{triggerClassName:f.bucketTooltipTrigger,content:"Register to unlock additional options",children:g})),(0,i.jsx)(De,{bodyPadding:Ie.NONE,children:(0,i.jsxs)(_e,{onSubmit:y,className:f.createReportCardBody,"data-testid":"report-config-card-form",children:[(0,i.jsx)(_,{variant:I.H2,children:"Create Report"}),(0,i.jsxs)(_,{variant:I.DEFAULT,"data-testid":"report-builder-instructions",children:["Select a breakdown and a bucket size to generate your report. Reference our documentation on how to use"," ",(0,i.jsx)(xe,{href:Ke,isExternal:!0,children:"Report Builder"}),"."]}),(0,i.jsx)(q,{label:"Select Breakdown",errorText:u.errors[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]||u.errors[e.REPORT_FORM.NAMES.BUCKET_NUM]||u.errors[e.REPORT_FORM.NAMES.QUERY_FILTER],required:!0,children:(0,i.jsxs)("div",{className:f.createReportBreakdownRow,children:[(0,i.jsx)(Ee,{className:f.breakdownFieldInput,contentLeft:(0,i.jsx)(G,{icon:"menu-search-line",size:"md"}),name:e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD,selectedOption:u.values[e.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],options:P,onChange:j,onBlur:w,onSelect:A,required:!0,placeholder:"Breakdown Field"}),(0,i.jsx)(se,{name:e.REPORT_FORM.NAMES.COUNT_BY,contentLeft:(0,i.jsx)(le,{icon:"sort-desc",label:"Count By"}),value:u.values[e.REPORT_FORM.NAMES.COUNT_BY],onValueChange:v,options:V,valueProps:{placeholder:Ye},disabled:!B}),g]})}),(0,i.jsxs)("div",{className:f.createReportBreakdownRow,children:[(0,i.jsx)(Pe,{"data-testid":"query-filter",id:"query-filter","aria-label":"Filter nested records by query",label:"Filter results to only display nested records that match my query.",name:e.REPORT_FORM.NAMES.QUERY_FILTER,checked:u.values[e.REPORT_FORM.NAMES.QUERY_FILTER]==="true",onCheckedChange:H}),(0,i.jsx)(we,{icon:"information-line",iconLabel:"",side:"right",contentClassName:f.tooltip,triggerClassName:f.tooltipIcon,content:(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(_,{variant:I.SMALL,className:f.tooltipText,children:["For example, if you search for host.services.protocol=SSH and generate a report broken down by host.services.port and"," ",(0,i.jsx)(_,{variant:I.SMALL_SEMIBOLD,className:f.tooltipText,children:"do not"})," ","check this box, then your report counts will include all ports used by any protocol on hosts returned by your original host.services.protocol=SSH query. If you"," ",(0,i.jsx)(_,{variant:I.SMALL_SEMIBOLD,className:f.tooltipText,children:"do"})," ","check this box, then your report counts will only include ports used by SSH."]})})})]}),(0,i.jsx)(Le,{"aria-label":"Generate Report",type:"submit",variant:ye.PRIMARY,disabled:!B,className:f.generateReportButton,"data-testid":"generate-report-button",children:"Generate Report"})]})})}var Ze={reportBuilderBody:"d9Xri"};var tt=d(Y(),1);var je={errorWrapper:"hzzL9"};var et=d(Y(),1);var fe=d(R(),1);function Re({accessState:t,errorCode:l,env:s}){let p=(0,et.useMemo)(()=>pt(l,t,s),[l,t,s]);return(0,fe.jsx)($,{"data-testid":`error_${String(l)}`,iconName:p.iconName,iconMode:p.iconMode,title:p.title,children:p.message})}function pt(t,l,s){switch(t){case 18e4:return{iconName:"file-list-3",title:"Need a report?",message:(0,fe.jsx)("div",{children:"Select a breakdown field to generate a report."})};default:return qe(t,{accessState:l,env:s})}}function ge(t){return!!t&&typeof t=="object"&&"code"in t&&Be(t.code)}var X=d(R(),1);function Oe(t){let l=Ce(),s=t.error??l,p=Me(s)?s.data:s,F=ge(p),S=Q(),D=(0,tt.useContext)(Se);return F?(0,X.jsx)("div",{className:je.errorWrapper,children:(0,X.jsx)(Re,{accessState:S,errorCode:p.code,env:D})}):(0,X.jsx)(Qe,{error:p})}var dt=d(st(),1),N=d(R(),1);function ut(){let t=J(),l=ae("/censys/report/data/*"),s=ae("/collections/:id/report/data/*"),p=l||s;return(0,N.jsx)(ce,{children:(0,N.jsxs)("div",{className:Ze.reportBuilderBody,children:[(0,N.jsx)(me,{}),t.aggregation&&p?(0,N.jsx)(he,{context:t}):(0,N.jsx)($,{iconName:"file-list-3",title:"Need a report?",children:(0,N.jsx)("div",{children:"Select a breakdown field to generate a report."})})]})})}function yo(){let t=Fe();return(0,N.jsx)(ce,{children:(0,N.jsx)(Oe,{error:t})})}export{ut as a,yo as b};
