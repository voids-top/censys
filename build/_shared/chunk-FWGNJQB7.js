import{a as X}from"/censys/build/_shared/chunk-RDE3WSKD.js";import{a as q}from"/censys/build/_shared/chunk-EYKPJWWG.js";import{a as Q}from"/censys/build/_shared/chunk-XSZMCSJH.js";import{d as V,l as W}from"/censys/build/_shared/chunk-YZ2VHXR4.js";import{a as U}from"/censys/build/_shared/chunk-KIDII43I.js";import{a as E}from"/censys/build/_shared/chunk-RPAGMMSK.js";import{a as B}from"/censys/build/_shared/chunk-2G5R6E4Q.js";import{i as G,w as K}from"/censys/build/_shared/chunk-HLRAT4GD.js";import{a as $}from"/censys/build/_shared/chunk-HPK4AUA3.js";import{a as S}from"/censys/build/_shared/chunk-W2GUOEY7.js";import{a as Y}from"/censys/build/_shared/chunk-XNRXIZZA.js";import{D as N,H as D,o as I,q as _,r as x}from"/censys/build/_shared/chunk-KMD3IRPL.js";import{A as h,B as C,Ta as H,_ as P,y as v}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{g as F,p as w}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as A,c as f}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as p}from"/censys/build/_shared/chunk-2QEWK57A.js";var O=p(A(),1);var J=p(A(),1);var T=p(A(),1),Z=p(f(),1),z=(0,T.forwardRef)(function({children:e,threshold:o=.01,rootMargin:a="300px",...c},i){let t=(0,T.useRef)(null),[u,n]=(0,T.useState)(!1),d=i||t;return(0,T.useEffect)(()=>{if(!("current"in d)||!d.current)return;let b=new IntersectionObserver(y=>{let[ce]=y;n(ce.isIntersecting)},{threshold:o,rootMargin:a});return b.observe(d.current),()=>{b.disconnect()}},[o,a,d]),(0,Z.jsx)("div",{ref:i||t,...c,children:u?e:null})});var m={row:"gGd8A",flex:"QnR1a",labelCell:"kA1CN",chartContainer:"wP3Fn",alignRight:"dO5EP",lastCol:"_3tRgZ",chartCell:"hE59w",gray6:"apwXm",percentCell:"-xMde"};var L={aggLink:"eyJhi",iconButton:"Lhap-",tooltipTrigger:"XAiIG",bucketLabelContainer:"_50Kao",tooltip:"VAnEG"};var R=p(f(),1);function M({isLocked:r,pivotHref:e,label:o,highlightedLabelPortion:a}){let c=q("(max-width: 1024px)"),i=typeof o=="string";return(0,R.jsxs)("div",{"data-testid":o,className:L.bucketLabelContainer,children:[e?(0,R.jsx)(H,{content:o,triggerClassName:L.tooltipTrigger,contentClassName:L.tooltip,side:"right",children:(0,R.jsx)(S,{href:e&&!r?e:"#",className:L.aggLink,isDisabled:r||!e,children:i?(0,R.jsx)(U,{value:K(o,c?25:50,a?.toLowerCase()),searchTerm:a?.toLowerCase(),className:L.aggLink}):o})}):o,r&&(0,R.jsx)(B,{iconClassName:L.iconButton})]})}var s=p(f(),1);function j({label:r,highlightedLabelPortion:e,id:o,count:a,coverage:c,pivotHref:i,total:t,isLocked:u=!1}){let n=(0,J.useRef)(null),d=t?Math.max(t-a,0):0;return(0,s.jsxs)("div",{className:m.row,children:[(0,s.jsx)("div",{className:m.labelCell,children:(0,s.jsx)(M,{isLocked:u,pivotHref:i,label:r,highlightedLabelPortion:e})}),(0,s.jsx)("div",{className:m.chartContainer,children:t&&(0,s.jsx)(z,{className:m.chartCell,ref:n,children:(0,s.jsx)(V,{ref:n,children:(0,s.jsx)(W,{data:[{id:o,count:a,remaining:d}],stackKeys:["count","remaining"],fillColors:[E.BRAND_PEACH,E.BORDERLINE_SECONDARY],strokeColors:[E.BRAND_PEACH,E.BORDERLINE_SECONDARY],gap:0,roundness:5,isRounded:!0})})})}),(0,s.jsx)("div",{className:m.alignRight,children:(0,s.jsx)(C,{className:m.gray6,children:(0,s.jsx)(P,{value:a})})}),(0,s.jsx)("div",{className:v(m.alignRight,m.lastCol,m.percentCell),children:(0,s.jsx)(C,{className:v(m.serviceCoverage,m.gray6),variant:h.DEFAULT_SEMIBOLD,children:`${c.toFixed(2)}%`})})]})}var te={light:"#FFFFFF",dark:"#000000"},ee=["#FCEFE0","#FADFC1","#F7D0A3","#F5C086","#F3B069","#D78C42","#BA702D","#9F591F"],re={light:["#c1c5cb",...ee],dark:["#343a40",...ee]},oe="rgba(74, 42, 9, 0.5)",ae=10;var g={reportGrid:"sOIvM",gridHeader:"pyqHM",headerCell:"Q2mCc",disable:"bLgDZ",textItalic:"_0hLaA",chartColumn:"_0lUz6",servicesCell:"d78y3",reportBodyContainer:"d7-m-"};var k=p(f(),1),ie=(r,e,o,a,c)=>{let i=[],t=r.reduce((n,d)=>n+=d.count,e);r.forEach((n,d)=>{let b=t>0?n.count/t*100:0;i.push({id:`bucket-${d}`,label:n.key,count:n.count,total:t,coverage:b,pivotHref:N(n.key,o,0,a,c),isLocked:n.isLocked})});let u=e>0?e/t*100:0;return i.push({id:"remainingResultsRow",label:(0,k.jsx)(C,{className:g.textItalic,children:"Remaining Results"}),count:e,total:t,coverage:u,pivotHref:void 0}),i.push({id:"allResultsRow",label:(0,k.jsx)(C,{variant:h.DEFAULT_SEMIBOLD,children:"Total"}),count:t,coverage:100,pivotHref:void 0}),i},pe=["host.location.country_code","host.location.country"],ne=(r,e,o,a)=>{if(!pe.includes(o))return null;let c={},i={};return r.forEach(t=>{let u=o==="host.location.country_code"?t.key:Q(t.key);c[u.toUpperCase()]=t.count,i[u.toUpperCase()]=N(t.key,e,0,o,a)}),{countryCodeMap:c,getLink:t=>t?i[t]:N("*",e,1,o,a,!1)}},se=r=>{switch(r.split(".")[0]){case"host":return"Host";case"web":return"Web Property";case"cert":return"Certificate";default:throw new Error(`Unknown breakdown field: ${r}`)}},le=(r,e)=>{if(r===x){let a=e.split(_)[0];switch(a){case"host":return"Count of Hosts";case"web":return"Count of Web Properties";case"cert":return"Count of Certificates";default:return a?`Count of ${D(a)}`:"Count"}}let o=r===""?e:r;return o?`Count of ${D(o.split(_).at(-1)??"")}`:"Count"};var l=p(f(),1);function ge(){let[r]=w(),e=Y(),o=F(),a=G(),c=(0,O.useMemo)(()=>ie(e.aggregation?.buckets||[],e.aggregation?.other_count||0,r.get("q")||"",e.field,a?.collection_id),[r,e.aggregation,e.field,o.id,a]),i=(0,O.useMemo)(()=>c.filter(y=>e.searchTerm&&typeof y.label=="string"?y.label?.toLowerCase().includes(e.searchTerm.toLowerCase()):!0),[c,e.searchTerm]),t=(0,O.useMemo)(()=>ne(e.aggregation?.buckets||[],r.get("q")||"",e.field,o.id),[e.aggregation,r,e.field,o.id]),u=!!t,n=Number(r.get("num_buckets")||I),d=(0,O.useMemo)(()=>`${e.field}-${n}-${r.get("q")||""}-${new Date().toISOString()}`,[e.field,n,r]),b=(0,O.useMemo)(()=>Object.values(t?.countryCodeMap??{}).length>=ae,[t]);return(0,l.jsxs)("div",{className:g.reportBodyContainer,children:[u&&(0,l.jsx)(X,{countsByCountryCode:t.countryCodeMap,strokeColor:te,colorRange:re,dotColor:oe,getUrlForCountry:t.getLink,renderMap:!0,label:se(e.field),bucketCount:n,otherCount:e.aggregation?.other_count||0,shouldDisplayOtherCount:b},d),(0,l.jsxs)("div",{className:g.reportGrid,"data-testid":"agg-table",children:[(0,l.jsxs)("div",{className:g.gridHeader,children:[(0,l.jsx)("div",{className:g.headerCell,children:(0,l.jsx)(C,{variant:h.DEFAULT_SEMIBOLD,children:$(e.field)})}),(0,l.jsx)("div",{"aria-label":"Report bar visualization",className:g.headerCell}),(0,l.jsx)("div",{className:v(g.servicesCell,g.headerCell),children:(0,l.jsx)(C,{variant:h.DEFAULT_SEMIBOLD,children:le(e.count_by,e.field)})}),(0,l.jsx)("div",{className:v(g.percentHeaderCell,g.servicesCell,g.headerCell),children:(0,l.jsx)(C,{variant:h.DEFAULT_SEMIBOLD,children:"%"})})]}),i.map(y=>(0,l.jsx)(j,{...y,highlightedLabelPortion:e.searchTerm},y.id))]})]})}export{ge as a};
