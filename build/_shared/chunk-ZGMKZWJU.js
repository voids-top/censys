import{a as nt}from"/censys/build/_shared/chunk-G5PDCQRF.js";import{a as et,b as rt,c as ot,d as at,g as it,i as st}from"/censys/build/_shared/chunk-BN26CT6T.js";import{a as j,b as tt}from"/censys/build/_shared/chunk-N2TESHV5.js";import{a as Z}from"/censys/build/_shared/chunk-23KJ32CX.js";import{b as J}from"/censys/build/_shared/chunk-VBURMR5K.js";import{a as q}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as Q}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{k as z}from"/censys/build/_shared/chunk-IUMSQHOS.js";import{a as X}from"/censys/build/_shared/chunk-JAEJ7XSF.js";import{a as ut}from"/censys/build/_shared/chunk-IC5AY47K.js";import{a as Y}from"/censys/build/_shared/chunk-LOKTUJJ3.js";import{a as K}from"/censys/build/_shared/chunk-BWODHJE6.js";import{f as B,k as U}from"/censys/build/_shared/chunk-ZP3FOFQD.js";import{e as O,h as S}from"/censys/build/_shared/chunk-ST66DGSY.js";import{B as V,x as A,z as G}from"/censys/build/_shared/chunk-QJVHIZ52.js";import{$ as F,A as R,B as W,xa as I,z as v}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as $}from"/censys/build/_shared/chunk-44DVAK2X.js";import{C as w,a as x,c as P,i as _,k as N}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as M}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as Tt}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as H}from"/censys/build/_shared/chunk-2TWE7TSA.js";var r=H(Tt(),1);var E={threatsLayout:"zbvzi",threatTimelineHeader:"vPedB",serviceList:"gYMbh",sectionHeader:"-kzUw"};var ft="hostname",yt="port",Rt="threat_name";function mt(i,p,T,l){if(!i)return{};let s={host:[]};for(let o of i){let u=o.startTime?.toString(),n=o.endTime?.toString();if(!u||!n)continue;let h=o.keys,a=h.get(ft),c=h.get(yt),g=h.get(Rt);if(!a||!c||!g)continue;let f={id:`${a}-${c}-${g}-${u}-${n}`,type:"web",name:g,startDate:u,endDate:n,subtitle:`${a}:${c}`,shape:z.ROUNDED,opacity:1};s.host.push(f)}let d=tt(s.host,{entities:p.threats,getName:o=>o.name,getSubtitle:()=>`${p.hostname}:${p.port}`},T,l);return{...s,host:d}}var Ht=H(ut(),1),t=H(M(),1),te=Q("Web Property Threats","routes/web.$id");function Et(){let i=S("threat-detections"),p=S("threat-history"),[T]=B([20]),{historicalRanges:l,historicalRangesStart:s,historicalRangesEnd:d,historicalRangeLimit:o,filterError:u}=q(),n=P(),h=_(),a=w(),[c,g]=(0,r.useState)([]),[f,D]=(0,r.useState)(""),{webAggregate:m,threatDetails:k,targetRoute:C}=nt(),pt=(0,r.useMemo)(()=>st(o),[o]),L=(0,r.useMemo)(()=>m.threats.filter(e=>Boolean(e.name)),[m.threats]),ct=`${m.hostname}: ${m.port}`;(0,r.useEffect)(()=>{let e=X(a.data),y=e?.historicalRanges?.ranges,b=e?.historicalRanges?.nextPageToken;y&&(g([...c,...y]),D(b??""))},[a.data]),(0,r.useEffect)(()=>{let e=l?.nextPageToken??"";g([]),D(e)},[l]);let lt=(0,r.useCallback)(()=>{if(a.state==="idle"){let e=new URLSearchParams(n.search);e.set(it,f??""),a.load(`${n.pathname}?${e.toString()}`)}},[a,n.pathname,n.search,f]),dt=(0,r.useMemo)(()=>{let y=[...l?.ranges??[],...c];return mt(y,m,d,s)},[l,c,m,d,s]),ht=(0,r.useMemo)(()=>Temporal.Now.zonedDateTimeISO("UTC").subtract({days:o}).startOfDay().toInstant(),[o]),gt=h.state==="loading"&&h.location.pathname.endsWith("threats");return(0,t.jsxs)("div",{className:E.threatsLayout,children:[p&&(0,t.jsxs)(I,{header:(0,t.jsxs)("div",{className:E.threatTimelineHeader,children:[(0,t.jsx)(R,{variant:v.H5,children:"Threat Detection History"}),(0,t.jsx)(j,{schema:pt,hostHistoryLimitDate:ht,dateFields:{start:{key:ot,initialValue:s},end:{key:at,initialValue:d}}})]}),children:[(0,t.jsx)(J,{timelineData:dt,historicalRangesStart:s,historicalRangesEnd:d,historicalRangeLimit:o,colors:[Y.RED],isLoading:gt,loadingHeight:"short",error:{filter:u}}),f&&(0,t.jsx)(F,{isLoading:a.state!=="idle",onClick:lt,variant:W.TERTIARY,iconRight:"arrow-down",children:"Load More"})]}),L.length===0&&(0,t.jsx)(R,{children:"We haven't found any threats on this web property."}),L.length>0&&L.map(e=>{let b=[{to:G(V(A({kind:0,field:"web.threats.id",value:e.id}),A({kind:0,field:"web.port",value:m.port}),"and",!1)),iconName:"search",label:"Search for threat on port"}];return(0,t.jsx)(et,{threat:e,description:k?.[e.id]?.description,subHeader:(0,t.jsx)(R,{variant:v.H5,children:"Observed on web property"}),baseRoute:C,addedAt:k?.[e.id]?.addedAt,children:i&&T&&(0,t.jsxs)("div",{children:[(0,t.jsx)(R,{className:E.sectionHeader,variant:v.H4,children:"Evidence (1)"}),(0,t.jsx)("ul",{className:E.serviceList,children:(0,t.jsx)(rt,{threat:e,baseRoute:C,title:ct,timestamp:m.scan_time?.toString(),actionLinks:b,ariaLabel:"Threat details for web property",testId:`threat-detail-item-${e.id}`})})]})},e.id)})]})}function ee(){let i=N(),p=O(),T=(0,r.useContext)($);return(0,t.jsx)("div",{"data-testid":"web-threats-error",children:x(i)&&U(i.data)?(0,t.jsx)(Z,{accessState:p,error:i.data,env:T}):(0,t.jsx)(K,{error:i})})}export{te as a,Et as b,ee as c};
