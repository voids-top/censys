import{a as W}from"/censys/build/_shared/chunk-XNZQSVV6.js";import{a as K}from"/censys/build/_shared/chunk-BGO373KW.js";import{a as Q,b as J}from"/censys/build/_shared/chunk-BXMBML5J.js";import{k as $}from"/censys/build/_shared/chunk-IUMSQHOS.js";import{f as I,h as L,j as z,k as V}from"/censys/build/_shared/chunk-6EMU7K4F.js";import{a as X}from"/censys/build/_shared/chunk-M5RKE22T.js";import{a as ct}from"/censys/build/_shared/chunk-N7X32FEJ.js";import{$ as v,A,B as P,E as j,Xa as Y,_ as O,ib as q,y as Z,z as G}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as B,e as U,p as w,t as H}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as R}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as _}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as E}from"/censys/build/_shared/chunk-2TWE7TSA.js";var s=E(_(),1);var lt=E(ct(),1);var F=E(_(),1);var S={form:"OL5DE",formField:"HC9nh",input:"ZVVvC",validationMessageText:"U2e1S",quickLinks:"B1gIC",clearBtn:"_78U4B"};var T=E(R(),1),mt=[7,14,30,90];function tt({limitInstant:p,validationMessage:t,hasRange:c,setRange:k,setMonth:D}){let u=(0,F.useMemo)(()=>{let n=1/0;if(p){let o=Temporal.Now.instant();n=p.toZonedDateTimeISO("UTC").until(o.toZonedDateTimeISO("UTC"),{smallestUnit:"day"}).days}return mt.filter(o=>o<=n)},[p]);function a(n,o){n.preventDefault();let g=Temporal.Now.instant().toZonedDateTimeISO("UTC"),h=g.startOfDay().add({days:1}).subtract({days:o}).toInstant(),l=z(Temporal.Now.instant()),M=g.subtract({months:1}).toInstant();k({from:I(h),to:I(l)}),D(I(M))}function f(n){n.preventDefault(),k(void 0)}return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:S.quickLinks,role:"group","aria-label":"Quick date range selection",children:[u.map(n=>(0,T.jsxs)(v,{size:O.SMALL,onClick:o=>a(o,n),variant:P.GHOST,children:["Last ",n," days"]},n)),(0,T.jsx)(v,{size:O.SMALL,onClick:f,variant:P.GHOST,className:S.clearBtn,disabled:!c,children:"Clear all"})]}),t?(0,T.jsx)(A,{variant:G.SMALL,className:S.validationMessageText,role:"alert","aria-live":"polite",children:t}):null]})}var r=E(R(),1);function pt({schema:p,dateFields:t,filterFields:c=[],hostHistoryLimitDate:k}){let D=B(),[u]=w(),[a,f]=(0,s.useState)(),[n,o]=(0,s.useState)(()=>{let e=Temporal.Now.instant().toZonedDateTimeISO("UTC").subtract({months:1}).toInstant();return I(e)}),g=K(),h=U(),l=p.shape,M=(0,s.useMemo)(()=>{let e={};for(let d of Object.keys(l))e[d]=u.get(d)??"";let{updatedFormState:i}=Q(l,{values:e,errors:{}}),y={};for(let d of Object.keys(l))i.errors[d]||(y[d]=i.values[d]??"");return y},[l,u]),{formState:C,handleChange:et,handleValueChange:m,handleSubmit:nt,isValid:N}=J(l,M,"historical-timeline-filters",g,!0);(0,s.useEffect)(()=>{t.start.initialValue&&t.end.initialValue?(f({from:new Date(t.start.initialValue),to:new Date(t.end.initialValue)}),m(t.start.key,t.start.initialValue??""),m(t.end.key,t.end.initialValue??"")):f(void 0)},[t.start.initialValue,t.end.initialValue,t.start.key,t.end.key,m]),(0,s.useEffect)(()=>{if(a?.from&&a?.to){let e=V(a.from),i=V(a.to);m(t.start.key,e),m(t.end.key,i)}else a||(m(t.start.key,""),m(t.end.key,""))},[a,t.start.key,t.end.key,m]);let ot=(0,s.useCallback)(()=>{let e=new URLSearchParams(D.search);e.delete(t.start.key),e.delete(t.end.key);for(let y of c)e.delete(y.key);m(t.start.key,""),m(t.end.key,"");for(let y of c)m(y.key,"");let i={};i[t.start.key]="",i[t.end.key]="";for(let y of c)i[y.key]="";g(i)},[D.pathname,D.search,h,t.start.key,t.end.key,c,m]),at=(0,s.useMemo)(()=>u.has(t.start.key)||u.has(t.end.key)||c.some(e=>u.has(e.key)),[u,t.start.key,t.end.key,c]),b=(0,s.useMemo)(()=>{let e=C.values[t.start.key],i=C.values[t.end.key];if(!e||e===""||!i||i==="")return"";try{let y=Temporal.PlainDate.from(e),d=Temporal.PlainDate.from(i);return y.until(d).days>365?`Date range cannot exceed ${365} days`:""}catch{}},[C]),rt=(0,s.useMemo)(()=>b||Object.values(C.errors).filter(Boolean).join(", "),[b,C.errors]),st={mode:"range",timeZone:"UTC",required:!1,selected:a,onSelect:f,month:n,onMonthChange:o,numberOfMonths:2,showOutsideDays:!1,disabled:[{after:new Date},...k?[{before:I(k)}]:[]],footer:(0,r.jsx)(tt,{validationMessage:b,setRange:f,setMonth:o,limitInstant:k,hasRange:!!a})},it=(0,s.useMemo)(()=>!N||!!b,[N,b]);return(0,r.jsxs)(H,{className:S.form,onSubmit:nt,children:[(0,r.jsx)(q,{dayPickerProps:st,disabledTooltip:yt}),c.length?(0,r.jsx)(X,{variant:"line--vertical"}):null,c.map(e=>(0,r.jsxs)("div",{className:S.formField,children:[(0,r.jsx)("label",{htmlFor:e.key,children:(0,r.jsx)(A,{children:e.label})}),(0,r.jsx)(j,{placeholder:e.placeholder,className:S.input,contentLeft:(0,r.jsx)(Z,{name:"filter-3",mode:"line"}),type:e.type,id:e.key,name:e.key,value:C.values[e.key],onChange:et,isValid:!C.errors[e.key],autoComplete:"off"})]},e.key)),it?(0,r.jsx)(Y,{content:rt,children:(0,r.jsx)(v,{type:"submit",disabled:!0,children:"Apply"})}):(0,r.jsx)(v,{type:"submit",children:"Apply"}),at&&(0,r.jsx)(W,{onClick:ot,type:"button"})]})}function yt(p){return new Date<p?"Must select a date in the past":"Upgrade to unlock additional history"}function wt(p,t,c,k){let D=L(c);if(!(D&&D.toZonedDateTimeISO("UTC").toPlainDate().toString()===Temporal.Now.instant().toZonedDateTimeISO("UTC").toPlainDate().toString()))return[...p];let a=new Map;for(let n of p){let o=n.name,g=a.get(o);if(!g)a.set(o,n);else{let h=L(n.endDate),l=L(g.endDate);h&&l&&Temporal.Instant.compare(h,l)>=0&&a.set(o,n)}}let f=[];for(let n of t.entities){let o=t.getName(n),h=a.get(o)?.endDate||k,l={id:`${o}-extension`,type:"extension",name:o,subtitle:t.getSubtitle?.(n),startDate:h,endDate:Temporal.Now.instant().toString(),shape:$.ROUNDED,opacity:.25};f.push(l)}return[...f,...p]}export{pt as a,wt as b};
