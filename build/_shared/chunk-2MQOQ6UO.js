import{a as Re}from"/censys/build/_shared/chunk-VBURMR5K.js";import{a as Ee}from"/censys/build/_shared/chunk-HSJDTMQA.js";import{a as De}from"/censys/build/_shared/chunk-LCN4BXNE.js";import{a as ce}from"/censys/build/_shared/chunk-JMHN7ZWW.js";import{a as fe}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as de}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{a as ge}from"/censys/build/_shared/chunk-BGO373KW.js";import{b as ue}from"/censys/build/_shared/chunk-BXMBML5J.js";import{b as me}from"/censys/build/_shared/chunk-4KKS33MW.js";import{b as ne,h as ae,k as L,q as ie,t as se,u as le,v as pe}from"/censys/build/_shared/chunk-IUMSQHOS.js";import{a as Te}from"/censys/build/_shared/chunk-JAEJ7XSF.js";import{a as j,b as Rt,c as _t,d as St,e as he}from"/censys/build/_shared/chunk-IY4F57OS.js";import{a as eo}from"/censys/build/_shared/chunk-IC5AY47K.js";import{b as R}from"/censys/build/_shared/chunk-LOKTUJJ3.js";import{c as Et,d as Dt}from"/censys/build/_shared/chunk-5HYWBZZN.js";import{a as re}from"/censys/build/_shared/chunk-BWODHJE6.js";import{c as te,d as ee,y as oe}from"/censys/build/_shared/chunk-4DOFQKLI.js";import{h as ht}from"/censys/build/_shared/chunk-6EMU7K4F.js";import{a as it}from"/censys/build/_shared/chunk-M5RKE22T.js";import{k as jt}from"/censys/build/_shared/chunk-ZP3FOFQD.js";import{e as Qt}from"/censys/build/_shared/chunk-ST66DGSY.js";import{a as P}from"/censys/build/_shared/chunk-QJVHIZ52.js";import{$ as Q,A,B as w,E as gt,Ka as Zt,Ma as qt,x as Jt,xa as zt,y as ft,z as ut}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{c as Kt}from"/censys/build/_shared/chunk-44DVAK2X.js";import{a as Ut,c as Bt,e as Gt,i as $t,k as wt,m as Yt,p as at,t as Vt,z as Xt}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as p}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as Tt}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{c as to,e as i}from"/censys/build/_shared/chunk-2TWE7TSA.js";var Ge=to((xr,Be)=>{Be.exports={}});var $e=i(Tt(),1);var h=i(Tt(),1);var _e="CERT_HISTORY_FORM",tt="type",T="port",u="protocol",_="start",S="end",k="page_token",co=[{value:"all",label:"All"},{value:"host",label:"Host"},{value:"web",label:"Web"}];var f={form:"_7fXCb",section:"oAJv-",fieldContainer:"_--7Nr",field:"_60CCE",divider:"ubF5B"};var c=i(p(),1);function Se({port:t,onPortChange:o,protocol:e,onProtocolChange:s,portError:n,protocolError:g}){return(0,c.jsxs)("div",{className:f.section,children:[(0,c.jsxs)("div",{className:f.fieldContainer,children:[(0,c.jsx)("label",{className:f.label,htmlFor:T,children:(0,c.jsx)(A,{children:"Port"})}),(0,c.jsx)("div",{className:f.field,children:(0,c.jsx)(gt,{name:T,placeholder:"Number","aria-label":"Port number",contentLeft:(0,c.jsx)(ft,{name:"filter-3",mode:"line"}),value:t,onChange:a=>{o(a.target.value)},isFullWidth:!0,isValid:!n,autoComplete:"off"})})]}),(0,c.jsxs)("div",{className:f.fieldContainer,children:[(0,c.jsx)("label",{className:f.label,htmlFor:u,children:(0,c.jsx)(A,{children:"Protocol"})}),(0,c.jsx)("div",{className:f.field,children:(0,c.jsx)(gt,{name:u,placeholder:"Protocol","aria-label":"Protocol",contentLeft:(0,c.jsx)(ft,{name:"filter-3",mode:"line"}),value:e,onChange:a=>{s(a.target.value)},isFullWidth:!0,isValid:!g,autoComplete:"off"})})]})]})}var oo="Invalid asset type",Ie=`Port must be between ${Et} and ${Dt}`,ro="Invalid protocol",no=P.enum(["all","host","web"],{error:oo}),ao=P.union([P.string().trim().refine(t=>/^\d+$/.test(t),{error:Ie}).transform(t=>parseInt(t,10)).refine(t=>t>=Et&&t<=Dt,{error:Ie}),P.literal("")]),ve=t=>P.string().trim().refine(o=>o===""||t.some(e=>e.toLowerCase()===o.toLowerCase()),{error:ro}),Ce=P.string().optional(),io=P.string().optional(),ye={[tt]:no,[T]:ao,[k]:io,[_]:Ce,[S]:Ce};var Oe=(t,o)=>Array.from(t.entries()).reduce((e,[s,n])=>{if(!n.ip&&!n.hostname||!n.start_time)return e;let g=n.ip||n.hostname||"",a=n.ip?"host":"web",v=n.start_time,x=n.end_time?n.end_time:Temporal.Now.instant(),E=s.split(`-${v}`)[0],U=E.split(" / ")[1],y=`${g}-${n.port}-${U}-${v}-${x}`,B=vt(E,o??null),H={id:y,type:a,name:E,startDate:v.toString(),endDate:x.toString(),opacity:B?1:.3,shape:a==="host"?L.ROUNDED:L.POINTED};return a==="host"?e.host.push(H):e.web.push(H),e},{host:[],web:[]}),Ct=(t,o)=>{if(!t||!o)return;let e=`${t.name}-${t.startDate}`;return o.get(e)},Ne=t=>{let o=new Map;return t.forEach(e=>{let s=e.ip||e.hostname;if(!s||!e.start_time)return;(e.protocols.length?e.protocols:["UNKNOWN"]).forEach(g=>{let a=`${s} : ${e.port} / ${g}-${e.start_time}`;o.set(a,e)})}),o};var Pe=t=>t===-1?void 0:Temporal.Now.zonedDateTimeISO("UTC").subtract({days:t}).startOfDay().toInstant().toString();var vt=(t,o)=>o?t===o:!0;var I=i(p(),1);function yt(){let[t]=at(),{validProtocols:o,hostHistoryLimitEntitlement:e}=Xt(),s=ee(),n=Bt(),g=t.get(_)??"",a=t.get(S)??"",v=t.get(T)??"",x=t.get(u)??"",E=t.get(k)??"",U=ge(),[y,B]=(0,h.useState)(v),[H,lt]=(0,h.useState)(x),rt=(0,h.useMemo)(()=>({...ye,[u]:ve(o||[])}),[o]),{handleValueChange:D,handleSubmit:V,isValid:nt,isDirty:X,formState:K}=ue(rt,{[T]:y,[u]:H,[_]:g,[S]:a,[k]:E},_e,U,!0),G=(0,h.useCallback)(d=>{D(T,d),B(d)},[D]),M=(0,h.useCallback)(d=>{D(u,d),lt(d)},[D]),J=(0,h.useCallback)(d=>D(_,d),[D]),$=(0,h.useCallback)(d=>D(S,d),[D]),pt=v||x,mt=(0,h.useCallback)(()=>{G(""),M(""),t.delete(T),t.delete(u),s({pathname:n.pathname,search:`?${t.toString()}`})},[t,s,n.pathname,G,M]),z=(0,h.useMemo)(()=>Pe(e),[e]);return(0,I.jsxs)(Vt,{onSubmit:V,className:f.form,children:[(0,I.jsx)("div",{className:f.section,children:(0,I.jsx)(Ee,{startDate:g,endDate:a,isClearable:!1,withoutButton:!0,minDate:z,onStartDateChange:J,onEndDateChange:$})}),(0,I.jsx)("div",{className:f.divider,children:(0,I.jsx)(it,{variant:"line--vertical"})}),(0,I.jsxs)("div",{className:f.section,children:[(0,I.jsx)(Se,{port:y,onPortChange:G,protocol:H,onProtocolChange:M,portError:K.errors[T],protocolError:K.errors[u]}),(0,I.jsx)(Q,{"aria-label":"Apply filters",variant:X?w.PRIMARY:w.DEFAULT,type:"submit",disabled:!nt,children:"Apply"}),pt&&(0,I.jsx)(Q,{"data-testid":"clear-filters-button",className:f.clearFiltersButton,variant:w.TERTIARY,onClick:mt,type:"button",children:"Clear Filters"})]})]})}var m=i(Tt(),1);var et={legend:"Xas3j",item:"nuUZQ",rounded:"GInT3",pointed:"Z6oeV"};var Y=i(p(),1);function Ot({items:t,className:o}){return(0,Y.jsx)("div",{className:Jt(et.legend,o),children:t.map((e,s)=>{let n=e.shape===L.POINTED?et.pointed:et.rounded;return(0,Y.jsxs)("div",{className:et.item,children:[(0,Y.jsx)("div",{className:n,style:{backgroundColor:e.color}}),(0,Y.jsx)(A,{children:e.label})]},s)})})}var Nt={count:"DeWb-",gray8:"oqJ0O"};var ot=i(p(),1);function Pt({count:t}){return t===0?null:(0,ot.jsxs)("div",{className:Nt.count,children:[(0,ot.jsx)(A,{variant:ut.H5,children:"Results:"}),(0,ot.jsx)(A,{variant:ut.H4,className:Nt.gray8,children:t.toLocaleString()})]})}var Ae={emptyState:"lJbwj"};var At=i(p(),1);function Lt(){return(0,At.jsx)("div",{className:Ae.emptyState,children:(0,At.jsx)(te,{iconName:"bar-chart-horizontal",iconMode:"fill",title:"There are no results to display",children:"Try adjusting your filters and try again."})})}var N={content:"Lc-XB",title:"_4KDJk",subtitle:"vRRJ4",observed:"c4nnF",date:"_0jDM5",label:"s6vCd",name:"BtdaQ"};var bt=i(p(),1);function st({children:t}){return(0,bt.jsx)(me,{children:(0,bt.jsx)("div",{className:N.content,children:t})})}var C=i(p(),1);function xt({range:t}){return(0,C.jsxs)(st,{children:[(0,C.jsxs)("div",{className:N.title,children:[t.ip||t.hostname," : ",t.port," /"," ",t.protocols.join("|")," (",t.transport_protocol,")"]}),t.start_time&&(0,C.jsxs)("div",{className:N.subtitle,children:[(0,C.jsx)("div",{className:N.observed,children:"First Observed"}),(0,C.jsxs)("div",{className:N.date,children:[(0,C.jsx)(Zt,{timestamp:t.start_time.toString()}),(0,C.jsx)(it,{variant:"line--vertical",spacing:8}),(0,C.jsx)(qt,{timestamp:t.start_time.toString()})]})]})]})}var Ht=i(p(),1);function Mt({label:t}){return(0,Ht.jsx)(st,{children:(0,Ht.jsx)("div",{className:N.name,children:t})})}var Le=32,be=40,xe=2,He=10,Me=48,kt=470,F={top:20,right:20,bottom:40,left:200},ke=28,Fe=[{color:j[0],label:"Host",value:"host",shape:L.ROUNDED}];var W={wrapper:"LslfO",container:"qxDT0",chartContainer:"_5v4JG",bgOpacity:"Sjb8B",tooltip:"A7Hzh",dates:"Jq7v0",buttonContainer:"ikq78",chartFadeIn:"ftZcN",fadeIn:"UjLYF"};var We=(t,o)=>{if(o)return`${kt}px`;let e=t.length;if(e===0)return`${kt}px`;if(e<=xe)return`${Me+F.top+F.bottom}px`;let s=e>He?Le:be;return`${e*s+F.top+F.bottom}px`};var Ue=t=>t?ht(t)?.toZonedDateTimeISO("UTC").add({days:1}).subtract({nanoseconds:1}).toInstant().toString():null;var so=i(Ge(),1),r=i(p(),1);function Ft(){let{certId:t,timelineRanges:o,resultCount:e,nextPageToken:s}=fe(),n=oe(),g=(0,m.useRef)(null),[a]=at(),v=Gt(),x=$t(),[E,U]=(0,m.useState)([]),[y,B]=(0,m.useState)(null),[H,lt]=(0,m.useState)(!E.length),[rt,D]=(0,m.useState)(!1),V=a.get(_),nt=a.get(S),X=a.get(Rt),K=a.get(_t),G=a.get(St),M=X&&K&&G?`${X} : ${K} / ${G}`:null,J=(0,m.useMemo)(()=>Ue(nt),[nt]);(0,m.useEffect)(()=>{U(o),B(s),lt(!1)},[o,s]),(0,m.useEffect)(()=>{if(n.data&&rt){let{timelineRanges:l,nextPageToken:O}=Te(n.data);D(!1),U(q=>[...q,...l]),B(O)}},[n.data,rt]);let $=(0,m.useMemo)(()=>Ne(E),[E]),pt=(0,m.useCallback)(l=>{if(!l)return;let O=Ct(l,$),[q,dt]=l.name.split(" : "),[Ke,Je]=dt.split(" / "),ze=l.type,Ze=Ke,qe=Je,Qe=O?.start_time||Temporal.Now.instant();a.set(Rt,q),a.set(_t,Ze),a.set(St,qe),a.set(he,Qe.toString());let je=`/certificates/${t}/history/${ze}?${a}`;v(je)},[a,v,$,t]),mt=(0,m.useCallback)(()=>{if(y){D(!0);let l=new URLSearchParams(a);l.set(k,y),n.load(`/certificates/${t}/history?${l}`)}},[y,n.load,a]),z=Oe($,M),d=(0,m.useMemo)(()=>ae(z),[z]),we=(0,m.useMemo)(()=>d.map(l=>{let q=vt(l.name,M)?1:.3,dt=De(l.name,ke,!0);return{name:l.name,displayName:dt,subtitle:l.subtitle,opacity:q}}),[d,M]),Z=x.state==="loading"&&!X||H||!V||!J,Ye=(0,m.useMemo)(()=>We(d,Z),[d,Z]),Ve=(0,m.useMemo)(()=>E.length===0,[E]),ct=Z?(0,r.jsx)(Re,{}):Ve?(0,r.jsx)(Lt,{}):null,Xe=!Z&&y;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:W.wrapper,children:[(0,r.jsxs)("div",{className:W.container,children:[(0,r.jsxs)("div",{className:ct?W.bgOpacity:"",children:[(0,r.jsx)(Ot,{items:Fe}),!ct&&(0,r.jsx)(Pt,{count:e}),(0,r.jsx)(ne,{onClick:pt,children:(0,r.jsxs)("div",{ref:g,className:W.chartContainer,style:{height:Ye},children:[(0,r.jsx)(le,{render:({data:l})=>{if(!l)return(0,r.jsx)(r.Fragment,{});if(l.tooltipString)return(0,r.jsx)(Mt,{label:l.tooltipString});let O=Ct(l,$);return O?(0,r.jsx)(xt,{range:O}):(0,r.jsx)(r.Fragment,{})},offsetY:10}),V&&J&&!Z&&(0,r.jsx)("div",{className:W.chartFadeIn,children:(0,r.jsxs)(ie,{ref:g,data:z,colors:j,lineThickness:10,axis:{bottom:{showGridLines:!0,strokeWidth:.5,strokeDasharray:"3,3",textAnchor:"start",tickFontSize:12,strokeColor:R.TEXT_DISABLED,tickColor:R.TEXT_PRIMARY}},startDate:V,endDate:J,margin:F,border:{right:{strokeColor:R.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},left:{strokeColor:R.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},bottom:{strokeColor:R.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},top:{strokeColor:R.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"}},children:[(0,r.jsx)(pe,{range:we,strokeColor:R.BORDERLINE_SECONDARY,textColor:R.TEXT_PRIMARY,selectedColor:R.FEEDBACK_INFO_HOVER}),(0,r.jsx)(se,{render:({x:l,height:O})=>(0,r.jsx)("line",{x1:l,x2:l,y1:0,y2:O,stroke:R.TEXT_PLACEHOLDER,strokeDasharray:"3,3"})})]})})]})})]}),ct]}),(0,r.jsx)(Yt,{})]}),Xe&&(0,r.jsx)("div",{className:W.buttonContainer,children:(0,r.jsx)(Q,{type:"submit",variant:w.TERTIARY,iconRight:"arrow-down",iconRightMode:"line",onClick:mt,isLoading:n.state==="loading",children:"Load More"})})]})}var Wt={container:"v3Wy0"};var po=i(eo(),1),b=i(p(),1),un=de("Certificate Timeline","routes/certificates.$id"),gn=({currentUrl:t,nextUrl:o})=>{let e=new URL(t).searchParams,s=new URL(o).searchParams;return e.get(tt)!==s.get(tt)||e.get(T)!==s.get(T)||e.get(u)!==s.get(u)||e.get(_)!==s.get(_)||e.get(S)!==s.get(S)};function lo(){return(0,b.jsx)("div",{className:Wt.container,"data-testid":"event-history-tab",children:(0,b.jsx)(zt,{header:(0,b.jsx)(yt,{}),children:(0,b.jsx)(Ft,{})})})}function hn(){let t=wt(),o=Qt(),e=(0,$e.useContext)(Kt);return(0,b.jsx)("div",{className:Wt.container,children:Ut(t)&&jt(t.data)?(0,b.jsx)(ce,{accessState:o,errorCode:t.data.code,env:e}):(0,b.jsx)(re,{error:t})})}export{un as a,gn as b,lo as c,hn as d};
