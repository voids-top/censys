import{a as fe}from"/censys/build/_shared/chunk-RF63Q666.js";import{a as ue}from"/censys/build/_shared/chunk-LCN4BXNE.js";import{b as ge}from"/censys/build/_shared/chunk-KCNATP3M.js";import{a as me}from"/censys/build/_shared/chunk-BUVQHUPU.js";import{a as q,b as xt,c as Dt,d as de,e as he}from"/censys/build/_shared/chunk-4J4MYIT3.js";import{a as ce}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{a as Te}from"/censys/build/_shared/chunk-5PS6SCVZ.js";import{a as Xe}from"/censys/build/_shared/chunk-EAJKCKTG.js";import{a as oe}from"/censys/build/_shared/chunk-6GD6JLZ2.js";import{c as Et,d as yt}from"/censys/build/_shared/chunk-5B22H335.js";import{F as ee,b as Qt,d as jt,e as te}from"/censys/build/_shared/chunk-W5Y6TOHF.js";import{a as at}from"/censys/build/_shared/chunk-HG7D3PDC.js";import{b as pe}from"/censys/build/_shared/chunk-V6YEAJYZ.js";import{b as re,h as ie,k as H,q as ne,t as ae,u as se,v as le}from"/censys/build/_shared/chunk-YZ2VHXR4.js";import{a as d}from"/censys/build/_shared/chunk-RPAGMMSK.js";import{k as Zt}from"/censys/build/_shared/chunk-FQAS3FYV.js";import{e as zt}from"/censys/build/_shared/chunk-FH7VNUY3.js";import{c as Vt}from"/censys/build/_shared/chunk-B7DSLLNE.js";import{A as ft,B as b,C as G,D as ut,Ha as Kt,Ja as qt,aa as K,va as Jt,y as Xt,z as gt}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{d as L}from"/censys/build/_shared/chunk-6URBRDCL.js";import{a as Ft,c as Wt,e as Bt,i as Gt,k as Ut,m as $t,p as it,t as Yt,z as nt}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as Tt,c as p}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{c as Ve,d as a}from"/censys/build/_shared/chunk-2QEWK57A.js";var we=Ve((Nr,He)=>{He.exports={}});var Me=a(Tt(),1);var x=a(Tt(),1);var Ee="CERT_HISTORY_FORM",z="type",g="port",E="protocol",R="start",_="end",F="page_token",io=[{value:"all",label:"All"},{value:"host",label:"Host"},{value:"web",label:"Web"}];var f={form:"_7fXCb",section:"oAJv-",fieldContainer:"_--7Nr",field:"_60CCE",divider:"ubF5B"};var T=a(p(),1);function ye({port:t,onPortChange:i,protocol:o,onProtocolChange:r,portError:m,protocolError:u}){return(0,T.jsxs)("div",{className:f.section,children:[(0,T.jsxs)("div",{className:f.fieldContainer,children:[(0,T.jsx)("label",{className:f.label,htmlFor:g,children:(0,T.jsx)(b,{children:"Port"})}),(0,T.jsx)("div",{className:f.field,children:(0,T.jsx)(ut,{name:g,placeholder:"Number","aria-label":"Port number",contentLeft:(0,T.jsx)(gt,{name:"filter-3",mode:"line"}),value:t,onChange:s=>{i(s.target.value)},isFullWidth:!0,isValid:!m,autoComplete:"off"})})]}),(0,T.jsxs)("div",{className:f.fieldContainer,children:[(0,T.jsx)("label",{className:f.label,htmlFor:E,children:(0,T.jsx)(b,{children:"Protocol"})}),(0,T.jsx)("div",{className:f.field,children:(0,T.jsx)(ut,{name:E,placeholder:"Protocol","aria-label":"Protocol",contentLeft:(0,T.jsx)(gt,{name:"filter-3",mode:"line"}),value:o,onChange:s=>{r(s.target.value)},isFullWidth:!0,isValid:!u,autoComplete:"off"})})]})]})}var Je="Invalid asset type",Ke=`Port must be between ${Et} and ${yt}`,qe="Invalid protocol",ze=L.enum(["all","host","web"],{message:Je}),Ze=L.union([L.string().trim().refine(t=>/^\d+$/.test(t),{message:"Port must be between 1 and 65535"}).transform(t=>parseInt(t,10)).refine(t=>t>=Et&&t<=yt,{message:Ke}),L.literal("")]),De=t=>L.string().trim().refine(i=>i===""||t.some(o=>o.toLowerCase()===i.toLowerCase()),{message:qe}),xe=L.string().optional(),Qe=L.string().optional(),Re={[z]:ze,[g]:Ze,[F]:Qe,[R]:xe,[_]:xe};var _e=(t,i)=>Array.from(t.values()).reduce((o,r)=>{if(!r.ip&&!r.hostname||!r.start_time)return o;let m=r.protocols.join("|"),u=r.ip||r.hostname||"",s=`${u} : ${r.port} / ${m}`,A=r.ip?"host":"web",M=r.start_time,C=r.end_time?r.end_time:new Date().toISOString(),I={id:`${u}-${M}-${C}`,type:A,name:s,startDate:M,endDate:C,opacity:!i||i===s?1:.3,shape:A==="host"?H.ROUNDED:H.POINTED};return A==="host"?o.host.push(I):o.web.push(I),o},{host:[],web:[]}),_t=(t,i)=>{if(!t||!i)return;let[o,r]=t.name.split(" : "),[m]=r.split(" / "),u=`${o}-${m}-${t.startDate}`;return i.get(u)},Se=t=>{let i=new Map;return t.forEach(o=>{let m=`${o.ip||o.hostname}-${o.port}-${o.start_time}`;i.set(m,o)}),i};var ve=t=>{if(t===-1)return;let i=new Date;return i.setDate(i.getDate()-t),i.toISOString().split("T")[0]};var S=a(p(),1);function St(){let[t]=it(),{validProtocols:i,hostHistoryLimitEntitlement:o}=nt(),r=te(),m=Wt(),u=t.get(R)??"",s=t.get(_)??"",A=t.get(g)??"",M=t.get(E)??"",C=t.get(F)??"",$=fe(),[I,tt]=(0,x.useState)(A),[et,lt]=(0,x.useState)(M),pt=(0,x.useMemo)(()=>({...Re,[E]:De(i||[])}),[i]),{handleValueChange:D,handleSubmit:Y,isValid:V,isDirty:X,formState:ot}=Te(pt,{[g]:I,[E]:et,[R]:u,[_]:s,[F]:C},Ee,$,!0),N=(0,x.useCallback)(h=>{D(g,h),tt(h)},[D]),P=(0,x.useCallback)(h=>{D(E,h),lt(h)},[D]),mt=(0,x.useCallback)(h=>D(R,h),[D]),ct=(0,x.useCallback)(h=>D(_,h),[D]),k=A||M,rt=(0,x.useCallback)(()=>{N(""),P(""),t.delete(g),t.delete(E),r({pathname:m.pathname,search:`?${t.toString()}`})},[t,r,m.pathname,N,P]),dt=(0,x.useMemo)(()=>ve(o),[o]);return(0,S.jsxs)(Yt,{onSubmit:Y,className:f.form,children:[(0,S.jsx)("div",{className:f.section,children:(0,S.jsx)(ge,{startDate:u,endDate:s,isClearable:!1,withoutButton:!0,minDate:dt,onStartDateChange:mt,onEndDateChange:ct})}),(0,S.jsx)("div",{className:f.divider,children:(0,S.jsx)(at,{variant:"line--vertical"})}),(0,S.jsxs)("div",{className:f.section,children:[(0,S.jsx)(ye,{port:I,onPortChange:N,protocol:et,onProtocolChange:P,portError:ot.errors[g],protocolError:ot.errors[E]}),(0,S.jsx)(K,{"aria-label":"Apply filters",variant:X?G.PRIMARY:G.DEFAULT,type:"submit",disabled:!V,children:"Apply"}),k&&(0,S.jsx)(K,{"data-testid":"clear-filters-button",className:f.clearFiltersButton,variant:G.TERTIARY,onClick:rt,type:"button",children:"Clear Filters"})]})]})}var c=a(Tt(),1);var Z={legend:"Xas3j",item:"nuUZQ",rounded:"GInT3",pointed:"Z6oeV"};var U=a(p(),1);function vt({items:t,className:i}){return(0,U.jsx)("div",{className:Xt(Z.legend,i),children:t.map((o,r)=>{let m=o.shape===H.POINTED?Z.pointed:Z.rounded;return(0,U.jsxs)("div",{className:Z.item,children:[(0,U.jsx)("div",{className:m,style:{backgroundColor:o.color}}),(0,U.jsx)(b,{children:o.label})]},r)})})}var Ct={count:"DeWb-",gray8:"oqJ0O"};var Q=a(p(),1);function It({count:t}){return t===0?null:(0,Q.jsxs)("div",{className:Ct.count,children:[(0,Q.jsx)(b,{variant:ft.H5,children:"Results:"}),(0,Q.jsx)(b,{variant:ft.H4,className:Ct.gray8,children:t.toLocaleString()})]})}var j={emptyState:"lJbwj",loadingState:"_8-bMw",pulse:"XxqSo",svgContainer:"oaPDb"};var Ot=a(p(),1);function At(){return(0,Ot.jsx)("div",{className:j.emptyState,children:(0,Ot.jsx)(jt,{iconName:"bar-chart-horizontal",iconMode:"fill",title:"There are no results to display",children:"Try adjusting your filters and try again."})})}var e=a(p(),1);function Nt(){return(0,e.jsx)("div",{className:j.loadingState,children:(0,e.jsx)("div",{className:j.svgContainer,children:je})})}var je=(0,e.jsxs)("svg",{viewBox:"0 0 1156 550",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",children:[(0,e.jsx)("rect",{width:"100%",height:"100%",fill:d.SURFACE_BG_CARD_1}),(0,e.jsxs)("g",{stroke:d.SURFACE_BG_PAGE_0,strokeWidth:"1",children:[(0,e.jsx)("line",{x1:"200",y1:"22",x2:"200",y2:"532"}),(0,e.jsx)("line",{x1:"342.33",y1:"22",x2:"342.33",y2:"532"}),(0,e.jsx)("line",{x1:"484.67",y1:"22",x2:"484.67",y2:"532"}),(0,e.jsx)("line",{x1:"627.00",y1:"22",x2:"627.00",y2:"532"}),(0,e.jsx)("line",{x1:"769.33",y1:"22",x2:"769.33",y2:"532"}),(0,e.jsx)("line",{x1:"911.67",y1:"22",x2:"911.67",y2:"532"}),(0,e.jsx)("line",{x1:"1054.00",y1:"22",x2:"1054.00",y2:"532"})]}),(0,e.jsxs)("g",{stroke:d.SURFACE_BG_PAGE_0,strokeWidth:"1",children:[(0,e.jsx)("line",{x1:"200",y1:"22.00",x2:"1132",y2:"22.00"}),(0,e.jsx)("line",{x1:"200",y1:"78.67",x2:"1132",y2:"78.67"}),(0,e.jsx)("line",{x1:"200",y1:"135.33",x2:"1132",y2:"135.33"}),(0,e.jsx)("line",{x1:"200",y1:"192.00",x2:"1132",y2:"192.00"}),(0,e.jsx)("line",{x1:"200",y1:"248.67",x2:"1132",y2:"248.67"}),(0,e.jsx)("line",{x1:"200",y1:"305.33",x2:"1132",y2:"305.33"}),(0,e.jsx)("line",{x1:"200",y1:"362.00",x2:"1132",y2:"362.00"}),(0,e.jsx)("line",{x1:"200",y1:"418.67",x2:"1132",y2:"418.67"}),(0,e.jsx)("line",{x1:"200",y1:"475.33",x2:"1132",y2:"475.33"}),(0,e.jsx)("line",{x1:"200",y1:"532.00",x2:"1132",y2:"532.00"})]}),(0,e.jsxs)("g",{fill:d.BORDERLINE_SECONDARY,children:[(0,e.jsx)("rect",{x:"1030.87",y:"16.00",width:"100",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"945.47",y:"72.67",width:"90",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"858.29",y:"129.33",width:"60",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"924.12",y:"129.33",width:"90",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"753.32",y:"186.00",width:"45",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"735.53",y:"242.67",width:"190",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"673.26",y:"299.33",width:"50",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"728.41",y:"299.33",width:"100",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"457.98",y:"356.00",width:"230",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"351.23",y:"412.67",width:"80",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"315.65",y:"469.33",width:"110",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"248.04",y:"526.00",width:"70",height:"12",rx:"6"})]}),(0,e.jsxs)("g",{fill:d.BORDERLINE_SECONDARY,children:[(0,e.jsx)("rect",{x:"32",y:"16.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"72.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"129.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"186.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"242.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"299.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"356.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"412.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"469.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"526.00",width:"160",height:"12",rx:"6"})]})]});var O={content:"Lc-XB",title:"_4KDJk",subtitle:"vRRJ4",observed:"c4nnF",date:"_0jDM5",label:"s6vCd",name:"BtdaQ"};var Pt=a(p(),1);function st({children:t}){return(0,Pt.jsx)(pe,{children:(0,Pt.jsx)("div",{className:O.content,children:t})})}var v=a(p(),1);function Lt({range:t}){return(0,v.jsxs)(st,{children:[(0,v.jsxs)("div",{className:O.title,children:[t.ip||t.hostname," : ",t.port," /"," ",t.protocols.join("|")," (",t.transport_protocol,")"]}),t.start_time&&(0,v.jsxs)("div",{className:O.subtitle,children:[(0,v.jsx)("div",{className:O.observed,children:"First Observed"}),(0,v.jsxs)("div",{className:O.date,children:[(0,v.jsx)(Kt,{timestamp:t.start_time}),(0,v.jsx)(at,{variant:"line--vertical",spacing:8}),(0,v.jsx)(qt,{timestamp:t.start_time}),(0,v.jsx)("div",{className:O.label,children:"UTC"})]})]})]})}var bt=a(p(),1);function Ht({label:t}){return(0,bt.jsx)(st,{children:(0,bt.jsx)("div",{className:O.name,children:t})})}var Ce=32,Ie=40,Oe=2,Ae=10,Ne=48,wt=470,W={top:20,right:20,bottom:40,left:200},Pe=30,Le=[{color:q[0],label:"Host",value:"host",shape:H.ROUNDED}];var B={wrapper:"LslfO",container:"qxDT0",chartContainer:"_5v4JG",bgOpacity:"Sjb8B",tooltip:"A7Hzh",dates:"Jq7v0",buttonContainer:"ikq78",chartFadeIn:"ftZcN",fadeIn:"UjLYF"};var be=(t,i)=>{if(i)return`${wt}px`;let o=t.host.length+t.web.length;if(o===0)return`${wt}px`;if(o<=Oe)return`${Ne+W.top+W.bottom}px`;let r=o>Ae?Ce:Ie;return`${o*r+W.top+W.bottom}px`};var to=a(we(),1),n=a(p(),1);function Mt(){let{certId:t,timelineRanges:i,resultCount:o,nextPageToken:r}=nt(),m=ee(),u=(0,c.useRef)(null),[s]=it(),A=Bt(),M=Gt(),[C,$]=(0,c.useState)([]),[I,tt]=(0,c.useState)(null),[et,lt]=(0,c.useState)(!C.length),[pt,D]=(0,c.useState)(!1),Y=s.get(R),V=s.get(_),X=s.get(xt),ot=s.get(Dt),N=X?`${X} : ${ot}`:null;(0,c.useEffect)(()=>{$(i),tt(r),lt(!1)},[i,r]),(0,c.useEffect)(()=>{if(m.data&&pt){let{timelineRanges:l,nextPageToken:y}=m.data;D(!1),$(J=>[...J,...l]),tt(y)}},[m.data]);let P=(0,c.useMemo)(()=>Se(C),[C]),mt=(0,c.useCallback)(l=>{if(!l)return;let y=_t(l,P),J=l.name.split(" : ")[0],Be=l.type,Ge=y?.port.toString()||"",Ue=y?.transport_protocol||"",$e=y?.start_time||new Date().toISOString();s.set(xt,J),s.set(Dt,Ge),s.set(de,Ue),s.set(he,$e);let Ye=`/certificates/${t}/history/${Be}?${s}`;A(Ye)},[s,A,P]),ct=(0,c.useCallback)(()=>{if(I){D(!0);let l=new URLSearchParams(s);l.set(F,I),m.load(`/certificates/${t}/history?${l}`)}},[I,m.load,s]),k=_e(P,N),rt=(0,c.useMemo)(()=>ie(k),[k]),dt=(0,c.useMemo)(()=>rt.map(l=>{let y=!N||l.name===N?1:.3,J=ue(l.name,Pe,!0);return{name:l.name,displayName:J,subtitle:l.subtitle,opacity:y}}),[rt,N]),h=M.state==="loading"&&!X||et||!Y||!V,ke=(0,c.useMemo)(()=>be(k,h),[k,h]),Fe=(0,c.useMemo)(()=>C.length===0,[C]),ht=h?(0,n.jsx)(Nt,{}):Fe?(0,n.jsx)(At,{}):null,We=!h&&I;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:B.wrapper,children:[(0,n.jsxs)("div",{className:B.container,children:[(0,n.jsxs)("div",{className:ht?B.bgOpacity:"",children:[(0,n.jsx)(vt,{items:Le}),!ht&&(0,n.jsx)(It,{count:o}),(0,n.jsx)(re,{onClick:mt,children:(0,n.jsxs)("div",{ref:u,className:B.chartContainer,style:{height:ke},children:[(0,n.jsx)(se,{render:({data:l})=>{if(!l)return(0,n.jsx)(n.Fragment,{});if(l.tooltipString)return(0,n.jsx)(Ht,{label:l.tooltipString});let y=_t(l,P);return y?(0,n.jsx)(Lt,{range:y}):(0,n.jsx)(n.Fragment,{})},offsetY:10}),Y&&V&&!h&&(0,n.jsx)("div",{className:B.chartFadeIn,children:(0,n.jsxs)(ne,{ref:u,data:k,colors:q,lineThickness:10,axis:{bottom:{showGridLines:!0,strokeWidth:.5,strokeDasharray:"3,3",textAnchor:"start",tickFontSize:12,strokeColor:d.TEXT_DISABLED,tickColor:d.TEXT_PRIMARY}},startDate:Y,endDate:V,margin:W,border:{right:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},left:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},bottom:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},top:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"}},children:[(0,n.jsx)(le,{range:dt,strokeColor:d.BORDERLINE_SECONDARY,textColor:d.TEXT_PRIMARY,selectedColor:d.FEEDBACK_INFO_HOVER}),(0,n.jsx)(ae,{render:({x:l,height:y})=>(0,n.jsx)("line",{x1:l,x2:l,y1:0,y2:y,stroke:d.TEXT_PLACEHOLDER,strokeDasharray:"3,3"})})]})})]})})]}),ht]}),(0,n.jsx)($t,{})]}),We&&(0,n.jsx)("div",{className:B.buttonContainer,children:(0,n.jsx)(K,{type:"submit",variant:G.TERTIARY,iconRight:"arrow-down",iconRightMode:"line",onClick:ct,isLoading:m.state==="loading",children:"Load More"})})]})}var kt={container:"v3Wy0"};var oo=a(Xe(),1),w=a(p(),1),pi=ce("Certificate Timeline","routes/certificates.$id"),mi=({currentUrl:t,nextUrl:i})=>{let o=new URL(t).searchParams,r=new URL(i).searchParams;return o.get(z)!==r.get(z)||o.get(g)!==r.get(g)||o.get(E)!==r.get(E)||o.get(R)!==r.get(R)||o.get(_)!==r.get(_)};function eo(){return(0,w.jsx)("div",{className:kt.container,"data-testid":"event-history-tab",children:(0,w.jsx)(Jt,{header:(0,w.jsx)(St,{}),children:(0,w.jsx)(Mt,{})})})}function ci(){let t=Ut(),i=zt(),o=Qt(i),r=(0,Me.useContext)(Vt);return(0,w.jsx)("div",{className:kt.container,children:Ft(t)&&Zt(t.data)?(0,w.jsx)(me,{errorCode:t.data.code,orgState:o,env:r}):(0,w.jsx)(oe,{error:t})})}export{pi as a,mi as b,eo as c,ci as d};
