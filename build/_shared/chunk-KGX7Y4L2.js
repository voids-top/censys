import{a as j}from"/censys/build/_shared/chunk-LQXVLPA4.js";import{b as ae}from"/censys/build/_shared/chunk-2ZE7U5EB.js";import{a as X,b as K}from"/censys/build/_shared/chunk-PUNV2EUS.js";import{a as Me}from"/censys/build/_shared/chunk-I5BA26X4.js";import{b as ke}from"/censys/build/_shared/chunk-RAMDI2JB.js";import{a as _e}from"/censys/build/_shared/chunk-CJIEOTRC.js";import{b as He}from"/censys/build/_shared/chunk-M7IO6GB7.js";import{a as Re}from"/censys/build/_shared/chunk-HG7D3PDC.js";import{a as Pe}from"/censys/build/_shared/chunk-ZKAH2G64.js";import{c as F,d as Ve,s as Ae,t as Fe}from"/censys/build/_shared/chunk-HLRAT4GD.js";import{a as Le}from"/censys/build/_shared/chunk-W2GUOEY7.js";import{b as Ne}from"/censys/build/_shared/chunk-P2FXGQA2.js";import{d as Ie}from"/censys/build/_shared/chunk-FH7VNUY3.js";import{w as Se}from"/censys/build/_shared/chunk-KMD3IRPL.js";import{A as p,B as i,C as _,Ha as ie,Ja as re,Ma as De,Na as be,Ta as se,_ as we,aa as A,da as Ee,ha as Te,ia as Z,ja as Y,n as xe,o as Ce,q as ge,t as fe,va as Q,y as $,z as C}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{B as ve,c as W,e as ce,i as he,q as ye,z as ue}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as M,c as h}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as l}from"/censys/build/_shared/chunk-2QEWK57A.js";var T=l(M(),1);var Be="/censys/build/_assets/censeye-illustration-dark-CJQL4V5S.svg";var Je="/censys/build/_assets/censeye-illustration-CY7M6J3A.svg";var B={flexContainer:"Yom8U",rightColumn:"l5NeK",description:"NFfgZ"};var g=l(h(),1);function ne({onRunCenseye:o,isLoading:a}){let{theme:y}=Ie();return(0,g.jsx)(Q,{children:(0,g.jsxs)("div",{className:B.flexContainer,"data-testid":"discover-pivots-intro-card",children:[(0,g.jsx)("div",{className:B.leftColumn,children:(0,g.jsx)("img",{src:y==="theme-default"?Je:Be,alt:"Abstract illustration of host and pivot fields"})}),(0,g.jsxs)("div",{className:B.rightColumn,children:[(0,g.jsx)(i,{variant:p.H2,as:"h2",children:"Discover Pivots"}),(0,g.jsx)(i,{className:B.description,children:"CensEye uncovers hosts that match key-value pairs on this host, and can help you discover useful pivots."}),(0,g.jsx)(A,{onClick:()=>o(!1),disabled:a,isLoading:a,"data-testid":"intro-run-censeye-button",children:"Run CensEye"}),(0,g.jsx)(Le,{href:He,isExternal:!0,showExternalIcon:!0,shouldOmitOrg:!0,children:"Learn more about CensEye"})]})]})})}var te=l(M(),1);var Oe=l(M(),1);var J="jobId";var L={dropdownItem:"VQCkq",dropdownItemSelected:"Wxcu1",itemContent:"_4YdpW",itemContentLeft:"_6rv4V",itemContentRight:"Hxann",checkContainer:"bECmn"};var n=l(h(),1);function ee({job:o,selected:a,setDropdownOpen:y}){let d=W(),r=(0,Oe.useMemo)(()=>{let v=new URLSearchParams(d.search);return v.set(J,F(o.name)),`${d.pathname}?${v.toString()}`},[d.pathname,d.search]),c=K(o.asset);return(0,n.jsx)(fe,{asChild:!0,children:(0,n.jsxs)(Ne,{to:r,className:$(L.dropdownItem,a&&L.dropdownItemSelected),onClick:()=>y(!1),children:[(0,n.jsxs)("div",{className:L.itemContent,children:[(0,n.jsxs)("div",{className:L.itemContentLeft,children:[(0,n.jsxs)(i,{variant:p.SMALL_SEMIBOLD,children:[(0,n.jsx)(ie,{timestamp:o.create_time||""})," ",(0,n.jsx)(re,{timestamp:o.create_time||""})," UTC"]}),(0,n.jsxs)(i,{variant:p.SMALL,children:[o.result_count||0," interesting pivots"]})]}),(0,n.jsx)("div",{className:L.itemContentRight,children:c==="host"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i,{variant:p.SMALL,children:"Host version:"}),(0,n.jsxs)(i,{variant:p.SMALL,children:[(0,n.jsx)(ie,{timestamp:o.at_time||""})," ",(0,n.jsx)(re,{timestamp:o.at_time||""})," UTC"]})]})})]}),(0,n.jsx)("div",{className:L.checkContainer,children:a&&(0,n.jsx)(C,{name:"check",mode:"line",size:"lg"})})]})},o.name)}var P={dropdownTrigger:"D2ame",dropdownTriggerText:"Pd2Ls",dropdownContent:"GthzM",sectionHeader:"WnSgD",divider:"WMTes"};var m=l(h(),1);function le({jobHistory:o,currentJobName:a}){let[y,d]=(0,te.useState)(!1),r=(0,te.useMemo)(()=>o.findIndex(c=>c.name===a),[a,o]);return o.length===0?null:(0,m.jsx)("div",{children:(0,m.jsxs)(xe,{open:y,onOpenChange:d,children:[(0,m.jsxs)(Ce,{className:P.dropdownTrigger,children:[(0,m.jsxs)(i,{variant:p.DEFAULT_SEMIBOLD,className:P.dropdownTriggerText,children:["Run"," ",r>=0?o.length-r:o.length," ","of ",o.length]}),(0,m.jsx)(C,{name:"arrow-drop-down",mode:"line",size:"xl"})]}),(0,m.jsxs)(ge,{align:"start",className:P.dropdownContent,children:[(0,m.jsx)(i,{variant:p.H5,className:P.sectionHeader,children:"LATEST RUN"}),(0,m.jsx)(ee,{job:o[0],selected:r===0,setDropdownOpen:d}),o.length>1&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Re,{variant:"line--horizontal",className:P.divider}),(0,m.jsx)(i,{variant:p.H5,className:P.sectionHeader,children:"PREVIOUS RUNS"}),o.slice(1).map((c,v)=>(0,m.jsx)(ee,{job:c,selected:r===v+1,setDropdownOpen:d},c.name))]})]})]})})}var f=l(M(),1);var e={cardHeaderDescription:"-LXFR",cardHeaderRow:"BScF-",cardHeaderColumn:"_6uaqz",cardHeaderButtonContainer:"vVXeZ",cardHeaderTitle:"sgz-I",resultsContainer:"W-4fu",runInfo:"C8TL1",pivotListContainer:"-Xt2j",emptyPivotList:"xKZRK",emptyPivotListIcon:"W7gpD",emptyPivotListTitle:"p3O0b",emptyPivotListDescription:"Yl8lB",pivotListIcon:"GucZW",pivotsList:"rGkk0",pivotItem:"r7PBu",pivotCount:"_7Irwv",pivotCountIcon:"oR55x",pivotDetails:"htaEJ",pivotPair:"VJoGa",pivotEmpty:"ySeEU",pivotActions:"aGcbG",pivotField:"aHWkN",pivotValue:"_5OS3g",clipboardMessage:"_9aj2R",timeAgo:"_6X9bx",timeAgoIcon:"_8mcRf",timeAgoLabel:"P0u-F",timeAgoValue:"YaXVt",atTime:"VoEoy"};var S=l(h(),1);function Ue(){return(0,S.jsxs)("div",{className:e.emptyPivotList,children:[(0,S.jsx)("div",{className:e.emptyPivotListIcon,children:(0,S.jsx)(C,{name:"node-tree",mode:"",size:"xl"})}),(0,S.jsx)(i,{className:e.emptyPivotListTitle,variant:p.H1,children:"No pivots found"}),(0,S.jsx)(i,{className:e.emptyPivotListDescription,children:"While no potentially interesting key-value pairs were observed on this asset, further analysis may reveal deeper insights."})]})}var V=l(M(),1);var s=l(h(),1);function qe({pivot:o,onCopyToClipboard:a,nestedFields:y=new Set}){let d=o?.to_count?.and_field_value_pairs?.field_value_pairs??[],r=(0,V.useMemo)(()=>X(d,y),[d]),c=Se(r),v=(0,V.useCallback)(()=>{a(r)},[a,r]);return(0,s.jsxs)("div",{className:e.pivotItem,children:[(0,s.jsxs)("div",{className:e.pivotCount,children:[(0,s.jsx)(C,{className:e.pivotCountIcon,name:"computer",mode:"line",size:"lg"}),(0,s.jsx)(i,{variant:p.DEFAULT_SEMIBOLD,className:e.pivotCountNumber,children:(0,s.jsx)(we,{value:o.count})})]}),(0,s.jsx)("div",{className:e.pivotDetails,children:d.map(({field:E,value:u})=>(0,s.jsxs)("div",{className:e.pivotPair,children:[(0,s.jsx)(i,{className:e.pivotField,children:E.split(".").map((k,D)=>(0,s.jsxs)(V.Fragment,{children:[k,D<E.split(".").length-1&&(0,s.jsxs)(s.Fragment,{children:[".",(0,s.jsx)("wbr",{})]})]},D))}),(0,s.jsx)(i,{className:$(e.pivotValue,!u&&e.pivotEmpty),children:u||"(Empty)"})]},`${E}:${u}`))}),(0,s.jsxs)("div",{className:e.pivotActions,children:[(0,s.jsx)(se,{content:"Copy query",children:(0,s.jsx)(Ee,{variant:_.DEFAULT,iconName:"file-copy",iconMode:"line","aria-label":"Copy query",onClick:v})}),(0,s.jsx)(se,{content:"New search",children:(0,s.jsx)(Pe,{iconButton:{iconName:"search",iconMode:"line",["aria-label"]:`Search for ${r}`},link:{to:c,target:"_blank"}})})]})]})}var t=l(h(),1);function pe({pivotData:o,sortedPivots:a,isLoading:y,onRunCenseye:d,onExportToCSV:r,actions:c,atTime:v,timestamp:E,nestedFields:u=[]}){let[k,D]=(0,f.useState)(!1),[b,O]=(0,f.useState)(""),[I,U]=(0,f.useState)(""),q=(0,f.useMemo)(()=>new Set(u),[u]),G=(0,f.useCallback)(N=>{N||D(!1)},[]),z=(0,f.useCallback)(N=>{_e(N),O(N),D(!0)},[]);return(0,f.useEffect)(()=>{if(!o.request_time){U("");return}U(Me(new Date(o.request_time),new Date))},[o.request_time]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Q,{"data-testid":"pivot-results-card",header:(0,t.jsxs)("div",{className:e.cardHeaderRow,children:[(0,t.jsxs)("div",{className:e.cardHeaderColumn,children:[(0,t.jsxs)("div",{className:e.cardHeaderTitle,children:[(0,t.jsx)(i,{variant:p.H2,as:"h2",children:"Discover Pivots"}),(0,t.jsx)(be,{count:a.length,variant:De.NEUTRAL}),c]}),E||(0,t.jsx)(i,{className:e.cardHeaderDescription,children:"Explore assets with matching key-value pairs and discover interesting pivots."})]}),(0,t.jsxs)("div",{className:e.cardHeaderColumn,children:[(0,t.jsxs)("div",{className:e.cardHeaderButtonContainer,children:[a.length>0&&(0,t.jsx)(A,{variant:_.DEFAULT,onClick:r,disabled:y,iconLeft:"download",iconLeftMode:"line",children:"Export CSV"}),(0,t.jsx)(A,{variant:_.SECONDARY,onClick:()=>d(!0),isLoading:y,disabled:y,children:"Rerun CensEye"})]}),(0,t.jsx)("div",{className:e.runInfo,children:!E&&(0,t.jsxs)("div",{className:e.timeAgo,children:[(0,t.jsx)(C,{className:e.timeAgoIcon,name:"time",mode:"line",size:"xl"}),(0,t.jsx)(i,{className:e.timeAgoLabel,variant:p.H5,children:"LAST RUN"}),(0,t.jsx)(i,{className:e.timeAgoValue,variant:p.H5,children:I})]})})]})]}),children:[v&&(0,t.jsxs)("div",{className:e.atTime,children:[(0,t.jsxs)(i,{children:["Showing ",a.length," potentially interesting pivots."]}),(0,t.jsx)(j,{labelText:"Host version",tooltip:"Scan timestamp of the host version on which this CensEye analysis was run",timestamp:v})]}),(0,t.jsx)("div",{className:e.resultsContainer,children:a.length>0?(0,t.jsxs)("div",{className:e.pivotListContainer,children:[(0,t.jsx)("div",{className:e.pivotListIcon,children:(0,t.jsx)(C,{name:"computer",mode:"line",size:"xl"})}),(0,t.jsx)("div",{className:e.pivotsList,children:a.map((N,oe)=>(0,t.jsx)(qe,{nestedFields:q,pivot:N,onCopyToClipboard:z},oe))})]}):(0,t.jsx)(Ue,{})})]}),k&&(0,t.jsx)(Y,{title:"Copied to clipboard",behavior:Z.DISMISSIVE,onOpenChange:G,children:(0,t.jsx)("span",{className:e.clipboardMessage,children:b})})]})}var w=l(h(),1);function Ye(){let{job:o}=ae(),a=ce(),y=he(),d=W(),r=ue(),c=ve(),v=ye(),E=ke(),[u,k]=(0,T.useState)(null),{startPolling:D}=ae(),b=r.job,O=r?.job?.asset?Ve(r?.job?.asset):"",I=r.jobResults?.response||[],U=r.jobHistory||[],q=r.error,G=r.nestedFields||[],z=y.state==="submitting"||!!u,oe=K(b?.asset??"")==="host"?b?.at_time:void 0,de=b?.update_time||new Date().toISOString(),me=(0,T.useCallback)(()=>{let x=new FormData;x.set("csrf",E),v(x,{method:"post"})},[v,E]),Ge=(0,T.useCallback)(()=>{let x=I.map(R=>{let H=R?.to_count?.and_field_value_pairs?.field_value_pairs??[];return{Query:X(H,new Set(G)),Count:R?.count??""}});if(x&&x.length>0){let R=`Censys_Discover_Pivots_${O}_${new Date().toISOString()}`,H=Ae(x);Fe(R,H)}},[I,O]);return(0,T.useEffect)(()=>{c?.jobName&&(D(),k(c?.jobName))},[c?.jobName,D,k]),(0,T.useEffect)(()=>{if(o?.name===u&&o?.state==="STATE_COMPLETED"){let x=new URL(window.location.href);x.searchParams.set(J,F(o.name)),a(x.pathname+x.search)}},[o,a,u]),(0,T.useEffect)(()=>{if(u){let R=new URLSearchParams(d.search).get(J),H=F(u);R===H&&k(null)}},[u,d.search]),(0,w.jsxs)(w.Fragment,{children:[!b&&(0,w.jsx)(ne,{onRunCenseye:me,isLoading:z}),b?.state==="STATE_COMPLETED"&&I&&(0,w.jsx)(pe,{pivotData:{counts:I,query_duration_millis:0,errors:[],request_time:de},sortedPivots:I,isLoading:z,onRunCenseye:me,onExportToCSV:Ge,actions:(0,w.jsx)(le,{jobHistory:U,currentJobName:b?.name}),atTime:oe,timestamp:(0,w.jsx)(j,{labelText:"Run on",includeTooltip:!1,timestamp:de}),nestedFields:G}),q&&(0,w.jsx)(Y,{title:"Failed",variant:Te.CAUTION,behavior:Z.DISMISSIVE,children:q})]})}export{Ye as a};
