import{a as Be}from"/censys/build/_shared/chunk-YTHNDA7O.js";import{a as j}from"/censys/build/_shared/chunk-OFRBI5JW.js";import{b as ae}from"/censys/build/_shared/chunk-RBPDF7CE.js";import{a as X,b as K}from"/censys/build/_shared/chunk-VDD6BNAJ.js";import{a as Fe}from"/censys/build/_shared/chunk-EI6HYVQX.js";import{b as ve}from"/censys/build/_shared/chunk-EMHGEENV.js";import{a as Ve}from"/censys/build/_shared/chunk-CJIEOTRC.js";import{a as B,b as Re}from"/censys/build/_shared/chunk-KSE2ZBRQ.js";import{c as He}from"/censys/build/_shared/chunk-RWVGPSU7.js";import{a as Le}from"/censys/build/_shared/chunk-XTODG4BZ.js";import{q as _e,r as Ae}from"/censys/build/_shared/chunk-426SZY5O.js";import{a as Ie}from"/censys/build/_shared/chunk-TTVDHAYB.js";import{a as Pe}from"/censys/build/_shared/chunk-M5RKE22T.js";import{b as Ne}from"/censys/build/_shared/chunk-E7FS2ZQL.js";import{d as ke}from"/censys/build/_shared/chunk-ST66DGSY.js";import{z as Se}from"/censys/build/_shared/chunk-QJVHIZ52.js";import{$ as F,A as i,B as A,Ka as ie,Ma as re,Qa as De,Ra as be,Xa as se,ca as we,ea as Ee,ia as Te,ja as Z,ka as Y,n as xe,o as ge,p as Ce,s as fe,x as $,xa as Q,y as g,z as p}from"/censys/build/_shared/chunk-DN2SN5ZC.js";import{B as ue,c as W,e as ce,i as he,q as ye}from"/censys/build/_shared/chunk-JMZ2MZXD.js";import{b as h}from"/censys/build/_shared/chunk-ZST4CTCB.js";import{a as _}from"/censys/build/_shared/chunk-MOHCJWAV.js";import{e as l}from"/censys/build/_shared/chunk-2TWE7TSA.js";var T=l(_(),1);var Me="/censys/build/_assets/censeye-illustration-dark-CJQL4V5S.svg";var Je="/censys/build/_assets/censeye-illustration-CY7M6J3A.svg";var M={flexContainer:"Yom8U",rightColumn:"l5NeK",description:"NFfgZ"};var C=l(h(),1);function ne({onRunCenseye:o,isLoading:a}){let{theme:y}=ke();return(0,C.jsx)(Q,{children:(0,C.jsxs)("div",{className:M.flexContainer,"data-testid":"discover-pivots-intro-card",children:[(0,C.jsx)("div",{className:M.leftColumn,children:(0,C.jsx)("img",{src:y==="theme-default"?Je:Me,alt:"Abstract illustration of host and pivot fields"})}),(0,C.jsxs)("div",{className:M.rightColumn,children:[(0,C.jsx)(i,{variant:p.H2,as:"h2",children:"Discover Pivots"}),(0,C.jsx)(i,{className:M.description,children:"CensEye uncovers hosts that match key-value pairs on this host, and can help you discover useful pivots."}),(0,C.jsx)(F,{onClick:()=>o(!1),disabled:a,isLoading:a,"data-testid":"intro-run-censeye-button",children:"Run CensEye"}),(0,C.jsx)(Ie,{href:He,isExternal:!0,showExternalIcon:!0,shouldOmitOrg:!0,children:"Learn more about CensEye"})]})]})})}var te=l(_(),1);var Ue=l(_(),1);var J="jobId";var L={dropdownItem:"VQCkq",dropdownItemSelected:"Wxcu1",itemContent:"_4YdpW",itemContentLeft:"_6rv4V",itemContentRight:"Hxann",checkContainer:"bECmn"};var n=l(h(),1);function ee({job:o,selected:a,setDropdownOpen:y}){let m=W(),r=(0,Ue.useMemo)(()=>{let v=new URLSearchParams(m.search);return v.set(J,B(o.name)),`${m.pathname}?${v.toString()}`},[m.pathname,m.search]),c=K(o.asset);return(0,n.jsx)(fe,{asChild:!0,children:(0,n.jsxs)(Ne,{to:r,className:$(L.dropdownItem,a&&L.dropdownItemSelected),onClick:()=>y(!1),children:[(0,n.jsxs)("div",{className:L.itemContent,children:[(0,n.jsxs)("div",{className:L.itemContentLeft,children:[(0,n.jsxs)(i,{variant:p.SMALL_SEMIBOLD,children:[(0,n.jsx)(ie,{timestamp:o.create_time?.toString()||""})," ",(0,n.jsx)(re,{timestamp:o.create_time?.toString()||""})]}),(0,n.jsxs)(i,{variant:p.SMALL,children:[o.result_count||0," interesting pivots"]})]}),(0,n.jsx)("div",{className:L.itemContentRight,children:c==="host"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i,{variant:p.SMALL,children:"Host version:"}),(0,n.jsxs)(i,{variant:p.SMALL,children:[(0,n.jsx)(ie,{timestamp:o.at_time?.toString()||""})," ",(0,n.jsx)(re,{timestamp:o.at_time?.toString()||""})]})]})})]}),(0,n.jsx)("div",{className:L.checkContainer,children:a&&(0,n.jsx)(g,{name:"check",mode:"line",size:"lg"})})]})},o.name)}var S={dropdownTrigger:"D2ame",dropdownTriggerText:"Pd2Ls",dropdownContent:"GthzM",sectionHeader:"WnSgD",divider:"WMTes"};var d=l(h(),1);function le({jobHistory:o,currentJobName:a}){let[y,m]=(0,te.useState)(!1),r=(0,te.useMemo)(()=>o.findIndex(c=>c.name===a),[a,o]);return o.length===0?null:(0,d.jsx)("div",{children:(0,d.jsxs)(xe,{open:y,onOpenChange:m,children:[(0,d.jsxs)(ge,{className:S.dropdownTrigger,children:[(0,d.jsxs)(i,{variant:p.DEFAULT_SEMIBOLD,className:S.dropdownTriggerText,children:["Run"," ",r>=0?o.length-r:o.length," ","of ",o.length]}),(0,d.jsx)(g,{name:"arrow-drop-down",mode:"line",size:"xl"})]}),(0,d.jsxs)(Ce,{align:"start",className:S.dropdownContent,children:[(0,d.jsx)(i,{variant:p.H5,className:S.sectionHeader,children:"LATEST RUN"}),(0,d.jsx)(ee,{job:o[0],selected:r===0,setDropdownOpen:m}),o.length>1&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(Pe,{variant:"line--horizontal",className:S.divider}),(0,d.jsx)(i,{variant:p.H5,className:S.sectionHeader,children:"PREVIOUS RUNS"}),o.slice(1).map((c,v)=>(0,d.jsx)(ee,{job:c,selected:r===v+1,setDropdownOpen:m},c.name))]})]})]})})}var f=l(_(),1);var e={cardHeaderDescription:"-LXFR",cardHeaderRow:"BScF-",cardHeaderColumn:"_6uaqz",cardHeaderButtonContainer:"vVXeZ",cardHeaderTitle:"sgz-I",resultsContainer:"W-4fu",runInfo:"C8TL1",pivotListContainer:"-Xt2j",emptyPivotList:"xKZRK",emptyPivotListIcon:"W7gpD",emptyPivotListTitle:"p3O0b",emptyPivotListDescription:"Yl8lB",pivotListIcon:"GucZW",pivotsList:"rGkk0",pivotItem:"r7PBu",pivotCount:"_7Irwv",pivotCountIcon:"oR55x",pivotDetails:"htaEJ",pivotPair:"VJoGa",pivotEmpty:"ySeEU",pivotActions:"aGcbG",pivotField:"aHWkN",pivotValue:"_5OS3g",clipboardMessage:"_9aj2R",timeAgo:"_6X9bx",timeAgoIcon:"_8mcRf",timeAgoLabel:"P0u-F",timeAgoValue:"YaXVt",atTime:"VoEoy"};var P=l(h(),1);function Oe(){return(0,P.jsxs)("div",{className:e.emptyPivotList,children:[(0,P.jsx)("div",{className:e.emptyPivotListIcon,children:(0,P.jsx)(g,{name:"node-tree",mode:"",size:"xl"})}),(0,P.jsx)(i,{className:e.emptyPivotListTitle,variant:p.H1,children:"No pivots found"}),(0,P.jsx)(i,{className:e.emptyPivotListDescription,children:"While no potentially interesting key-value pairs were observed on this asset, further analysis may reveal deeper insights."})]})}var V=l(_(),1);var s=l(h(),1);function qe({pivot:o,onCopyToClipboard:a,nestedFields:y=new Set}){let m=o?.to_count?.and_field_value_pairs?.field_value_pairs??[],r=(0,V.useMemo)(()=>X(m,y),[m]),c=Se(r),v=(0,V.useCallback)(()=>{a(r)},[a,r]);return(0,s.jsxs)("div",{className:e.pivotItem,children:[(0,s.jsxs)("div",{className:e.pivotCount,children:[(0,s.jsx)(g,{className:e.pivotCountIcon,name:"computer",mode:"line",size:"lg"}),(0,s.jsx)(i,{variant:p.DEFAULT_SEMIBOLD,className:e.pivotCountNumber,children:(0,s.jsx)(Ee,{value:o.count})})]}),(0,s.jsx)("div",{className:e.pivotDetails,children:m.map(({field:E,value:u})=>(0,s.jsxs)("div",{className:e.pivotPair,children:[(0,s.jsx)(i,{className:e.pivotField,children:E.split(".").map((k,D)=>(0,s.jsxs)(V.Fragment,{children:[k,D<E.split(".").length-1&&(0,s.jsxs)(s.Fragment,{children:[".",(0,s.jsx)("wbr",{})]})]},D))}),(0,s.jsx)(i,{className:$(e.pivotValue,!u&&e.pivotEmpty),children:u||"(Empty)"})]},`${E}:${u}`))}),(0,s.jsxs)("div",{className:e.pivotActions,children:[(0,s.jsx)(se,{content:"Copy query",children:(0,s.jsx)(we,{variant:A.DEFAULT,iconName:"file-copy",iconMode:"line","aria-label":"Copy query",onClick:v})}),(0,s.jsx)(se,{content:"New search",children:(0,s.jsx)(Le,{iconButton:{iconName:"search",iconMode:"line",["aria-label"]:`Search for ${r}`},link:{to:c,target:"_blank"}})})]})]})}var t=l(h(),1);function pe({pivotData:o,sortedPivots:a,isLoading:y,onRunCenseye:m,onExportToCSV:r,actions:c,atTime:v,timestamp:E,nestedFields:u=[]}){let[k,D]=(0,f.useState)(!1),[b,U]=(0,f.useState)(""),[N,O]=(0,f.useState)(""),q=(0,f.useMemo)(()=>new Set(u),[u]),G=(0,f.useCallback)(I=>{I||D(!1)},[]),z=(0,f.useCallback)(I=>{Ve(I),U(I),D(!0)},[]);return(0,f.useEffect)(()=>{if(!o.request_time){O("");return}O(Fe(o.request_time,Temporal.Now.instant()))},[o.request_time]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Q,{"data-testid":"pivot-results-card",header:(0,t.jsxs)("div",{className:e.cardHeaderRow,children:[(0,t.jsxs)("div",{className:e.cardHeaderColumn,children:[(0,t.jsxs)("div",{className:e.cardHeaderTitle,children:[(0,t.jsx)(i,{variant:p.H2,as:"h2",children:"Discover Pivots"}),(0,t.jsx)(be,{count:a.length,variant:De.NEUTRAL}),c]}),E||(0,t.jsx)(i,{className:e.cardHeaderDescription,children:"Explore assets with matching key-value pairs and discover interesting pivots."})]}),(0,t.jsxs)("div",{className:e.cardHeaderColumn,children:[(0,t.jsxs)("div",{className:e.cardHeaderButtonContainer,children:[a.length>0&&(0,t.jsx)(F,{variant:A.DEFAULT,onClick:r,disabled:y,iconLeft:"download",iconLeftMode:"line",children:"Export CSV"}),(0,t.jsx)(F,{variant:A.SECONDARY,onClick:()=>m(!0),isLoading:y,disabled:y,children:"Rerun CensEye"})]}),(0,t.jsx)("div",{className:e.runInfo,children:!E&&(0,t.jsxs)("div",{className:e.timeAgo,children:[(0,t.jsx)(g,{className:e.timeAgoIcon,name:"time",mode:"line",size:"xl"}),(0,t.jsx)(i,{className:e.timeAgoLabel,variant:p.H5,children:"LAST RUN"}),(0,t.jsx)(i,{className:e.timeAgoValue,variant:p.H5,children:N})]})})]})]}),children:[v&&(0,t.jsxs)("div",{className:e.atTime,children:[(0,t.jsxs)(i,{children:["Showing ",a.length," potentially interesting pivots."]}),(0,t.jsx)(j,{labelText:"Host version",tooltip:"Scan timestamp of the host version on which this CensEye analysis was run",timestamp:v})]}),(0,t.jsx)("div",{className:e.resultsContainer,children:a.length>0?(0,t.jsxs)("div",{className:e.pivotListContainer,children:[(0,t.jsx)("div",{className:e.pivotListIcon,children:(0,t.jsx)(g,{name:"computer",mode:"line",size:"xl"})}),(0,t.jsx)("div",{className:e.pivotsList,children:a.map((I,oe)=>(0,t.jsx)(qe,{nestedFields:q,pivot:I,onCopyToClipboard:z},oe))})]}):(0,t.jsx)(Oe,{})})]}),k&&(0,t.jsx)(Y,{title:"Copied to clipboard",behavior:Z.DISMISSIVE,onOpenChange:G,children:(0,t.jsx)("span",{className:e.clipboardMessage,children:b})})]})}var w=l(h(),1);function Ye(){let{job:o}=ae(),a=ce(),y=he(),m=W(),r=Be(),c=ue(),v=ye(),E=ve(),[u,k]=(0,T.useState)(null),{startPolling:D}=ae(),b=r.job,U=r?.job?.asset?Re(r?.job?.asset):"",N=r.jobResults?.response||[],O=r.jobHistory||[],q=r.error,G=r.nestedFields||[],z=y.state==="submitting"||!!u,oe=K(b?.asset??"")==="host"?b?.at_time:void 0,me=b?.update_time||Temporal.Now.instant(),de=(0,T.useCallback)(()=>{let x=new FormData;x.set("csrf",E),v(x,{method:"post"})},[v,E]),Ge=(0,T.useCallback)(()=>{let x=N.map(R=>{let H=R?.to_count?.and_field_value_pairs?.field_value_pairs??[];return{Query:X(H,new Set(G)),Count:R?.count??""}});if(x&&x.length>0){let R=`Censys_Discover_Pivots_${U}_${Temporal.Now.instant().toString()}`,H=_e(x);Ae(R,H)}},[N,U]);return(0,T.useEffect)(()=>{c?.jobName&&(D(),k(c?.jobName))},[c?.jobName,D,k]),(0,T.useEffect)(()=>{if(o?.name===u&&o?.state==="STATE_COMPLETED"){let x=new URL(window.location.href);x.searchParams.set(J,B(o.name)),a(x.pathname+x.search)}},[o,a,u]),(0,T.useEffect)(()=>{if(u){let R=new URLSearchParams(m.search).get(J),H=B(u);R===H&&k(null)}},[u,m.search]),(0,w.jsxs)(w.Fragment,{children:[!b&&(0,w.jsx)(ne,{onRunCenseye:de,isLoading:z}),b?.state==="STATE_COMPLETED"&&N&&(0,w.jsx)(pe,{pivotData:{counts:N,query_duration_millis:0,errors:[],request_time:me},sortedPivots:N,isLoading:z,onRunCenseye:de,onExportToCSV:Ge,actions:(0,w.jsx)(le,{jobHistory:O,currentJobName:b?.name}),atTime:oe?.toString(),timestamp:(0,w.jsx)(j,{labelText:"Run on",includeTooltip:!1,timestamp:me.toString()}),nestedFields:G}),q&&(0,w.jsx)(Y,{title:"Failed",variant:Te.CAUTION,behavior:Z.DISMISSIVE,children:q})]})}export{Ye as a};
