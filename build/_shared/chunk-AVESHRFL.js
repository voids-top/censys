import{a as E,b as No,d as M,e as $}from"/build/_shared/chunk-S2IH2R6L.js";import{a as Io,b as ho,c as Bo,d as Co,e as Lo}from"/build/_shared/chunk-MBWLTMZZ.js";import{a as W,c as vo,d as Eo}from"/build/_shared/chunk-5B22H335.js";import{a as K}from"/build/_shared/chunk-WK35ORSL.js";import{a as Y}from"/build/_shared/chunk-ZKAH2G64.js";import{A as b,B as m,C as T,D as co,G as lo,H as uo,I as go,J as po,K as mo,L as Ao,M as fo,P as To,R as ko,S as So,T as bo,Ta as yo,aa as G,ba as V,da as H,y as so,z}from"/build/_shared/chunk-UYH4GQ7Z.js";import{d as U}from"/build/_shared/chunk-6URBRDCL.js";import{c as io}from"/build/_shared/chunk-Q6RLBVJI.js";import{a as x,c as g}from"/build/_shared/chunk-XJAPXWKX.js";import{d as c}from"/build/_shared/chunk-2QEWK57A.js";var eo=c(x(),1);var w=c(x(),1);var N=c(x(),1);function Ko(o,e,r){let a=r;if(typeof window<"u"&&window.localStorage){let t=window.localStorage.getItem(o);if(t!==null)try{let n=e.safeParse(JSON.parse(t));n.success&&(a=n.data)}catch{}}return a}function Wo(o,e){typeof window<"u"&&window.localStorage&&localStorage.setItem(o,JSON.stringify(e))}function Ro(o,e,r){let[a,t]=(0,N.useState)(o),n=(0,N.useCallback)(i=>{t(l=>{let p=typeof i=="function"?i(l):i;return Wo(e,p),p})},[]);return(0,N.useEffect)(()=>{t(Ko(e,r,o))},[]),[a,n]}var Z={backgroundActionsErrorItem:"fmKIm",backgroundActionsErrorTitle:"l3N5U"};var _=c(g(),1);function J({title:o,description:e}){return(0,_.jsxs)("li",{className:Z.backgroundActionsErrorItem,children:[(0,_.jsx)(m,{className:Z.backgroundActionsErrorTitle,children:o}),(0,_.jsx)(m,{variant:b.DEFAULT,as:"span",children:e})]})}var q="background-actions-item-dialog";var h={actionItemHeader:"td-rr",actionItemTriggerContainer:"e2dND",actionItemTriggerTitle:"nRnfC",actionItemTriggerIconContainer:"sn-NM",actionItemIcon:"n84v1",actionItemsContainer:"snrgI",slideDown:"WKZC5",slideUp:"PCtTA",actionItems:"v6Cq8"};var f=c(g(),1);function Q({title:o,titleRight:e,children:r}){return(0,f.jsx)(Io,{collapsible:!0,type:"single",defaultValue:q,children:(0,f.jsxs)(ho,{value:q,children:[(0,f.jsx)(Bo,{className:h.actionItemHeader,children:(0,f.jsxs)("div",{className:h.actionItemTriggerContainer,children:[(0,f.jsx)("div",{className:h.actionItemTriggerTitle,children:o}),(0,f.jsxs)("div",{className:h.actionItemTriggerIconContainer,children:[(0,f.jsx)(Co,{asChild:!0,children:(0,f.jsx)(H,{iconName:"arrow-up-s",iconMode:"line",size:V.LARGE,variant:T.GHOST,className:h.actionItemIcon,"aria-label":"Toggle background actions details"})}),e]})]})}),(0,f.jsx)(Lo,{className:h.actionItemsContainer,children:(0,f.jsx)("div",{className:h.actionItems,children:r})})]})})}var Do=c(x(),1);var P={backgroundActionItem:"fTG0-",backgroundActionItemTitle:"zDz-6",backgroundActionItemNoComparisons:"Iawr-",backgroundActionItemActions:"_0su4Y"};var B=c(g(),1);function X({scannedAssetHref:o,screenshotHref:e,onClose:r,successMessage:a,successLinkText:t,noComparisonsText:n}){let i=io(),l=(0,Do.useMemo)(()=>{if(!e)return!1;try{let p=new URL(e,window.location.origin);return i.pathname===p.pathname}catch{return!1}},[i.pathname,e]);return(0,B.jsxs)("li",{className:P.backgroundActionItem,children:[(0,B.jsx)(m,{as:"span",className:P.backgroundActionItemTitle,children:a}),(0,B.jsxs)("div",{className:P.backgroundActionItemActions,children:[o?(0,B.jsx)(Y,{button:{variant:T.TERTIARY,iconRight:"arrow-right",iconRightMode:"line",onClick:r},link:{to:o},children:t}):(0,B.jsx)(m,{as:"span",className:P.backgroundActionItemNoComparisons,children:n}),e?(0,B.jsx)(Y,{button:{variant:T.TERTIARY,iconRight:"arrow-right",iconRightMode:"line"},link:{to:e,reloadDocument:l},children:"View screenshot"}):null]})]})}var R={actionItemStatus:"uEc12",loading:"_6oQkK",success:"Iaw-R",error:"kM26d"};var O=c(g(),1),xo={["LOADING"]:{element:(0,O.jsx)("div",{className:R.loading,"aria-hidden":!0,children:(0,O.jsx)(go,{variant:uo.SYSTEM,size:lo.MEDIUM})}),ariaLabel:"Background action in progress",ariaLive:"polite",ariaBusy:!0,role:"progressbar"},["SUCCESS"]:{element:(0,O.jsx)(z,{name:"checkbox-circle",mode:"fill",size:"2xl",className:R.success}),ariaLabel:"Background action completed successfully",ariaLive:"polite",ariaBusy:!1,role:"status"},["ERROR"]:{element:(0,O.jsx)(z,{name:"close-circle",mode:"fill",size:"2xl",className:R.error}),ariaLabel:"Background action failed with an error",ariaLive:"assertive",ariaBusy:!1,role:"status"}};var Mo=c(g(),1);function j({status:o}){let{element:e,ariaLabel:r,ariaLive:a,ariaBusy:t,role:n}=xo[o];return(0,Mo.jsx)("div",{className:R.actionItemStatus,"aria-label":r,"aria-live":a,"aria-busy":t,role:n,"aria-atomic":"true",children:e})}var _o=U.object({isOpen:U.boolean(),status:U.nativeEnum(E)});var oo={loadingTitle:"Scanning...",successTitle:"Rescan Completed",errorTitle:"Error",loadingDescription:"Scanning... This may take a few minutes.",loadingSubtitle:"You can continue working while we rescan this asset. This window will remain active and notify you when it is complete.",successMessage:"Rescan Complete!",successLinkText:"View differences in results",noComparisonsText:"No new comparisons",loadingAriaLabel:"Background Actions are loading",errorAriaLabel:"Background Actions have an error",successAriaLabel:"Background Actions",closeAriaLabel:"Close background actions dialog"},Po={...oo},xe={loadingTitle:"Running CensEye...",successTitle:"CensEye Run Completed",errorTitle:"CensEye Run Error",loadingDescription:"This may take a few seconds.",loadingSubtitle:"You can continue working while we analyze this asset. This window will remain active and notify you when it is complete.",successMessage:"Analysis Complete!",successLinkText:"View results",noComparisonsText:"No new analysis data",loadingAriaLabel:"Asset analysis in progress",errorAriaLabel:"Asset analysis has an error",successAriaLabel:"Asset analysis completed",closeAriaLabel:"Close analysis dialog"};var y={backgroundActionsContent:"_335Y0",slideUp:"YFhse",backgroundActionsContainer:"jdMpp",backgroundActionsTitle:"cYU4c",backgroundActionsLoadingContainer:"_644sD",backgroundActionsLoadingTitle:"_6J6E0",backgroundActionsLoadingDescription:"KTEoW",backgroundActionsListContainer:"IAO5-"};var s=c(g(),1);function Oo({status:o,backgroundActions:e,errors:r,className:a,messages:t={},localStateKey:n="app/background-actions-dialog"}){let i={...oo,...t},[l,p]=Ro({isOpen:!1,status:o},n,_o);(0,w.useEffect)(()=>{(o!==l.status||o==="LOADING")&&p({isOpen:!0,status:o})},[o,e,l.status,p]);let C=(0,w.useCallback)(d=>{if(!d)return;let{offsetHeight:S,offsetWidth:D}=d,v=document.documentElement;l.isOpen?(v.style.setProperty("--background-actions-dialog-width",`${D}px`),v.style.setProperty("--background-actions-dialog-height",`${S}px`)):(v.style.removeProperty("--background-actions-dialog-width"),v.style.removeProperty("--background-actions-dialog-height"))},[l.isOpen]),A=(0,w.useCallback)(d=>{p(S=>({...S,isOpen:d}))},[p]),L=o==="LOADING"?i.loadingTitle:o==="SUCCESS"?i.successTitle:i.errorTitle;return(0,s.jsx)(po,{open:l.isOpen,onOpenChange:A,modal:!1,children:(0,s.jsx)(mo,{children:(0,s.jsx)(Ao,{ref:C,className:so(y.backgroundActionsContent,a),"aria-describedby":void 0,role:"alertdialog",onInteractOutside:d=>{d.preventDefault()},onOpenAutoFocus:d=>{d.preventDefault()},children:(0,s.jsx)("div",{className:y.backgroundActionsContainer,children:(0,s.jsx)(Q,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{status:o}),(0,s.jsx)(fo,{asChild:!0,children:(0,s.jsx)(m,{variant:b.DEFAULT_SEMIBOLD,className:y.backgroundActionsTitle,children:L})})]}),titleRight:o==="LOADING"?null:(0,s.jsx)(H,{iconName:"close",iconMode:"line",size:V.LARGE,variant:T.GHOST,onClick:()=>A(!1),"aria-label":i.closeAriaLabel}),children:(0,s.jsx)($o,{status:o,errors:r,backgroundActions:e,onClose:()=>A(!1),messages:i})})})})})})}function $o({status:o,errors:e,backgroundActions:r,onClose:a,messages:t}){switch(o){case"LOADING":return(0,s.jsxs)("div",{className:y.backgroundActionsLoadingContainer,"aria-label":t.loadingAriaLabel,children:[(0,s.jsx)(m,{variant:b.DEFAULT_SEMIBOLD,className:y.backgroundActionsLoadingTitle,children:t.loadingDescription}),(0,s.jsx)(m,{variant:b.DEFAULT_ITALICS,className:y.backgroundActionsLoadingDescription,children:t.loadingSubtitle})]});case"ERROR":return(0,s.jsx)("ul",{className:y.backgroundActionsListContainer,"aria-label":t.errorAriaLabel,children:e?.map((n,i)=>(0,s.jsx)(J,{title:n.title,description:n.description},`${n.description}-${i}`))});case"SUCCESS":return(0,s.jsx)("ul",{className:y.backgroundActionsListContainer,"aria-label":t.successAriaLabel,children:r?.map((n,i)=>(0,s.jsx)(X,{scannedAssetHref:n.scannedAssetHref??"",screenshotHref:n.screenshotHref??"",onClose:a,successMessage:t.successMessage,successLinkText:t.successLinkText,noComparisonsText:t.noComparisonsText},`${n.scannedAssetHref}-${i}`))})}}function wo(o){return o?.filter(e=>e.completed).map(e=>{let r=e.target,a=r?.serviceId?.ip??r?.hostPort?.ip;if(!a)return{scannedAssetHref:void 0};let t=e.scanTime??e.createTime,n=e.tasks.reduce((d,S)=>S.updateTime?d?new Date(S.updateTime)>new Date(d)?S.updateTime:d:S.updateTime:d,""),i=r?.serviceId?.port??r?.hostPort?.port;if(!t||!n||!i)return{scannedAssetHref:void 0};let l=new URL(`/hosts/${a}/events/compare`,window.location.origin);l.searchParams.set("at_time_a",t),l.searchParams.set("at_time_b",n),l.searchParams.set("port",i.toString());let p=l.pathname+l.search,C=!!e?.hasScreenshot,A=new URL(`/hosts/${a}`,window.location.origin),L=C?A.pathname+A.search:void 0;return{scannedAssetHref:p,screenshotHref:L}}).filter(K)??[]}function Uo(o){let e=o?.filter(K).flatMap(r=>r.tasks.filter(a=>a.status===W.TrackedScan_Task_Status.REJECTED||a.status===W.TrackedScan_Task_Status.TIMED_OUT)).map(r=>({title:"Scan Error",description:r.description}));return e?.length?e:null}var Vo=c(g(),1);function Go(){let{trackedScans:o,status:e}=M(),r=(0,eo.useMemo)(()=>wo(o),[o]),a=(0,eo.useMemo)(()=>e==="ERROR"?Uo(o):null,[o,e]);return e===null?null:(0,Vo.jsx)(Oo,{status:e,errors:a,backgroundActions:r,messages:Po})}var k=c(x(),1);var to="live-scan-label",ro="live-scan-port-input",no="live-scan-port-error";var I={content:"_97GoN",form:"Q0qRQ",title:"y1TZM",description:"NeIa4",inputContainer:"z9kAN",input:"fBVg4",error:"EW7Cp",scanInProgressBtn:"CboT7",spin:"mwr43"};var u=c(g(),1);function Ho({entityId:o,rescanResourceType:e,className:r,scanTime:a}){let[t,n]=(0,k.useState)(null),[i,l]=(0,k.useState)(!1),[p,C]=(0,k.useState)(""),{status:A,isPerformingDiscoveryScanOnAsset:L}=M(),d=(0,k.useMemo)(()=>L(o),[L,o,A]),{isSubmitting:S,errorText:D,submit:v,Form:Fo}=$({isScanInProgress:A==="LOADING",rescanResourceType:e,entityId:o,port:p,scanTime:a}),zo=(0,k.useCallback)(Yo=>{let F=Yo.target.value;if(n(null),F===""){C("");return}No.safeParse(F).error?n("Invalid port number"):C(F)},[]),ao=(0,k.useMemo)(()=>D||t||null,[D,t]);return(0,k.useEffect)(()=>{A==="LOADING"&&(l(!1),C(""))},[A]),A==="LOADING"&&d?(0,u.jsx)(yo,{content:"Live Discovery in progress",triggerClassName:r,children:(0,u.jsx)(G,{variant:T.DEFAULT,iconLeft:"loader-4",iconLeftMode:"line",iconRight:"arrow-down-s",iconRightMode:"line",disabled:!0,"aria-label":"Live Discovery in progress",className:I.scanInProgressBtn,children:"Scanning..."})}):(0,u.jsxs)(To,{open:i,onOpenChange:l,children:[(0,u.jsx)(ko,{asChild:!0,children:(0,u.jsx)(G,{variant:T.DEFAULT,iconLeft:"scan-2",iconLeftMode:"line",iconRight:i?"arrow-up-s":"arrow-down-s",iconRightMode:"line",className:r,disabled:A==="LOADING",children:"Live Discovery"})}),(0,u.jsx)(So,{children:(0,u.jsx)(bo,{className:I.content,"aria-labelledby":to,align:"end",children:(0,u.jsxs)(Fo,{onSubmit:v,className:I.form,noValidate:!0,children:[(0,u.jsx)("label",{id:to,htmlFor:ro,className:I.title,children:(0,u.jsx)(m,{variant:b.H5,as:"span",children:"Live Discovery"})}),(0,u.jsx)(m,{variant:b.SMALL,className:I.description,children:"Enter a port to scan for service changes on asset."}),(0,u.jsxs)("div",{className:I.inputContainer,children:[(0,u.jsx)(co,{placeholder:"Port","aria-label":"Port number","aria-invalid":!!t,"aria-describedby":t?no:void 0,value:p,onChange:zo,className:I.input,type:"number",min:vo,max:Eo,id:ro,required:!0}),(0,u.jsx)(G,{"aria-label":"Start port scan",variant:T.PRIMARY,iconLeft:"scan-2",iconLeftMode:"line",disabled:!p||!!t,isLoading:S,type:"submit",children:"Scan"})]}),ao&&(0,u.jsx)(m,{id:no,variant:b.SMALL,className:I.error,role:"alert",children:ao})]})})})]})}export{Ko as a,Wo as b,xe as c,Oo as d,Ho as e,Go as f};
