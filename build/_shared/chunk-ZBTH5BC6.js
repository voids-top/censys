import{a as Ye}from"/censys/build/_shared/chunk-PSJYO5QU.js";import{b as Ue}from"/censys/build/_shared/chunk-UWRUBCCK.js";import{a as pe,b as Ee}from"/censys/build/_shared/chunk-45E72UWH.js";import{a as xe}from"/censys/build/_shared/chunk-XOYFCC6C.js";import{a as De}from"/censys/build/_shared/chunk-5PS6SCVZ.js";import{a as Re,b as Ke,c as Ve,d as ke,e as we}from"/censys/build/_shared/chunk-MBWLTMZZ.js";import{b as Be}from"/censys/build/_shared/chunk-RAMDI2JB.js";import{a as Z}from"/censys/build/_shared/chunk-CJIEOTRC.js";import{e as We}from"/censys/build/_shared/chunk-W5Y6TOHF.js";import{a as Fe}from"/censys/build/_shared/chunk-HG7D3PDC.js";import{k as Ie}from"/censys/build/_shared/chunk-HLRAT4GD.js";import{a as Pe}from"/censys/build/_shared/chunk-W2GUOEY7.js";import{h,j as L}from"/censys/build/_shared/chunk-KMD3IRPL.js";import{$ as D,A as q,B as C,C as M,D as w,E as Me,F as be,U as ge,V as Ne,W as ne,Wa as de,X as le,Xa as b,Ya as Q,aa as R,ab as He,da as ie,fa as he,ga as Le,ra as ve,z as J}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{d as P}from"/censys/build/_shared/chunk-6URBRDCL.js";import{q as Ce}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as k,c as S}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as m}from"/censys/build/_shared/chunk-2QEWK57A.js";var qe=[{label:"Custom",value:"CUSTOM"},{label:"Slack",value:"SLACK"},{label:"Microsoft Teams",value:"TEAMS"}],x={SLACK:`{
  "event_type": "{{.EventType}}",
  "timestamp": "{{.Timestamp}}",
  "collection_id": "{{.CollectionId}}",
  "collection_name": "{{.CollectionName}}",
  "org_id": "{{.OrganizationId}}",
  "query": "{{.CollectionQuery}}",
  "asset_id": "{{.AssetId}}",
  "asset_type": "{{.AssetType}}",
  "url": "https://platform.censys.io/collections/{{.CollectionId}}?org={{.OrganizationId}}",
  "evidence": "{{.AssetType}} {{.AssetId}} was {{.EventVerb}} to the collection on {{.Timestamp}} because it matched the collection query."
}`,TEAMS:`{
  "@type": "MessageCard",
  "@context": "http://schema.org/extensions",
  "summary": "New Notification",
  "themeColor": "0076D7",
  "title": "Asset {{.EventVerb}} Collection",
  "text": "{{.AssetType}} {{.AssetId}} was {{.EventVerb}} collection {{.CollectionId}} on {{.Timestamp}} based on the collection query.",
  "sections": [
    {
      "activityTitle": "",
      "facts": [
        {
          "name": "Collection Id",
          "value": "{{.CollectionId}}"
        },
        {
          "name": "Collection Name",
          "value": "{{.CollectionName}}"
        }
      ],
      "markdown": true
    }
  ],
  "potentialAction": [
    {
      "@type": "OpenUri",
      "name": "Learn More",
      "targets": [
        {
          "os": "default",
          "uri": "https://platform.censys.io/collections/{{.CollectionId}}?org={{.OrganizationId}}"
        }
      ]
    }
  ]
}`},{WEBHOOK_EVENT_TYPE_UNRECOGNIZED:Oo,UNRECOGNIZED_ENUM_KEY:uo,...io}=h.WebhookEventType;var f={WEBHOOK_NAME:"webhookName",URL:"url",PAYLOAD_TEMPLATE:"payloadTemplate",ASSET_TYPE:"assetType",...io},To="new-webhook-form",me="test-webhook-form",_o="edit-webhook-form",e={WEBHOOK_FORM:{NAMES:f,SCHEMAS:{[f.WEBHOOK_NAME]:P.string({required_error:"A Webhook name is required."}).min(1,{message:"A Webhook name is required."}).max(100,{message:"Webhook name must be less than 100 characters."}),[f.URL]:P.string().min(1,{message:"A URL is required."}).url({message:"Must be a valid URL."}),[h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]:P.enum(["on","off"]),[h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]:P.enum(["on","off"]),[f.PAYLOAD_TEMPLATE]:P.optional(P.string()),[f.ASSET_TYPE]:P.enum([L.AssetEvent_AssetType.HOST,L.AssetEvent_AssetType.CERT,L.AssetEvent_AssetType.WEB])},INITIAL_VALUES:{[f.WEBHOOK_NAME]:"",[f.URL]:"",[h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]:"on",[h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]:"on",[f.PAYLOAD_TEMPLATE]:x.SLACK,[f.ASSET_TYPE]:L.AssetEvent_AssetType.CERT}}};var c=m(k(),1),$=m(k(),1);var ze=m(k(),1),v=m(S(),1);function j({copyable:s,onCopy:t,...E}){let[A,n]=(0,ze.useState)(!1);return(0,v.jsx)(w,{...E,type:A?"text":"password",contentLeft:(0,v.jsx)(J,{name:"lock",mode:"line"}),contentRight:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ie,{iconName:A?"eye":"eye-off",iconMode:"line",variant:M.GHOST,onClick:()=>n(O=>!O),disabled:E.disabled,type:"button","aria-label":A?"Hide password":"Show password"}),s&&(0,v.jsx)(ie,{iconName:"file-copy",iconMode:"line",variant:M.GHOST,onClick:t,disabled:E.disabled,type:"button","aria-label":"Copy password"})]})})}var g=m(k(),1);var X={headerInputContainer:"_88sZS",removeButton:"q-S29",header:"_0OvjJ"};var H=m(S(),1);function Ge({index:s,initialKey:t,initialValue:E,onRemove:A,onChange:n,disabled:O}){let[u,I]=(0,g.useState)(t),l=(0,g.useMemo)(()=>u?"":"Header Name is required",[u]),[a,T]=(0,g.useState)(E),B=(0,g.useMemo)(()=>a?"":"Value is required",[a]);(0,g.useEffect)(()=>{n(s,u,a,!u||!a)},[u,a,s,n]);let N=(0,g.useCallback)(()=>{Z(a)},[a]);return(0,H.jsxs)("div",{className:X.headerInputContainer,children:[(0,H.jsxs)(C,{variant:q.H5,className:X.header,children:["Header ",s+1]}),(0,H.jsx)(b,{label:"Header Name",required:!0,labelFor:`header-name-${s}`,errorText:l,children:(0,H.jsx)(w,{id:`header-name-${s}`,isFullWidth:!0,value:u,onChange:_=>I(_.target.value),disabled:O})}),(0,H.jsx)(b,{label:"Value",required:!0,labelFor:`header-value-${s}`,errorText:B,children:(0,H.jsx)(j,{id:`header-value-${s}`,isFullWidth:!0,copyable:!0,onCopy:N,onChange:_=>T(_.target.value),value:a,disabled:O})}),(0,H.jsx)(R,{onClick:()=>A(s),iconLeft:"delete-bin",iconLeftMode:"line",className:X.removeButton,variant:M.ALERT,size:D.SMALL,type:"button",disabled:O,children:"Remove"})]})}var K=m(k(),1);function Je(s=[]){let[t,E]=(0,K.useState)(s.map((l,a)=>a)),[A,n]=(0,K.useState)(s.reduce((l,a,T)=>(l[T]={key:a.name,value:a.value},l),{})),O=(0,K.useCallback)(()=>{E(l=>{let a=l[l.length-1]??-1;return[...l,a+1]})},[]),u=(0,K.useCallback)(l=>{E(a=>a.filter(T=>T!==l)),n(a=>{let T={...a};return delete T[l],T})},[]),I=(0,K.useCallback)((l,a,T,B)=>{n(N=>({...N,[l]:{key:a,value:T,error:B}}))},[]);return{headerIndices:t,headers:A,addHeaderIndex:O,removeHeaderIndex:u,onHeaderChange:I}}function z(s){return s.replace(/\s+/g,"").trim()}var V=m(k(),1);var y={payload:"h03QH",assetTypeGroup:"iKgoq",payloadTemplateExampleContainer:"JjXid",payloadLabel:"DvRzf",accordionHeader:"pWjYS",accordionTrigger:"_7HBA-",accordionTriggerContent:"jLL52",payloadTemplateInputArea:"kz6Hk",formButton:"pVFyV"};var o=m(S(),1);function ce({formState:s,handleValueChange:t,handleBlur:E,handleChange:A,payloadTemplateExample:n,setPayloadTemplateExample:O,currentPayloadTemplate:u}){let[I,l]=(0,V.useState)(!1),a=(0,V.useCallback)(()=>{l(_=>!_)},[]),T=(0,V.useCallback)(_=>{O(_),_==="CUSTOM"&&t(e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE,u)},[t]),B=(0,V.useCallback)(()=>{Z(u)},[u]),N=(0,V.useCallback)(_=>{n==="CUSTOM"&&E(_)},[E,n]);return(0,o.jsx)(Re,{type:"single",collapsible:!0,children:(0,o.jsxs)(Ke,{value:"advanced-settings-open","data-testid":"toggle-payload-template-button",children:[(0,o.jsx)(Ve,{className:y.accordionHeader,children:(0,o.jsx)(ke,{"data-testid":"advanced-settings-trigger",onClick:a,className:y.accordionTrigger,children:(0,o.jsxs)("div",{className:y.accordionTriggerContent,children:[(0,o.jsx)(C,{as:"span",children:"Advanced Settings"}),(0,o.jsx)(J,{name:I?"arrow-up-s":"arrow-down-s",mode:"line"})]})})}),(0,o.jsx)(we,{children:(0,o.jsxs)("div",{className:y.payloadTemplateExampleContainer,children:[(0,o.jsxs)("div",{className:y.payloadLabel,children:[(0,o.jsx)(C,{children:"Customize Your Webhook Payload"}),(0,o.jsxs)(C,{variant:q.SMALL,children:["Use the ",(0,o.jsx)("strong",{children:"Custom"})," option to define your own webhook payload structure using available template variables. This gives you full control over the data sent to your endpoint."]}),(0,o.jsxs)(C,{variant:q.SMALL,children:["Need a starting point? Select one of our predefined formats for"," ",(0,o.jsx)("strong",{children:"Slack"})," or ",(0,o.jsx)("strong",{children:"Microsoft Teams"}),", then switch back to ",(0,o.jsx)("strong",{children:"Custom"})," to tailor it to your needs."]})]}),(0,o.jsxs)("div",{className:y.payload,children:[(0,o.jsx)(be,{"aria-label":"Payload Template",name:"payload-template-example",options:qe,onValueChange:T,defaultValue:n,valueProps:{placeholder:"Select payload template"}}),(0,o.jsxs)(He,{className:y.assetTypeGroup,name:"assetType",value:s.values.assetType,onValueChange:_=>t(f.ASSET_TYPE,_),"aria-label":"Asset Type",children:[(0,o.jsx)(Q,{wrapperClassName:y.radio,label:"Certificate",value:L.AssetEvent_AssetType.CERT,"aria-label":"Certificate"}),(0,o.jsx)(Q,{wrapperClassName:y.radio,label:"Host",value:L.AssetEvent_AssetType.HOST,"aria-label":"Host"}),(0,o.jsx)(Q,{wrapperClassName:y.radio,label:"Web Property",value:L.AssetEvent_AssetType.WEB,"aria-label":"Web Property"})]})]}),(0,o.jsx)(b,{errorText:s.errors[e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE],children:(0,o.jsx)(Me,{className:y.payloadTemplateInputArea,name:e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE,"data-testid":"payload-template-input-area",id:"payload-template",isFullWidth:!0,autoComplete:"off",onBlur:N,onChange:A,rows:12,value:u,spellCheck:!1,disabled:n!=="CUSTOM"})}),(0,o.jsx)(R,{className:y.formButton,size:D.SMALL,variant:M.DEFAULT,onClick:B,"data-testid":"copy-payload-template-button",type:"button","aria-label":"Copy payload template",iconLeft:"clipboard",iconLeftMode:"line",children:"Copy"})]})})]})})}var Y={testWebhookContainer:"YF1xG",tabsContent:"N4fm-",tabsList:"IAWae",responseTrigger:"QOnOb"};var d=m(S(),1);function Oe({statusCode:s,requestHeaders:t,requestBody:E,responseHeaders:A,responseBody:n,responseError:O}){return(0,d.jsx)("div",{className:Y.testWebhookContainer,children:(0,d.jsxs)(ge,{defaultValue:"request",children:[(0,d.jsxs)(Ne,{className:Y.tabsList,children:[(0,d.jsx)(ne,{value:"request",children:"Request"}),(0,d.jsx)(ne,{value:"response",children:(0,d.jsxs)("div",{className:Y.responseTrigger,children:["Response",(0,d.jsx)(xe,{statusCode:s})]})})]}),(0,d.jsxs)(le,{value:"request",className:Y.tabsContent,children:[(0,d.jsx)(pe,{headers:t}),(0,d.jsx)(Ee,{label:"Body",content:E,fallbackText:"No Body"})]}),(0,d.jsx)(le,{value:"response",className:Y.tabsContent,children:O?(0,d.jsx)(Le,{variant:he.ERROR,children:O}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(pe,{headers:A}),(0,d.jsx)(Ee,{label:"Body",content:n,fallbackText:"No Body"})]})})]})})}var F={accordionItem:"_1Mvtv",accordionHeader:"F-AxJ",trigger:"VHVp-",triggerIcon:"lENIn",accordionTrigger:"_2Va8Q",card:"N36jQ",column:"YUP8Z",headersContainer:"VfnSh",addHeaderButton:"F-mc2",eventTypesContainer:"S2-8T",formButton:"QnSQZ"};var r=m(S(),1);function yt({formKey:s,existingWebhook:t,collections:E,submitTestWebhook:A,testWebhookResponse:n,fetcherState:O,submitButtonTextLoading:u,submitButtonText:I}){let[l,a]=(0,$.useState)("CUSTOM"),T=Be(),B=(0,c.useMemo)(()=>Ie(E),[E]),[N,_]=(0,$.useState)(B.filter(i=>t?.collection_ids?.includes(i.value))),[Qe,ee]=(0,$.useState)(),{isLoading:Ze,errorMessage:ue,status:Te}=Ue(s),_e=(0,c.useCallback)(()=>ee(void 0),[]),{headerIndices:je,headers:W,addHeaderIndex:Xe,removeHeaderIndex:$e,onHeaderChange:eo}=Je(t?.headers),Ae=(0,c.useMemo)(()=>{if(t?.payload_template){if(z(t.payload_template)===z(x.TEAMS))return"TEAMS";if(z(t.payload_template)===z(x.SLACK))return"SLACK"}return"CUSTOM"},[t]);(0,c.useEffect)(()=>{a(Ae)},[Ae]);let ye=Ce(),oo=We(),G=(0,c.useCallback)(i=>{let U=N.map(lo=>lo.value),se=JSON.stringify(Object.values(W)),no=JSON.stringify(U);return{...i,headers:se,collectionIds:no,payloadTemplate:l!=="CUSTOM"?x[l]:i[e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE]}},[W,N,l]),to=(0,c.useCallback)(i=>{let U={...G(i),fetcherKey:me,csrf:T};A(U,{method:"POST"})},[A,G,T,s]),ao=(0,c.useCallback)((i,U)=>{let se=G(i);ye(se,U)},[W,G,ye,s]),{handleBlur:oe,handleChange:te,handleValueChange:ae,handleSubmit:ro,isDirty:so,formState:p}=De(e.WEBHOOK_FORM.SCHEMAS,{[e.WEBHOOK_FORM.NAMES.WEBHOOK_NAME]:t?.display_name||e.WEBHOOK_FORM.INITIAL_VALUES.webhookName,[e.WEBHOOK_FORM.NAMES.URL]:t?.webhook_url||e.WEBHOOK_FORM.INITIAL_VALUES.url,[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]:t&&(t.event_types.includes(h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET)?"on":"off")||e.WEBHOOK_FORM.INITIAL_VALUES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET,[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]:t&&(t.event_types.includes(h.WebhookEventType.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET)?"on":"off")||e.WEBHOOK_FORM.INITIAL_VALUES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET,[e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE]:t&&t.payload_template?t.payload_template:e.WEBHOOK_FORM.INITIAL_VALUES.payloadTemplate,[e.WEBHOOK_FORM.NAMES.ASSET_TYPE]:e.WEBHOOK_FORM.INITIAL_VALUES.assetType},s,ao),re=(0,c.useMemo)(()=>p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]==="on"||p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]==="on",[p.values]),fe=(0,c.useMemo)(()=>Boolean(p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_NAME]&&p.values[e.WEBHOOK_FORM.NAMES.URL]&&Object.values(W).every(i=>!i.error)&&re),[W,re,p]),Se=(0,c.useMemo)(()=>l==="CUSTOM"?p.values[e.WEBHOOK_FORM.NAMES.PAYLOAD_TEMPLATE]:x[l],[p.values,l]);return(0,c.useEffect)(()=>{Te==="HAS_SUCCESS"&&oo("/settings/webhooks")},[Te]),(0,c.useEffect)(()=>{ee(ue)},[ue]),(0,c.useEffect)(()=>{n?.errorMessage&&ee(n.errorMessage)},[n?.errorMessage]),(0,r.jsxs)(Ye,{cancelFallbackUrl:"/settings/webhooks",onSubmit:i=>{_e(),ro(i)},errorMessage:Qe,title:"Webhooks (Optional)",subtitle:(0,r.jsxs)(C,{children:["Reference the documentation for detailed information on how to use and create"," ",(0,r.jsx)(Pe,{href:"https://docs.censys.com/docs/platform-collections-webhooks",isExternal:!0,children:"webhooks"}),"."]}),submitButtonTextLoading:u,submitButtonText:I,isLoading:Ze,isDirty:so,isValid:fe,hideContainer:!0,dismissError:_e,children:[(0,r.jsxs)("div",{className:F.column,children:[(0,r.jsx)("div",{className:F.row,children:(0,r.jsx)(b,{label:"Webhook Name",required:!0,labelFor:"webhook-name",errorText:p.errors[e.WEBHOOK_FORM.NAMES.WEBHOOK_NAME],children:(0,r.jsx)(w,{id:"webhook-name",name:e.WEBHOOK_FORM.NAMES.WEBHOOK_NAME,isFullWidth:!0,autoComplete:"off",onBlur:oe,onChange:te,value:p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_NAME]})})}),(0,r.jsx)("div",{className:F.urlContainer,children:(0,r.jsx)(b,{label:"URL",required:!0,labelFor:"webhook-url",errorText:p.errors[e.WEBHOOK_FORM.NAMES.URL],children:(0,r.jsx)(j,{name:e.WEBHOOK_FORM.NAMES.URL,id:"webhook-url",isFullWidth:!0,autoComplete:"off",onBlur:oe,onChange:te,value:p.values[e.WEBHOOK_FORM.NAMES.URL]})})}),(0,r.jsx)(b,{label:"Collections",children:(0,r.jsx)(ve,{name:"collectionIds",placeholder:"Select collections",options:B,onChange:_,selectedOptions:N})}),(0,r.jsxs)("div",{className:F.headersContainer,children:[(0,r.jsx)(C,{children:"Optional Custom Header"}),je.map(i=>(0,r.jsx)(Ge,{index:i,initialKey:W[i]?.key,initialValue:W[i]?.value,onRemove:$e,onChange:eo},i)),(0,r.jsx)(R,{iconLeft:"add",iconLeftMode:"fill",variant:M.GHOST,className:F.addHeaderButton,onClick:Xe,size:D.SMALL,type:"button",children:"Add Header"})]}),(0,r.jsx)(b,{label:"Event Types",required:!0,errorText:p.errors[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]||p.errors[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]||!re?"Please select at least one event type":void 0,children:(0,r.jsxs)("div",{className:F.eventTypesContainer,children:[(0,r.jsx)(de,{id:"assets-added",label:"Assets Added","aria-label":"Assets Added",name:e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET,checked:p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET]==="on",onCheckedChange:i=>ae(e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_ADD_ASSET,i?"on":"off")}),(0,r.jsx)(de,{id:"assets-removed",label:"Assets Removed","aria-label":"Assets Removed",name:e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET,checked:p.values[e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET]==="on",onCheckedChange:i=>ae(e.WEBHOOK_FORM.NAMES.WEBHOOK_EVENT_TYPE_COLLECTION_REMOVE_ASSET,i?"on":"off")})]})}),(0,r.jsx)(Fe,{variant:"line--horizontal",size:"100%"}),(0,r.jsx)(ce,{formState:p,handleValueChange:ae,handleBlur:oe,handleChange:te,payloadTemplateExample:l,setPayloadTemplateExample:a,currentPayloadTemplate:Se}),(0,r.jsx)(R,{"data-testid":"test-webhook-button",onClick:i=>{i.preventDefault(),to({...p.values,payloadTemplate:Se})},value:me,disabled:!fe,className:F.formButton,isLoading:O==="loading"||O==="submitting",type:"button",variant:M.SECONDARY,children:"Test Webhook"})]}),n?.response&&(0,r.jsx)(Oe,{statusCode:n.response.status_code,requestBody:n.response.request?.body,requestHeaders:n.response.request?.headers,responseBody:n.response.response?.body,responseHeaders:n.response.response?.headers,responseError:n.response.error})]})}export{To as a,me as b,_o as c,yt as d};
