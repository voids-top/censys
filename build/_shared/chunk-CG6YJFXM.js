import{a as ze}from"/censys/build/_shared/chunk-RF63Q666.js";import{a as J}from"/censys/build/_shared/chunk-BVX6X5MK.js";import{a as Qe}from"/censys/build/_shared/chunk-5PS6SCVZ.js";import{a as so}from"/censys/build/_shared/chunk-EAJKCKTG.js";import{a as qe}from"/censys/build/_shared/chunk-6GD6JLZ2.js";import{c as ie,h as Ke}from"/censys/build/_shared/chunk-ZMYU5ULY.js";import{a as ke}from"/censys/build/_shared/chunk-3JU625ZU.js";import{c as We}from"/censys/build/_shared/chunk-M7IO6GB7.js";import{A as Ge,B as Ve,b as Pe,d as z}from"/censys/build/_shared/chunk-W5Y6TOHF.js";import{a as Be}from"/censys/build/_shared/chunk-6XVOHWMX.js";import{i as He,v as Ye}from"/censys/build/_shared/chunk-HLRAT4GD.js";import{a as be}from"/censys/build/_shared/chunk-W2GUOEY7.js";import{j as ve}from"/censys/build/_shared/chunk-FQAS3FYV.js";import{e as De}from"/censys/build/_shared/chunk-FH7VNUY3.js";import{c as Fe}from"/censys/build/_shared/chunk-B7DSLLNE.js";import{H as le,o as xe,p as we,q as se,r as Q,s as t,t as Ue}from"/censys/build/_shared/chunk-KMD3IRPL.js";import{A as D,B as h,C as Se,D as Ce,F as ne,Wa as Le,Xa as q,Z as he,aa as Ae,bb as ae,ua as Ie,va as ye,y as re,z as V}from"/censys/build/_shared/chunk-UYH4GQ7Z.js";import{a as Oe,c as ge,d as te,k as Te,l as Me,m as Ne,t as _e}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as G,c as R}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{d as E}from"/censys/build/_shared/chunk-2QEWK57A.js";var m=E(G(),1);var n=E(G(),1);var N={inputContainer:"aJvQq",inputBar:"wtsWm",optionsContainer:"mod7I",selectedItem:"a4QO4",optionItem:"C5M-9",matchingText:"YDpiw",fullText:"_81nqq"};var pe=E(R(),1);function Je(e,i){if(!i)return e;let c=e.split(new RegExp(`(${i})`,"gi"));return(0,pe.jsx)("span",{className:N.fullText,children:c.map((l,M)=>l.toLowerCase()===i.toLowerCase()?(0,pe.jsx)("b",{className:N.matchingText,children:l},M):l)})}var g=E(R(),1);function ce({options:e,name:i,label:c,selectedOption:l="",onSelect:M,onChange:b,onFocus:L,onBlur:v,defaultPageSize:w=15,errorText:$,required:F,contentLeft:U,placeholder:p="Enter Field",className:k}){let H=(0,n.useRef)(null),K=(0,n.useRef)([]),P=(0,n.useRef)(null),[B,x]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(w),[I,A]=(0,n.useState)(l),[o,d]=(0,n.useState)(l),[u,f]=(0,n.useState)(-1),[S,O]=(0,n.useState)("IDLE"),y=(0,n.useCallback)(r=>{O("INPUT"),x(!0),L?.(r)},[]),X=(0,n.useCallback)(r=>{O("IDLE"),x(!1),v?.(r)},[]),j=(0,n.useCallback)(()=>{P.current&&(P.current.focus(),O("SELECT"))},[]),oo=(0,n.useCallback)(r=>{let s=r.target.value;O("INPUT"),d(s),A(s),f(-1),I&&s===""&&M?.(s),b?.(r)},[]),ee=(0,n.useMemo)(()=>o?e.filter(r=>r.toLowerCase().includes(o?.toLowerCase())):e,[e,o]),C=(0,n.useMemo)(()=>ee.slice(0,W),[W,ee]),to=(0,n.useCallback)(r=>{if(r.key==="ArrowDown"){r.preventDefault(),O("SELECT");let s=Math.min(u+1,C.length-1);f(s),A(C[s]||I||"")}else if(r.key==="ArrowUp")if(r.preventDefault(),O("SELECT"),u===0)f(-1),A(o);else{let s=Math.max(u-1,0);f(s),A(C[s]||I||"")}else if(r.key==="Enter"&&u>=0){O("IDLE");let s=C[u];A(C[u]),d(C[u]),f(-1),M?.(s)}else r.key==="Escape"&&(r.preventDefault(),O("IDLE"),f(-1))},[u,C]),ro=(0,n.useMemo)(()=>S==="SELECT"?I:o,[S,I,o]),no=(0,n.useCallback)(()=>{f(-1)},[]),ao=(0,n.useCallback)(r=>()=>{O("IDLE"),A(r),d(r),f(-1),M?.(r)},[]);(0,n.useEffect)(()=>{let r=new IntersectionObserver(([oe])=>{oe.isIntersecting&&Y(io=>io+w)},{threshold:.1}),s=H.current;return s&&r.observe(s),()=>{s&&r.unobserve(s)}},[B]),(0,n.useEffect)(()=>{u!==null&&K.current[u]?.scrollIntoView({behavior:"smooth",block:"center"})},[u]);let fe=(0,g.jsx)(Ce,{ref:P,isFullWidth:!0,id:i,name:i,placeholder:p,value:ro,type:"search",onFocus:y,onBlur:X,onChange:oo,onKeyDown:to,className:N.inputBar,contentRight:(0,g.jsx)(V,{"data-testid":"autocomplete-dropdown-icon",onClick:j,name:"arrow-down-s",mode:"line","aria-hidden":!0}),autoComplete:"off",role:"combobox","aria-controls":"autocomplete-search-options","aria-expanded":S!=="IDLE",contentLeft:U});return(0,g.jsxs)("div",{className:re(N.inputContainer,k),children:[c?(0,g.jsx)(q,{label:c,labelFor:i,errorText:$,required:F,children:fe}):fe,S!=="IDLE"&&(0,g.jsxs)("ul",{role:"listbox",className:N.optionsContainer,onMouseMove:no,id:"autocomplete-search-options",children:[C.map((r,s)=>(0,g.jsx)("li",{role:"option","aria-selected":u===s,ref:oe=>K.current[s]=oe,className:re(s===u&&N.selectedItem,N.optionItem),onMouseDown:ao(r),children:(0,g.jsx)(h,{children:Je(r,o)})},r)),(0,g.jsx)("li",{role:"option",className:N.optionItem,ref:H,children:ee.length>C.length&&(0,g.jsx)(h,{children:"load more"})})]})]})}function Ze(e){return e.type!=="object"&&e.type!=="nested"}var T={createReportBreakdownRow:"gjP8G",breakdownFieldInput:"CZOC9",createReportCardBody:"-rGgV",generateReportButton:"wrPPk",tooltip:"mySvw",tooltipIcon:"_0OrTQ",tooltipText:"dv2ov",reportBuilderLink:"o86-r"};var a=E(R(),1);function Ee(){let e=J(),i=ke(()=>"/api/fields",[]),c=ge(),l=he(),M=He(),b=(0,m.useMemo)(()=>{let o=M?.collection_id,d=o?`/collections/${o}/report`:"/search/report",u=c.pathname.includes("json")?"/data/json":"/data/table";return d+u},[M,c.pathname]),L=(0,m.useMemo)(()=>{let o=new Set;for(let d of i.data??[])d.type==="nested"&&o.add(d.path);return o},[i.data]),v=ze(b),{handleBlur:w,handleChange:$,handleValueChange:F,handleSubmit:U,formState:p,isValid:k}=Qe(t.REPORT_FORM.SCHEMAS,{[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]:e.field||"",[t.REPORT_FORM.NAMES.BUCKET_NUM]:e.num_buckets||xe,[t.REPORT_FORM.NAMES.QUERY_FILTER]:e.filter_query||"true",[t.REPORT_FORM.NAMES.COUNT_BY]:e.count_by||Q,[t.REPORT_FORM.NAMES.QUERY]:e.q||""},t.REPORT_FORM.FORM_KEY,v,!0),H=(0,m.useCallback)(o=>{F(t.REPORT_FORM.NAMES.BUCKET_NUM,o)},[p.values]),K=(0,m.useCallback)(o=>{o?F(t.REPORT_FORM.NAMES.QUERY_FILTER,"true"):F(t.REPORT_FORM.NAMES.QUERY_FILTER,"false")},[p.values]),P=(0,m.useCallback)(o=>{o&&F(t.REPORT_FORM.NAMES.COUNT_BY,o)},[p.values]),B=(0,m.useMemo)(()=>{if(i.data){let o=p.values[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD];return Ye(o||"",i.data.filter(d=>Ze(d)).map(d=>d.path),l)}return[]},[i?.data,p,l]),x=(0,m.useMemo)(()=>k&&B.includes(p.values[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]),[k,p.values]),[W,Y]=(0,m.useState)([]);(0,m.useEffect)(()=>{let o=p.values[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],d=p.values[t.REPORT_FORM.NAMES.COUNT_BY];if(B.includes(o)){let f=o.split(se),S=[];S.push({label:le(f[0]),value:Q}),S.push(...f.map((y,X,j)=>({label:le(y),value:j.slice(0,X+1).join(se)})).filter(y=>L.has(y.value))),Y(S);let O=S.find(y=>y.value===d)?.value??Q;F(t.REPORT_FORM.NAMES.COUNT_BY,O)}else Y([])},[p.values[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],p.values[t.REPORT_FORM.NAMES.COUNT_BY],L]);let I=(0,m.useCallback)(o=>{F(t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD,o)},[F]),A=(0,m.useCallback)(o=>{o.preventDefault(),o.stopPropagation();let d=document.getElementById(Ke);U(o,{[t.REPORT_FORM.NAMES.QUERY]:d?.value||""})},[U]);return(0,a.jsx)(ye,{bodyPadding:Ie.NONE,children:(0,a.jsxs)(_e,{onSubmit:A,className:T.createReportCardBody,"data-testid":"report-config-card-form",children:[(0,a.jsx)(h,{variant:D.H2,children:"Create Report"}),(0,a.jsxs)(h,{variant:D.DEFAULT,"data-testid":"report-builder-instructions",children:["Select a breakdown and a bucket size to generate your report. Reference our documentation on how to use"," ",(0,a.jsx)(be,{href:Ue,isExternal:!0,children:"Report Builder"}),"."]}),(0,a.jsx)(q,{label:"Select Breakdown",errorText:p.errors[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD]||p.errors[t.REPORT_FORM.NAMES.BUCKET_NUM]||p.errors[t.REPORT_FORM.NAMES.QUERY_FILTER],required:!0,children:(0,a.jsxs)("div",{className:T.createReportBreakdownRow,children:[(0,a.jsx)(ce,{className:T.breakdownFieldInput,contentLeft:(0,a.jsx)(V,{icon:"menu-search-line",size:"md"}),name:t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD,selectedOption:p.values[t.REPORT_FORM.NAMES.REPORT_BREAKDOWN_FIELD],options:B,onChange:$,onBlur:w,onSelect:I,required:!0,placeholder:"Breakdown Field"}),(0,a.jsx)(ne,{name:t.REPORT_FORM.NAMES.COUNT_BY,contentLeft:(0,a.jsx)(ae,{icon:"sort-desc",label:"Count By"}),value:p.values[t.REPORT_FORM.NAMES.COUNT_BY],onValueChange:P,options:W,valueProps:{placeholder:We},disabled:!x}),(0,a.jsx)(ne,{name:t.REPORT_FORM.NAMES.BUCKET_NUM,contentLeft:(0,a.jsx)(ae,{icon:"sort-desc",label:"Results"}),value:p.values[t.REPORT_FORM.NAMES.BUCKET_NUM],onValueChange:H,options:we.map(o=>({label:o.toString(),value:o.toString()})),valueProps:{placeholder:"Bucket Size"},"aria-label":"Bucket Select","data-testid":"bucket-select"})]})}),(0,a.jsxs)("div",{className:T.createReportBreakdownRow,children:[(0,a.jsx)(Le,{"data-testid":"query-filter",id:"query-filter","aria-label":"Filter nested records by query",label:"Filter results to only display nested records that match my query.",name:t.REPORT_FORM.NAMES.QUERY_FILTER,checked:p.values[t.REPORT_FORM.NAMES.QUERY_FILTER]==="true",onCheckedChange:K}),(0,a.jsx)(Be,{icon:"information-line",iconLabel:"",side:"right",contentClassName:T.tooltip,triggerClassName:T.tooltipIcon,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(h,{variant:D.SMALL,className:T.tooltipText,children:["For example, if you search for host.services.protocol=SSH and generate a report broken down by host.services.port and"," ",(0,a.jsx)(h,{variant:D.SMALL_SEMIBOLD,className:T.tooltipText,children:"do not"})," ","check this box, then your report counts will include all ports used by any protocol on hosts returned by your original host.services.protocol=SSH query. If you"," ",(0,a.jsx)(h,{variant:D.SMALL_SEMIBOLD,className:T.tooltipText,children:"do"})," ","check this box, then your report counts will only include ports used by SSH."]})})})]}),(0,a.jsx)(Ae,{"aria-label":"Generate Report",type:"submit",variant:Se.PRIMARY,disabled:!x,className:T.generateReportButton,"data-testid":"generate-report-button",children:"Generate Report"})]})})}var $e={reportBuilderBody:"d9Xri"};var eo=E(G(),1);var Xe={errorWrapper:"hzzL9"};var je=E(G(),1);var ue=E(R(),1);function de({errorCode:e,orgState:i,env:c}){let l=(0,je.useMemo)(()=>co(e,i,c),[e,i,c]);return(0,ue.jsx)(z,{"data-testid":`error_${String(e)}`,iconName:l.iconName,iconMode:l.iconMode,title:l.title,children:l.message})}function co(e,i,c){switch(e){case 100001:return Ge.CONSUMPTION_LIMIT_REACHED(i,c);case 18e4:return{iconName:"file-list-3",title:"Need a report?",message:(0,ue.jsx)("div",{children:"Select a breakdown field to generate a report."})};default:return Ve(e,{env:c,orgState:i})}}function me(e){return!!e&&typeof e=="object"&&"code"in e&&ve(e.code)}var Z=E(R(),1);function Re(e){let i=Me(),c=e.error??i,l=Oe(c)?c.data:c,M=me(l),b=De(),L=Pe(b),v=(0,eo.useContext)(Fe);return M?(0,Z.jsx)("div",{className:Xe.errorWrapper,children:(0,Z.jsx)(de,{errorCode:l.code,orgState:L,env:v})}):(0,Z.jsx)(qe,{error:l})}var uo=E(so(),1),_=E(R(),1);function Eo(){let e=J(),i=te("/search/report/data/*"),c=te("/collections/:id/report/data/*"),l=i||c;return(0,_.jsx)(ie,{children:(0,_.jsxs)("div",{className:$e.reportBuilderBody,children:[(0,_.jsx)(Ee,{}),e.aggregation&&l?(0,_.jsx)(Ne,{context:e}):(0,_.jsx)(z,{iconName:"file-list-3",title:"Need a report?",children:(0,_.jsx)("div",{children:"Select a breakdown field to generate a report."})})]})})}function At(){let e=Te();return(0,_.jsx)(ie,{children:(0,_.jsx)(Re,{error:e})})}export{Eo as a,At as b};
