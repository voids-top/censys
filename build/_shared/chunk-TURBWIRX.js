import{a as Re}from"/censys/build/_shared/chunk-NQ7LRPSF.js";import{b as xe}from"/censys/build/_shared/chunk-USPKPH7G.js";import{a as De}from"/censys/build/_shared/chunk-LCN4BXNE.js";import{a as Te}from"/censys/build/_shared/chunk-GC3JNZCU.js";import{a as ge}from"/censys/build/_shared/chunk-3W2VQNCA.js";import{a as Dt,b as _t,c as ue,d as ye}from"/censys/build/_shared/chunk-IE2JXLET.js";import{a as Z}from"/censys/build/_shared/chunk-QNALHZER.js";import{a as he}from"/censys/build/_shared/chunk-ULGJ3ZYU.js";import{a as Ee}from"/censys/build/_shared/chunk-5PS6SCVZ.js";import{a as fe}from"/censys/build/_shared/chunk-JAEJ7XSF.js";import{a as qe}from"/censys/build/_shared/chunk-EAJKCKTG.js";import{c as xt,d as Rt}from"/censys/build/_shared/chunk-ELSFEUI2.js";import{a as ie}from"/censys/build/_shared/chunk-Y7NKNUZC.js";import{q as oe,r as re,z as ne}from"/censys/build/_shared/chunk-HUE44QRB.js";import{a as st}from"/censys/build/_shared/chunk-NJXUBBUP.js";import{b as de}from"/censys/build/_shared/chunk-NUPTSKAJ.js";import{b as ae,h as se,k as L,q as le,t as me,u as pe,v as ce}from"/censys/build/_shared/chunk-YZ2VHXR4.js";import{a as d}from"/censys/build/_shared/chunk-RPAGMMSK.js";import{b as Et}from"/censys/build/_shared/chunk-2RV3CGNA.js";import{k as ee}from"/censys/build/_shared/chunk-OZE6EA6M.js";import{e as te}from"/censys/build/_shared/chunk-D5QEORL2.js";import{A as P,B as $,C as yt,Ja as Qt,La as jt,aa as z,wa as qt,x as Zt,y as gt,z as ut}from"/censys/build/_shared/chunk-GALQBYYN.js";import{c as zt}from"/censys/build/_shared/chunk-B7DSLLNE.js";import{d as A}from"/censys/build/_shared/chunk-6URBRDCL.js";import{a as Gt,c as Ut,e as $t,i as Yt,k as Vt,m as Xt,p as at,t as Jt,z as Kt}from"/censys/build/_shared/chunk-Q6RLBVJI.js";import{a as ft,c as m}from"/censys/build/_shared/chunk-XJAPXWKX.js";import{c as Ze,d as a}from"/censys/build/_shared/chunk-2QEWK57A.js";var Ge=Ze((Mr,Be)=>{Be.exports={}});var Ue=a(ft(),1);var y=a(ft(),1);var _e="CERT_HISTORY_FORM",q="type",h="port",u="protocol",D="start",_="end",F="page_token",po=[{value:"all",label:"All"},{value:"host",label:"Host"},{value:"web",label:"Web"}];var f={form:"_7fXCb",section:"oAJv-",fieldContainer:"_--7Nr",field:"_60CCE",divider:"ubF5B"};var T=a(m(),1);function Se({port:t,onPortChange:r,protocol:o,onProtocolChange:n,portError:p,protocolError:g}){return(0,T.jsxs)("div",{className:f.section,children:[(0,T.jsxs)("div",{className:f.fieldContainer,children:[(0,T.jsx)("label",{className:f.label,htmlFor:h,children:(0,T.jsx)(P,{children:"Port"})}),(0,T.jsx)("div",{className:f.field,children:(0,T.jsx)(yt,{name:h,placeholder:"Number","aria-label":"Port number",contentLeft:(0,T.jsx)(gt,{name:"filter-3",mode:"line"}),value:t,onChange:s=>{r(s.target.value)},isFullWidth:!0,isValid:!p,autoComplete:"off"})})]}),(0,T.jsxs)("div",{className:f.fieldContainer,children:[(0,T.jsx)("label",{className:f.label,htmlFor:u,children:(0,T.jsx)(P,{children:"Protocol"})}),(0,T.jsx)("div",{className:f.field,children:(0,T.jsx)(yt,{name:u,placeholder:"Protocol","aria-label":"Protocol",contentLeft:(0,T.jsx)(gt,{name:"filter-3",mode:"line"}),value:o,onChange:s=>{n(s.target.value)},isFullWidth:!0,isValid:!g,autoComplete:"off"})})]})]})}var Qe="Invalid asset type",je=`Port must be between ${xt} and ${Rt}`,to="Invalid protocol",eo=A.enum(["all","host","web"],{message:Qe}),oo=A.union([A.string().trim().refine(t=>/^\d+$/.test(t),{message:"Port must be between 1 and 65535"}).transform(t=>parseInt(t,10)).refine(t=>t>=xt&&t<=Rt,{message:je}),A.literal("")]),Ce=t=>A.string().trim().refine(r=>r===""||t.some(o=>o.toLowerCase()===r.toLowerCase()),{message:to}),ve=A.string().optional(),ro=A.string().optional(),Ie={[q]:eo,[h]:oo,[F]:ro,[D]:ve,[_]:ve};var no=t=>{let r=t.protocols.join("|");return`${t.ip||t.hostname||""} : ${t.port} / ${r}`},Oe=(t,r)=>Array.from(t.values()).reduce((o,n)=>{if(!n.ip&&!n.hostname||!n.start_time)return o;let p=n.ip||n.hostname||"",g=no(n),s=n.ip?"host":"web",N=n.start_time,H=n.end_time?n.end_time:Temporal.Now.instant(),I=`${p}-${N}-${H}`,G=Ct(g,r??null),v={id:I,type:s,name:g,startDate:N.toString(),endDate:H.toString(),opacity:G?1:.3,shape:s==="host"?L.ROUNDED:L.POINTED};return s==="host"?o.host.push(v):o.web.push(v),o},{host:[],web:[]}),vt=(t,r)=>{if(!t||!r)return;let[o,n]=t.name.split(" : "),[p]=n.split(" / "),g=`${o}-${p}-${t.startDate}`;return r.get(g)},Ne=t=>{let r=new Map;return t.forEach(o=>{let p=`${o.ip||o.hostname}-${o.port}-${o.start_time}`;r.set(p,o)}),r};var Ae=t=>t===-1?void 0:Temporal.Now.zonedDateTimeISO("UTC").subtract({days:t}).startOfDay().toInstant().toString();var Ct=(t,r)=>r?t.startsWith(`${r} /`):!0;var S=a(m(),1);function It(){let[t]=at(),{validProtocols:r,hostHistoryLimitEntitlement:o}=Kt(),n=re(),p=Ut(),g=t.get(D)??"",s=t.get(_)??"",N=t.get(h)??"",H=t.get(u)??"",I=t.get(F)??"",G=Re(),[v,et]=(0,y.useState)(N),[ot,mt]=(0,y.useState)(H),pt=(0,y.useMemo)(()=>({...Ie,[u]:Ce(r||[])}),[r]),{handleValueChange:E,handleSubmit:V,isValid:rt,isDirty:X,formState:nt}=Ee(pt,{[h]:v,[u]:ot,[D]:g,[_]:s,[F]:I},_e,G,!0),w=(0,y.useCallback)(x=>{E(h,x),et(x)},[E]),M=(0,y.useCallback)(x=>{E(u,x),mt(x)},[E]),U=(0,y.useCallback)(x=>E(D,x),[E]),ct=(0,y.useCallback)(x=>E(_,x),[E]),dt=N||H,k=(0,y.useCallback)(()=>{w(""),M(""),t.delete(h),t.delete(u),n({pathname:p.pathname,search:`?${t.toString()}`})},[t,n,p.pathname,w,M]),it=(0,y.useMemo)(()=>Ae(o),[o]);return(0,S.jsxs)(Jt,{onSubmit:V,className:f.form,children:[(0,S.jsx)("div",{className:f.section,children:(0,S.jsx)(xe,{startDate:g,endDate:s,isClearable:!1,withoutButton:!0,minDate:it,onStartDateChange:U,onEndDateChange:ct})}),(0,S.jsx)("div",{className:f.divider,children:(0,S.jsx)(st,{variant:"line--vertical"})}),(0,S.jsxs)("div",{className:f.section,children:[(0,S.jsx)(Se,{port:v,onPortChange:w,protocol:ot,onProtocolChange:M,portError:nt.errors[h],protocolError:nt.errors[u]}),(0,S.jsx)(z,{"aria-label":"Apply filters",variant:X?$.PRIMARY:$.DEFAULT,type:"submit",disabled:!rt,children:"Apply"}),dt&&(0,S.jsx)(z,{"data-testid":"clear-filters-button",className:f.clearFiltersButton,variant:$.TERTIARY,onClick:k,type:"button",children:"Clear Filters"})]})]})}var c=a(ft(),1);var Q={legend:"Xas3j",item:"nuUZQ",rounded:"GInT3",pointed:"Z6oeV"};var Y=a(m(),1);function Ot({items:t,className:r}){return(0,Y.jsx)("div",{className:Zt(Q.legend,r),children:t.map((o,n)=>{let p=o.shape===L.POINTED?Q.pointed:Q.rounded;return(0,Y.jsxs)("div",{className:Q.item,children:[(0,Y.jsx)("div",{className:p,style:{backgroundColor:o.color}}),(0,Y.jsx)(P,{children:o.label})]},n)})})}var Nt={count:"DeWb-",gray8:"oqJ0O"};var j=a(m(),1);function At({count:t}){return t===0?null:(0,j.jsxs)("div",{className:Nt.count,children:[(0,j.jsx)(P,{variant:ut.H5,children:"Results:"}),(0,j.jsx)(P,{variant:ut.H4,className:Nt.gray8,children:t.toLocaleString()})]})}var tt={emptyState:"lJbwj",loadingState:"_8-bMw",pulse:"XxqSo",svgContainer:"oaPDb"};var Pt=a(m(),1);function Lt(){return(0,Pt.jsx)("div",{className:tt.emptyState,children:(0,Pt.jsx)(oe,{iconName:"bar-chart-horizontal",iconMode:"fill",title:"There are no results to display",children:"Try adjusting your filters and try again."})})}var e=a(m(),1);function bt(){return(0,e.jsx)("div",{className:tt.loadingState,children:(0,e.jsx)("div",{className:tt.svgContainer,children:io})})}var io=(0,e.jsxs)("svg",{viewBox:"0 0 1156 550",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",children:[(0,e.jsx)("rect",{width:"100%",height:"100%",fill:d.SURFACE_BG_CARD_1}),(0,e.jsxs)("g",{stroke:d.SURFACE_BG_PAGE_0,strokeWidth:"1",children:[(0,e.jsx)("line",{x1:"200",y1:"22",x2:"200",y2:"532"}),(0,e.jsx)("line",{x1:"342.33",y1:"22",x2:"342.33",y2:"532"}),(0,e.jsx)("line",{x1:"484.67",y1:"22",x2:"484.67",y2:"532"}),(0,e.jsx)("line",{x1:"627.00",y1:"22",x2:"627.00",y2:"532"}),(0,e.jsx)("line",{x1:"769.33",y1:"22",x2:"769.33",y2:"532"}),(0,e.jsx)("line",{x1:"911.67",y1:"22",x2:"911.67",y2:"532"}),(0,e.jsx)("line",{x1:"1054.00",y1:"22",x2:"1054.00",y2:"532"})]}),(0,e.jsxs)("g",{stroke:d.SURFACE_BG_PAGE_0,strokeWidth:"1",children:[(0,e.jsx)("line",{x1:"200",y1:"22.00",x2:"1132",y2:"22.00"}),(0,e.jsx)("line",{x1:"200",y1:"78.67",x2:"1132",y2:"78.67"}),(0,e.jsx)("line",{x1:"200",y1:"135.33",x2:"1132",y2:"135.33"}),(0,e.jsx)("line",{x1:"200",y1:"192.00",x2:"1132",y2:"192.00"}),(0,e.jsx)("line",{x1:"200",y1:"248.67",x2:"1132",y2:"248.67"}),(0,e.jsx)("line",{x1:"200",y1:"305.33",x2:"1132",y2:"305.33"}),(0,e.jsx)("line",{x1:"200",y1:"362.00",x2:"1132",y2:"362.00"}),(0,e.jsx)("line",{x1:"200",y1:"418.67",x2:"1132",y2:"418.67"}),(0,e.jsx)("line",{x1:"200",y1:"475.33",x2:"1132",y2:"475.33"}),(0,e.jsx)("line",{x1:"200",y1:"532.00",x2:"1132",y2:"532.00"})]}),(0,e.jsxs)("g",{fill:d.BORDERLINE_SECONDARY,children:[(0,e.jsx)("rect",{x:"1030.87",y:"16.00",width:"100",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"945.47",y:"72.67",width:"90",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"858.29",y:"129.33",width:"60",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"924.12",y:"129.33",width:"90",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"753.32",y:"186.00",width:"45",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"735.53",y:"242.67",width:"190",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"673.26",y:"299.33",width:"50",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"728.41",y:"299.33",width:"100",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"457.98",y:"356.00",width:"230",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"351.23",y:"412.67",width:"80",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"315.65",y:"469.33",width:"110",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"248.04",y:"526.00",width:"70",height:"12",rx:"6"})]}),(0,e.jsxs)("g",{fill:d.BORDERLINE_SECONDARY,children:[(0,e.jsx)("rect",{x:"32",y:"16.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"72.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"129.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"186.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"242.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"299.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"356.00",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"412.67",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"469.33",width:"160",height:"12",rx:"6"}),(0,e.jsx)("rect",{x:"32",y:"526.00",width:"160",height:"12",rx:"6"})]})]});var O={content:"Lc-XB",title:"_4KDJk",subtitle:"vRRJ4",observed:"c4nnF",date:"_0jDM5",label:"s6vCd",name:"BtdaQ"};var Ht=a(m(),1);function lt({children:t}){return(0,Ht.jsx)(de,{children:(0,Ht.jsx)("div",{className:O.content,children:t})})}var C=a(m(),1);function wt({range:t}){return(0,C.jsxs)(lt,{children:[(0,C.jsxs)("div",{className:O.title,children:[t.ip||t.hostname," : ",t.port," /"," ",t.protocols.join("|")," (",t.transport_protocol,")"]}),t.start_time&&(0,C.jsxs)("div",{className:O.subtitle,children:[(0,C.jsx)("div",{className:O.observed,children:"First Observed"}),(0,C.jsxs)("div",{className:O.date,children:[(0,C.jsx)(Qt,{timestamp:t.start_time.toString()}),(0,C.jsx)(st,{variant:"line--vertical",spacing:8}),(0,C.jsx)(jt,{timestamp:t.start_time.toString()})]})]})]})}var Mt=a(m(),1);function kt({label:t}){return(0,Mt.jsx)(lt,{children:(0,Mt.jsx)("div",{className:O.name,children:t})})}var Pe=32,Le=40,be=2,He=10,we=48,Ft=470,W={top:20,right:20,bottom:40,left:200},Me=28,ke=[{color:Z[0],label:"Host",value:"host",shape:L.ROUNDED}];var B={wrapper:"LslfO",container:"qxDT0",chartContainer:"_5v4JG",bgOpacity:"Sjb8B",tooltip:"A7Hzh",dates:"Jq7v0",buttonContainer:"ikq78",chartFadeIn:"ftZcN",fadeIn:"UjLYF"};var Fe=(t,r)=>{if(r)return`${Ft}px`;let o=t.host.length+t.web.length;if(o===0)return`${Ft}px`;if(o<=be)return`${we+W.top+W.bottom}px`;let n=o>He?Pe:Le;return`${o*n+W.top+W.bottom}px`};var We=t=>t?Et(t)?.toZonedDateTimeISO("UTC").add({days:1}).subtract({nanoseconds:1}).toInstant().toString():null;var ao=a(Ge(),1),i=a(m(),1);function Wt(){let{certId:t,timelineRanges:r,resultCount:o,nextPageToken:n}=ge(),p=ne(),g=(0,c.useRef)(null),[s]=at(),N=$t(),H=Yt(),[I,G]=(0,c.useState)([]),[v,et]=(0,c.useState)(null),[ot,mt]=(0,c.useState)(!I.length),[pt,E]=(0,c.useState)(!1),V=s.get(D),rt=s.get(_),X=s.get(Dt),nt=s.get(_t),w=X?`${X} : ${nt}`:null,M=(0,c.useMemo)(()=>We(rt),[rt]);(0,c.useEffect)(()=>{G(r),et(n),mt(!1)},[r,n]),(0,c.useEffect)(()=>{if(p.data&&pt){let{timelineRanges:l,nextPageToken:R}=fe(p.data);E(!1),G(K=>[...K,...l]),et(R)}},[p.data]);let U=(0,c.useMemo)(()=>Ne(I),[I]),ct=(0,c.useCallback)(l=>{if(!l)return;let R=vt(l,U),K=l.name.split(" : ")[0],ht=l.type,Xe=R?.port.toString()||"",Je=R?.transport_protocol||"",Ke=R?.start_time||Temporal.Now.instant();s.set(Dt,K),s.set(_t,Xe),s.set(ue,Je),s.set(ye,Ke.toString());let ze=`/certificates/${t}/history/${ht}?${s}`;N(ze)},[s,N,U]),dt=(0,c.useCallback)(()=>{if(v){E(!0);let l=new URLSearchParams(s);l.set(F,v),p.load(`/certificates/${t}/history?${l}`)}},[v,p.load,s]),k=Oe(U,w),it=(0,c.useMemo)(()=>se(k),[k]),x=(0,c.useMemo)(()=>it.map(l=>{let K=Ct(l.name,w)?1:.3,ht=De(l.name,Me,!0);return{name:l.name,displayName:ht,subtitle:l.subtitle,opacity:K}}),[it,w]),J=H.state==="loading"&&!X||ot||!V||!M,$e=(0,c.useMemo)(()=>Fe(k,J),[k,J]),Ye=(0,c.useMemo)(()=>I.length===0,[I]),Tt=J?(0,i.jsx)(bt,{}):Ye?(0,i.jsx)(Lt,{}):null,Ve=!J&&v;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:B.wrapper,children:[(0,i.jsxs)("div",{className:B.container,children:[(0,i.jsxs)("div",{className:Tt?B.bgOpacity:"",children:[(0,i.jsx)(Ot,{items:ke}),!Tt&&(0,i.jsx)(At,{count:o}),(0,i.jsx)(ae,{onClick:ct,children:(0,i.jsxs)("div",{ref:g,className:B.chartContainer,style:{height:$e},children:[(0,i.jsx)(pe,{render:({data:l})=>{if(!l)return(0,i.jsx)(i.Fragment,{});if(l.tooltipString)return(0,i.jsx)(kt,{label:l.tooltipString});let R=vt(l,U);return R?(0,i.jsx)(wt,{range:R}):(0,i.jsx)(i.Fragment,{})},offsetY:10}),V&&M&&!J&&(0,i.jsx)("div",{className:B.chartFadeIn,children:(0,i.jsxs)(le,{ref:g,data:k,colors:Z,lineThickness:10,axis:{bottom:{showGridLines:!0,strokeWidth:.5,strokeDasharray:"3,3",textAnchor:"start",tickFontSize:12,strokeColor:d.TEXT_DISABLED,tickColor:d.TEXT_PRIMARY}},startDate:V,endDate:M,margin:W,border:{right:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},left:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},bottom:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"},top:{strokeColor:d.TEXT_DISABLED,strokeWidth:1,strokeDasharray:"none"}},children:[(0,i.jsx)(ce,{range:x,strokeColor:d.BORDERLINE_SECONDARY,textColor:d.TEXT_PRIMARY,selectedColor:d.FEEDBACK_INFO_HOVER}),(0,i.jsx)(me,{render:({x:l,height:R})=>(0,i.jsx)("line",{x1:l,x2:l,y1:0,y2:R,stroke:d.TEXT_PLACEHOLDER,strokeDasharray:"3,3"})})]})})]})})]}),Tt]}),(0,i.jsx)(Xt,{})]}),Ve&&(0,i.jsx)("div",{className:B.buttonContainer,children:(0,i.jsx)(z,{type:"submit",variant:$.TERTIARY,iconRight:"arrow-down",iconRightMode:"line",onClick:dt,isLoading:p.state==="loading",children:"Load More"})})]})}var Bt={container:"v3Wy0"};var lo=a(qe(),1),b=a(m(),1),un=he("Certificate Timeline","routes/certificates.$id"),yn=({currentUrl:t,nextUrl:r})=>{let o=new URL(t).searchParams,n=new URL(r).searchParams;return o.get(q)!==n.get(q)||o.get(h)!==n.get(h)||o.get(u)!==n.get(u)||o.get(D)!==n.get(D)||o.get(_)!==n.get(_)};function so(){return(0,b.jsx)("div",{className:Bt.container,"data-testid":"event-history-tab",children:(0,b.jsx)(qt,{header:(0,b.jsx)(It,{}),children:(0,b.jsx)(Wt,{})})})}function En(){let t=Vt(),r=te(),o=(0,Ue.useContext)(zt);return(0,b.jsx)("div",{className:Bt.container,children:Gt(t)&&ee(t.data)?(0,b.jsx)(Te,{accessState:r,errorCode:t.data.code,env:o}):(0,b.jsx)(ie,{error:t})})}export{un as a,yn as b,so as c,En as d};
